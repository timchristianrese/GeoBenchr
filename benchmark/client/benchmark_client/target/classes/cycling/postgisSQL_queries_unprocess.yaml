- name: ridesCrossingPlaceWithMostIncidentsInDistrict
  type: spatial
  sql: |
    WITH incident_points AS ( SELECT i.incident_id, i.geom FROM incidents i JOIN berlin_districts d ON ST_Within(i.geom, d.geom) WHERE d.name = 'Treptow-Köpenick'), clusters AS ( SELECT incident_id, geom, ST_ClusterWithin(geom, 10) OVER () AS cluster FROM incident_points), hotspot AS ( SELECT ST_SetSRID(ST_Centroid(ST_Collect(geom)), 4326) AS cluster_center FROM clusters GROUP BY cluster ORDER BY COUNT(*) DESC LIMIT 1) SELECT DISTINCT ON (r.ride_id) r.ride_id, r.rider_id FROM ride_points r CROSS JOIN hotspot h WHERE ST_DWithin(r.geom, h.cluster_center::geography, 500);
  params:
  - Treptow-Köpenick
  - 10
- name: averageRideDurationDuringDay
  type: temporal
  sql: |
    SELECT AVG(max_ts - min_ts) AS avg_duration FROM (SELECT r.ride_id, MAX(timestamp) AS max_ts, MIN(timestamp) AS min_ts FROM ride_points r WHERE timestamp >= '2023-09-09':timestamp AND timestamp < ('2023-09-09'::timestamp + INTERVAL '1 day') GROUP BY ride_id);
  params:
  - '2023-09-09'
- name: ridesStartedInDistrict
  type: spatial
  sql: |
    WITH ride_start AS ( SELECT r.ride_id, MIN(r.timestamp) AS start_ts FROM ride_points r GROUP BY ride_id), start_points AS ( SELECT r.ride_id, r.geom FROM ride_points r JOIN ride_start s ON r.ride_id = s.ride_id AND r.timestamp = s.start_ts) SELECT s.ride_id FROM start_points s JOIN berlin_districts d ON ST_Intersects(s.geom, d.geom) WHERE d.name = 'Pankow';
  params:
  - Pankow
- name: countActiveRidesInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT r.ride_id) FROM ride_points r WHERE r.timestamp BETWEEN ['2023-08-02 04:26:35', '2023-08-08 06:58:45'];
  params:
  - - '2023-08-02 04:26:35'
    - '2023-08-08 06:58:45'
- name: countActiveRidesInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT r.ride_id) FROM ride_points r WHERE r.timestamp BETWEEN ['2023-06-12 23:01:04', '2023-06-15 13:25:20'];
  params:
  - - '2023-06-12 23:01:04'
    - '2023-06-15 13:25:20'
- name: countActiveRidesInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT r.ride_id) FROM ride_points r WHERE r.timestamp BETWEEN ['2023-09-05 21:11:13', '2023-09-15 17:46:08'];
  params:
  - - '2023-09-05 21:11:13'
    - '2023-09-15 17:46:08'
- name: countActiveRidesInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT r.ride_id) FROM ride_points r WHERE r.timestamp BETWEEN ['2023-07-17 04:14:32', '2023-07-22 10:00:14'];
  params:
  - - '2023-07-17 04:14:32'
    - '2023-07-22 10:00:14'
- name: averageRideDurationDuringDay
  type: temporal
  sql: |
    SELECT AVG(max_ts - min_ts) AS avg_duration FROM (SELECT r.ride_id, MAX(timestamp) AS max_ts, MIN(timestamp) AS min_ts FROM ride_points r WHERE timestamp >= '2023-08-24':timestamp AND timestamp < ('2023-08-24'::timestamp + INTERVAL '1 day') GROUP BY ride_id);
  params:
  - '2023-08-24'
- name: averageRideDurationDuringDay
  type: temporal
  sql: |
    SELECT AVG(max_ts - min_ts) AS avg_duration FROM (SELECT r.ride_id, MAX(timestamp) AS max_ts, MIN(timestamp) AS min_ts FROM ride_points r WHERE timestamp >= '2024-03-02':timestamp AND timestamp < ('2024-03-02'::timestamp + INTERVAL '1 day') GROUP BY ride_id);
  params:
  - '2024-03-02'
- name: ridesCrossingPlaceWithMostIncidentsInDistrict
  type: spatial
  sql: |
    WITH incident_points AS ( SELECT i.incident_id, i.geom FROM incidents i JOIN berlin_districts d ON ST_Within(i.geom, d.geom) WHERE d.name = 'Lichtenberg'), clusters AS ( SELECT incident_id, geom, ST_ClusterWithin(geom, 3) OVER () AS cluster FROM incident_points), hotspot AS ( SELECT ST_SetSRID(ST_Centroid(ST_Collect(geom)), 4326) AS cluster_center FROM clusters GROUP BY cluster ORDER BY COUNT(*) DESC LIMIT 1) SELECT DISTINCT ON (r.ride_id) r.ride_id, r.rider_id FROM ride_points r CROSS JOIN hotspot h WHERE ST_DWithin(r.geom, h.cluster_center::geography, 500);
  params:
  - Lichtenberg
  - 3
- name: ridesCrossingPlaceWithMostIncidentsInDistrict
  type: spatial
  sql: |
    WITH incident_points AS ( SELECT i.incident_id, i.geom FROM incidents i JOIN berlin_districts d ON ST_Within(i.geom, d.geom) WHERE d.name = 'Mitte'), clusters AS ( SELECT incident_id, geom, ST_ClusterWithin(geom, 8) OVER () AS cluster FROM incident_points), hotspot AS ( SELECT ST_SetSRID(ST_Centroid(ST_Collect(geom)), 4326) AS cluster_center FROM clusters GROUP BY cluster ORDER BY COUNT(*) DESC LIMIT 1) SELECT DISTINCT ON (r.ride_id) r.ride_id, r.rider_id FROM ride_points r CROSS JOIN hotspot h WHERE ST_DWithin(r.geom, h.cluster_center::geography, 500);
  params:
  - Mitte
  - 8
- name: ridesStartedInDistrict
  type: spatial
  sql: |
    WITH ride_start AS ( SELECT r.ride_id, MIN(r.timestamp) AS start_ts FROM ride_points r GROUP BY ride_id), start_points AS ( SELECT r.ride_id, r.geom FROM ride_points r JOIN ride_start s ON r.ride_id = s.ride_id AND r.timestamp = s.start_ts) SELECT s.ride_id FROM start_points s JOIN berlin_districts d ON ST_Intersects(s.geom, d.geom) WHERE d.name = 'Mitte';
  params:
  - Mitte
- name: countActiveRidesInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT r.ride_id) FROM ride_points r WHERE r.timestamp BETWEEN ['2023-07-07 04:49:52', '2023-07-14 13:07:32'];
  params:
  - - '2023-07-07 04:49:52'
    - '2023-07-14 13:07:32'
- name: averageRideDurationToGoAtUniversityInPeriod
  type: spatiotemporal
  sql: |
    WITH rides_in_period AS ( SELECT DISTINCT r.ride_id FROM ride_points r WHERE r.timestamp BETWEEN ['2023-08-20 18:45:46', '2023-08-30 08:00:01']), ride_stats AS ( SELECT r.ride_id, MIN(r.timestamp) AS start_ts, MAX(r.timestamp) AS end_ts FROM ride_points r JOIN rides_in_period rp ON r.ride_id = rp.ride_id GROUP BY r.ride_id) SELECT AVG(rs.end_ts - rs.start_ts) AS avg_duration FROM ride_stats rs JOIN ride_points rend ON rend.ride_id = rs.ride_id AND rend.timestamp = rs.end_ts JOIN universities u ON ST_DWithin(rend.geom, u.geom, 2500) WHERE u.name = 'Freie-Universität-Berlin';
  params:
  - - '2023-08-20 18:45:46'
    - '2023-08-30 08:00:01'
  - Freie-Universität-Berlin
- name: averageRideDurationDuringDay
  type: temporal
  sql: |
    SELECT AVG(max_ts - min_ts) AS avg_duration FROM (SELECT r.ride_id, MAX(timestamp) AS max_ts, MIN(timestamp) AS min_ts FROM ride_points r WHERE timestamp >= '2023-10-22':timestamp AND timestamp < ('2023-10-22'::timestamp + INTERVAL '1 day') GROUP BY ride_id);
  params:
  - '2023-10-22'
- name: ridesCrossingPlaceWithMostIncidentsInDistrict
  type: spatial
  sql: |
    WITH incident_points AS ( SELECT i.incident_id, i.geom FROM incidents i JOIN berlin_districts d ON ST_Within(i.geom, d.geom) WHERE d.name = 'Tempelhof-Schöneberg'), clusters AS ( SELECT incident_id, geom, ST_ClusterWithin(geom, 7) OVER () AS cluster FROM incident_points), hotspot AS ( SELECT ST_SetSRID(ST_Centroid(ST_Collect(geom)), 4326) AS cluster_center FROM clusters GROUP BY cluster ORDER BY COUNT(*) DESC LIMIT 1) SELECT DISTINCT ON (r.ride_id) r.ride_id, r.rider_id FROM ride_points r CROSS JOIN hotspot h WHERE ST_DWithin(r.geom, h.cluster_center::geography, 500);
  params:
  - Tempelhof-Schöneberg
  - 7
- name: countActiveRidesInDistrict
  type: spatial
  sql: |
    SELECT d.name, COUNT(DISTINCT r.ride_id) AS ride_count FROM berlin_districts d JOIN ride_points r ON ST_Intersects(r.geom, d.geom) WHERE d.name = 'Pankow' GROUP BY d.name;
  params:
  - Pankow
- name: averageRideDurationDuringDay
  type: temporal
  sql: |
    SELECT AVG(max_ts - min_ts) AS avg_duration FROM (SELECT r.ride_id, MAX(timestamp) AS max_ts, MIN(timestamp) AS min_ts FROM ride_points r WHERE timestamp >= '2023-04-30':timestamp AND timestamp < ('2023-04-30'::timestamp + INTERVAL '1 day') GROUP BY ride_id);
  params:
  - '2023-04-30'
- name: ridesCrossingPlaceWithMostIncidentsInDistrict
  type: spatial
  sql: |
    WITH incident_points AS ( SELECT i.incident_id, i.geom FROM incidents i JOIN berlin_districts d ON ST_Within(i.geom, d.geom) WHERE d.name = 'Steglitz-Zehlendorf'), clusters AS ( SELECT incident_id, geom, ST_ClusterWithin(geom, 2) OVER () AS cluster FROM incident_points), hotspot AS ( SELECT ST_SetSRID(ST_Centroid(ST_Collect(geom)), 4326) AS cluster_center FROM clusters GROUP BY cluster ORDER BY COUNT(*) DESC LIMIT 1) SELECT DISTINCT ON (r.ride_id) r.ride_id, r.rider_id FROM ride_points r CROSS JOIN hotspot h WHERE ST_DWithin(r.geom, h.cluster_center::geography, 500);
  params:
  - Steglitz-Zehlendorf
  - 2
- name: countActiveRidesInDistrict
  type: spatial
  sql: |
    SELECT d.name, COUNT(DISTINCT r.ride_id) AS ride_count FROM berlin_districts d JOIN ride_points r ON ST_Intersects(r.geom, d.geom) WHERE d.name = 'Lichtenberg' GROUP BY d.name;
  params:
  - Lichtenberg
- name: countActiveRidesInDistrict
  type: spatial
  sql: |
    SELECT d.name, COUNT(DISTINCT r.ride_id) AS ride_count FROM berlin_districts d JOIN ride_points r ON ST_Intersects(r.geom, d.geom) WHERE d.name = 'Neukölln' GROUP BY d.name;
  params:
  - Neukölln
- name: ridesStartedInDistrict
  type: spatial
  sql: |
    WITH ride_start AS ( SELECT r.ride_id, MIN(r.timestamp) AS start_ts FROM ride_points r GROUP BY ride_id), start_points AS ( SELECT r.ride_id, r.geom FROM ride_points r JOIN ride_start s ON r.ride_id = s.ride_id AND r.timestamp = s.start_ts) SELECT s.ride_id FROM start_points s JOIN berlin_districts d ON ST_Intersects(s.geom, d.geom) WHERE d.name = 'Charlottenburg-Wilmersdorf';
  params:
  - Charlottenburg-Wilmersdorf
- name: countActiveRidesInDistrict
  type: spatial
  sql: |
    SELECT d.name, COUNT(DISTINCT r.ride_id) AS ride_count FROM berlin_districts d JOIN ride_points r ON ST_Intersects(r.geom, d.geom) WHERE d.name = 'Spandau' GROUP BY d.name;
  params:
  - Spandau
- name: ridesStartedInDistrict
  type: spatial
  sql: |
    WITH ride_start AS ( SELECT r.ride_id, MIN(r.timestamp) AS start_ts FROM ride_points r GROUP BY ride_id), start_points AS ( SELECT r.ride_id, r.geom FROM ride_points r JOIN ride_start s ON r.ride_id = s.ride_id AND r.timestamp = s.start_ts) SELECT s.ride_id FROM start_points s JOIN berlin_districts d ON ST_Intersects(s.geom, d.geom) WHERE d.name = 'Marzahn-Hellersdorf';
  params:
  - Marzahn-Hellersdorf
- name: averageRideDurationDuringDay
  type: temporal
  sql: |
    SELECT AVG(max_ts - min_ts) AS avg_duration FROM (SELECT r.ride_id, MAX(timestamp) AS max_ts, MIN(timestamp) AS min_ts FROM ride_points r WHERE timestamp >= '2023-06-26':timestamp AND timestamp < ('2023-06-26'::timestamp + INTERVAL '1 day') GROUP BY ride_id);
  params:
  - '2023-06-26'
- name: ridesStartedInDistrict
  type: spatial
  sql: |
    WITH ride_start AS ( SELECT r.ride_id, MIN(r.timestamp) AS start_ts FROM ride_points r GROUP BY ride_id), start_points AS ( SELECT r.ride_id, r.geom FROM ride_points r JOIN ride_start s ON r.ride_id = s.ride_id AND r.timestamp = s.start_ts) SELECT s.ride_id FROM start_points s JOIN berlin_districts d ON ST_Intersects(s.geom, d.geom) WHERE d.name = 'Friedrichshain-Kreuzberg';
  params:
  - Friedrichshain-Kreuzberg
- name: countActiveRidesInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT r.ride_id) FROM ride_points r WHERE r.timestamp BETWEEN ['2023-05-10 04:49:59', '2023-05-14 09:28:24'];
  params:
  - - '2023-05-10 04:49:59'
    - '2023-05-14 09:28:24'
- name: ridesCrossingPlaceWithMostIncidentsInDistrict
  type: spatial
  sql: |
    WITH incident_points AS ( SELECT i.incident_id, i.geom FROM incidents i JOIN berlin_districts d ON ST_Within(i.geom, d.geom) WHERE d.name = 'Pankow'), clusters AS ( SELECT incident_id, geom, ST_ClusterWithin(geom, 2) OVER () AS cluster FROM incident_points), hotspot AS ( SELECT ST_SetSRID(ST_Centroid(ST_Collect(geom)), 4326) AS cluster_center FROM clusters GROUP BY cluster ORDER BY COUNT(*) DESC LIMIT 1) SELECT DISTINCT ON (r.ride_id) r.ride_id, r.rider_id FROM ride_points r CROSS JOIN hotspot h WHERE ST_DWithin(r.geom, h.cluster_center::geography, 500);
  params:
  - Pankow
  - 2
- name: countActiveRidesInDistrict
  type: spatial
  sql: |
    SELECT d.name, COUNT(DISTINCT r.ride_id) AS ride_count FROM berlin_districts d JOIN ride_points r ON ST_Intersects(r.geom, d.geom) WHERE d.name = 'Lichtenberg' GROUP BY d.name;
  params:
  - Lichtenberg
- name: averageRideDurationToGoAtUniversityInPeriod
  type: spatiotemporal
  sql: |
    WITH rides_in_period AS ( SELECT DISTINCT r.ride_id FROM ride_points r WHERE r.timestamp BETWEEN ['2023-09-11 12:34:03', '2023-09-23 05:55:10']), ride_stats AS ( SELECT r.ride_id, MIN(r.timestamp) AS start_ts, MAX(r.timestamp) AS end_ts FROM ride_points r JOIN rides_in_period rp ON r.ride_id = rp.ride_id GROUP BY r.ride_id) SELECT AVG(rs.end_ts - rs.start_ts) AS avg_duration FROM ride_stats rs JOIN ride_points rend ON rend.ride_id = rs.ride_id AND rend.timestamp = rs.end_ts JOIN universities u ON ST_DWithin(rend.geom, u.geom, 2500) WHERE u.name = 'Humboldt-Universität-zu-Berlin';
  params:
  - - '2023-09-11 12:34:03'
    - '2023-09-23 05:55:10'
  - Humboldt-Universität-zu-Berlin
- name: ridesStartedInDistrict
  type: spatial
  sql: |
    WITH ride_start AS ( SELECT r.ride_id, MIN(r.timestamp) AS start_ts FROM ride_points r GROUP BY ride_id), start_points AS ( SELECT r.ride_id, r.geom FROM ride_points r JOIN ride_start s ON r.ride_id = s.ride_id AND r.timestamp = s.start_ts) SELECT s.ride_id FROM start_points s JOIN berlin_districts d ON ST_Intersects(s.geom, d.geom) WHERE d.name = 'Spandau';
  params:
  - Spandau
- name: averageRideDurationDuringDay
  type: temporal
  sql: |
    SELECT AVG(max_ts - min_ts) AS avg_duration FROM (SELECT r.ride_id, MAX(timestamp) AS max_ts, MIN(timestamp) AS min_ts FROM ride_points r WHERE timestamp >= '2023-03-14':timestamp AND timestamp < ('2023-03-14'::timestamp + INTERVAL '1 day') GROUP BY ride_id);
  params:
  - '2023-03-14'
- name: averageRideDurationToGoAtUniversityInPeriod
  type: spatiotemporal
  sql: |
    WITH rides_in_period AS ( SELECT DISTINCT r.ride_id FROM ride_points r WHERE r.timestamp BETWEEN ['2023-02-17 00:15:41', '2023-03-02 17:22:21']), ride_stats AS ( SELECT r.ride_id, MIN(r.timestamp) AS start_ts, MAX(r.timestamp) AS end_ts FROM ride_points r JOIN rides_in_period rp ON r.ride_id = rp.ride_id GROUP BY r.ride_id) SELECT AVG(rs.end_ts - rs.start_ts) AS avg_duration FROM ride_stats rs JOIN ride_points rend ON rend.ride_id = rs.ride_id AND rend.timestamp = rs.end_ts JOIN universities u ON ST_DWithin(rend.geom, u.geom, 2500) WHERE u.name = 'European-School-of-Management-and-Technology-Berlin';
  params:
  - - '2023-02-17 00:15:41'
    - '2023-03-02 17:22:21'
  - European-School-of-Management-and-Technology-Berlin
- name: countActiveRidesInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT r.ride_id) FROM ride_points r WHERE r.timestamp BETWEEN ['2023-12-11 08:21:10', '2023-12-25 13:39:42'];
  params:
  - - '2023-12-11 08:21:10'
    - '2023-12-25 13:39:42'
- name: ridesStartedInDistrict
  type: spatial
  sql: |
    WITH ride_start AS ( SELECT r.ride_id, MIN(r.timestamp) AS start_ts FROM ride_points r GROUP BY ride_id), start_points AS ( SELECT r.ride_id, r.geom FROM ride_points r JOIN ride_start s ON r.ride_id = s.ride_id AND r.timestamp = s.start_ts) SELECT s.ride_id FROM start_points s JOIN berlin_districts d ON ST_Intersects(s.geom, d.geom) WHERE d.name = 'Neukölln';
  params:
  - Neukölln
- name: averageRideDurationToGoAtUniversityInPeriod
  type: spatiotemporal
  sql: |
    WITH rides_in_period AS ( SELECT DISTINCT r.ride_id FROM ride_points r WHERE r.timestamp BETWEEN ['2023-08-25 14:38:17', '2023-09-06 05:42:58']), ride_stats AS ( SELECT r.ride_id, MIN(r.timestamp) AS start_ts, MAX(r.timestamp) AS end_ts FROM ride_points r JOIN rides_in_period rp ON r.ride_id = rp.ride_id GROUP BY r.ride_id) SELECT AVG(rs.end_ts - rs.start_ts) AS avg_duration FROM ride_stats rs JOIN ride_points rend ON rend.ride_id = rs.ride_id AND rend.timestamp = rs.end_ts JOIN universities u ON ST_DWithin(rend.geom, u.geom, 2500) WHERE u.name = 'Humboldt-Universität-zu-Berlin';
  params:
  - - '2023-08-25 14:38:17'
    - '2023-09-06 05:42:58'
  - Humboldt-Universität-zu-Berlin
- name: ridesStartedInDistrict
  type: spatial
  sql: |
    WITH ride_start AS ( SELECT r.ride_id, MIN(r.timestamp) AS start_ts FROM ride_points r GROUP BY ride_id), start_points AS ( SELECT r.ride_id, r.geom FROM ride_points r JOIN ride_start s ON r.ride_id = s.ride_id AND r.timestamp = s.start_ts) SELECT s.ride_id FROM start_points s JOIN berlin_districts d ON ST_Intersects(s.geom, d.geom) WHERE d.name = 'Charlottenburg-Wilmersdorf';
  params:
  - Charlottenburg-Wilmersdorf
- name: ridesCrossingPlaceWithMostIncidentsInDistrict
  type: spatial
  sql: |
    WITH incident_points AS ( SELECT i.incident_id, i.geom FROM incidents i JOIN berlin_districts d ON ST_Within(i.geom, d.geom) WHERE d.name = 'Lichtenberg'), clusters AS ( SELECT incident_id, geom, ST_ClusterWithin(geom, 4) OVER () AS cluster FROM incident_points), hotspot AS ( SELECT ST_SetSRID(ST_Centroid(ST_Collect(geom)), 4326) AS cluster_center FROM clusters GROUP BY cluster ORDER BY COUNT(*) DESC LIMIT 1) SELECT DISTINCT ON (r.ride_id) r.ride_id, r.rider_id FROM ride_points r CROSS JOIN hotspot h WHERE ST_DWithin(r.geom, h.cluster_center::geography, 500);
  params:
  - Lichtenberg
  - 4
- name: averageRideDurationDuringDay
  type: temporal
  sql: |
    SELECT AVG(max_ts - min_ts) AS avg_duration FROM (SELECT r.ride_id, MAX(timestamp) AS max_ts, MIN(timestamp) AS min_ts FROM ride_points r WHERE timestamp >= '2023-11-02':timestamp AND timestamp < ('2023-11-02'::timestamp + INTERVAL '1 day') GROUP BY ride_id);
  params:
  - '2023-11-02'
- name: averageRideDurationToGoAtUniversityInPeriod
  type: spatiotemporal
  sql: |
    WITH rides_in_period AS ( SELECT DISTINCT r.ride_id FROM ride_points r WHERE r.timestamp BETWEEN ['2023-07-07 01:29:19', '2023-07-09 20:40:37']), ride_stats AS ( SELECT r.ride_id, MIN(r.timestamp) AS start_ts, MAX(r.timestamp) AS end_ts FROM ride_points r JOIN rides_in_period rp ON r.ride_id = rp.ride_id GROUP BY r.ride_id) SELECT AVG(rs.end_ts - rs.start_ts) AS avg_duration FROM ride_stats rs JOIN ride_points rend ON rend.ride_id = rs.ride_id AND rend.timestamp = rs.end_ts JOIN universities u ON ST_DWithin(rend.geom, u.geom, 2500) WHERE u.name = 'Universität-der-Künste-Berlin';
  params:
  - - '2023-07-07 01:29:19'
    - '2023-07-09 20:40:37'
  - Universität-der-Künste-Berlin
- name: countActiveRidesInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT r.ride_id) FROM ride_points r WHERE r.timestamp BETWEEN ['2023-10-25 11:55:42', '2023-11-04 05:14:26'];
  params:
  - - '2023-10-25 11:55:42'
    - '2023-11-04 05:14:26'
- name: averageRideDurationToGoAtUniversityInPeriod
  type: spatiotemporal
  sql: |
    WITH rides_in_period AS ( SELECT DISTINCT r.ride_id FROM ride_points r WHERE r.timestamp BETWEEN ['2023-04-14 23:34:16', '2023-04-18 14:28:18']), ride_stats AS ( SELECT r.ride_id, MIN(r.timestamp) AS start_ts, MAX(r.timestamp) AS end_ts FROM ride_points r JOIN rides_in_period rp ON r.ride_id = rp.ride_id GROUP BY r.ride_id) SELECT AVG(rs.end_ts - rs.start_ts) AS avg_duration FROM ride_stats rs JOIN ride_points rend ON rend.ride_id = rs.ride_id AND rend.timestamp = rs.end_ts JOIN universities u ON ST_DWithin(rend.geom, u.geom, 2500) WHERE u.name = 'Technische-Universität-Berlin';
  params:
  - - '2023-04-14 23:34:16'
    - '2023-04-18 14:28:18'
  - Technische-Universität-Berlin
- name: countActiveRidesInDistrict
  type: spatial
  sql: |
    SELECT d.name, COUNT(DISTINCT r.ride_id) AS ride_count FROM berlin_districts d JOIN ride_points r ON ST_Intersects(r.geom, d.geom) WHERE d.name = 'Marzahn-Hellersdorf' GROUP BY d.name;
  params:
  - Marzahn-Hellersdorf
- name: averageRideDurationToGoAtUniversityInPeriod
  type: spatiotemporal
  sql: |
    WITH rides_in_period AS ( SELECT DISTINCT r.ride_id FROM ride_points r WHERE r.timestamp BETWEEN ['2023-08-09 22:16:22', '2023-08-19 10:50:49']), ride_stats AS ( SELECT r.ride_id, MIN(r.timestamp) AS start_ts, MAX(r.timestamp) AS end_ts FROM ride_points r JOIN rides_in_period rp ON r.ride_id = rp.ride_id GROUP BY r.ride_id) SELECT AVG(rs.end_ts - rs.start_ts) AS avg_duration FROM ride_stats rs JOIN ride_points rend ON rend.ride_id = rs.ride_id AND rend.timestamp = rs.end_ts JOIN universities u ON ST_DWithin(rend.geom, u.geom, 2500) WHERE u.name = 'Technische-Universität-Berlin';
  params:
  - - '2023-08-09 22:16:22'
    - '2023-08-19 10:50:49'
  - Technische-Universität-Berlin
- name: countActiveRidesInDistrict
  type: spatial
  sql: |
    SELECT d.name, COUNT(DISTINCT r.ride_id) AS ride_count FROM berlin_districts d JOIN ride_points r ON ST_Intersects(r.geom, d.geom) WHERE d.name = 'Marzahn-Hellersdorf' GROUP BY d.name;
  params:
  - Marzahn-Hellersdorf
- name: averageRideDurationDuringDay
  type: temporal
  sql: |
    SELECT AVG(max_ts - min_ts) AS avg_duration FROM (SELECT r.ride_id, MAX(timestamp) AS max_ts, MIN(timestamp) AS min_ts FROM ride_points r WHERE timestamp >= '2023-11-12':timestamp AND timestamp < ('2023-11-12'::timestamp + INTERVAL '1 day') GROUP BY ride_id);
  params:
  - '2023-11-12'
- name: averageRideDurationToGoAtUniversityInPeriod
  type: spatiotemporal
  sql: |
    WITH rides_in_period AS ( SELECT DISTINCT r.ride_id FROM ride_points r WHERE r.timestamp BETWEEN ['2023-03-21 09:58:57', '2023-03-31 05:37:36']), ride_stats AS ( SELECT r.ride_id, MIN(r.timestamp) AS start_ts, MAX(r.timestamp) AS end_ts FROM ride_points r JOIN rides_in_period rp ON r.ride_id = rp.ride_id GROUP BY r.ride_id) SELECT AVG(rs.end_ts - rs.start_ts) AS avg_duration FROM ride_stats rs JOIN ride_points rend ON rend.ride_id = rs.ride_id AND rend.timestamp = rs.end_ts JOIN universities u ON ST_DWithin(rend.geom, u.geom, 2500) WHERE u.name = 'Freie-Universität-Berlin';
  params:
  - - '2023-03-21 09:58:57'
    - '2023-03-31 05:37:36'
  - Freie-Universität-Berlin
- name: ridesStartedInDistrict
  type: spatial
  sql: |
    WITH ride_start AS ( SELECT r.ride_id, MIN(r.timestamp) AS start_ts FROM ride_points r GROUP BY ride_id), start_points AS ( SELECT r.ride_id, r.geom FROM ride_points r JOIN ride_start s ON r.ride_id = s.ride_id AND r.timestamp = s.start_ts) SELECT s.ride_id FROM start_points s JOIN berlin_districts d ON ST_Intersects(s.geom, d.geom) WHERE d.name = 'Friedrichshain-Kreuzberg';
  params:
  - Friedrichshain-Kreuzberg
- name: countActiveRidesInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT r.ride_id) FROM ride_points r WHERE r.timestamp BETWEEN ['2023-11-11 16:01:02', '2023-11-20 20:54:26'];
  params:
  - - '2023-11-11 16:01:02'
    - '2023-11-20 20:54:26'
- name: ridesCrossingPlaceWithMostIncidentsInDistrict
  type: spatial
  sql: |
    WITH incident_points AS ( SELECT i.incident_id, i.geom FROM incidents i JOIN berlin_districts d ON ST_Within(i.geom, d.geom) WHERE d.name = 'Treptow-Köpenick'), clusters AS ( SELECT incident_id, geom, ST_ClusterWithin(geom, 7) OVER () AS cluster FROM incident_points), hotspot AS ( SELECT ST_SetSRID(ST_Centroid(ST_Collect(geom)), 4326) AS cluster_center FROM clusters GROUP BY cluster ORDER BY COUNT(*) DESC LIMIT 1) SELECT DISTINCT ON (r.ride_id) r.ride_id, r.rider_id FROM ride_points r CROSS JOIN hotspot h WHERE ST_DWithin(r.geom, h.cluster_center::geography, 500);
  params:
  - Treptow-Köpenick
  - 7
- name: countActiveRidesInDistrict
  type: spatial
  sql: |
    SELECT d.name, COUNT(DISTINCT r.ride_id) AS ride_count FROM berlin_districts d JOIN ride_points r ON ST_Intersects(r.geom, d.geom) WHERE d.name = 'Spandau' GROUP BY d.name;
  params:
  - Spandau
- name: averageRideDurationToGoAtUniversityInPeriod
  type: spatiotemporal
  sql: |
    WITH rides_in_period AS ( SELECT DISTINCT r.ride_id FROM ride_points r WHERE r.timestamp BETWEEN ['2023-04-28 01:31:10', '2023-05-07 10:53:44']), ride_stats AS ( SELECT r.ride_id, MIN(r.timestamp) AS start_ts, MAX(r.timestamp) AS end_ts FROM ride_points r JOIN rides_in_period rp ON r.ride_id = rp.ride_id GROUP BY r.ride_id) SELECT AVG(rs.end_ts - rs.start_ts) AS avg_duration FROM ride_stats rs JOIN ride_points rend ON rend.ride_id = rs.ride_id AND rend.timestamp = rs.end_ts JOIN universities u ON ST_DWithin(rend.geom, u.geom, 2500) WHERE u.name = 'Freie-Universität-Berlin';
  params:
  - - '2023-04-28 01:31:10'
    - '2023-05-07 10:53:44'
  - Freie-Universität-Berlin
- name: countActiveRidesInDistrict
  type: spatial
  sql: |
    SELECT d.name, COUNT(DISTINCT r.ride_id) AS ride_count FROM berlin_districts d JOIN ride_points r ON ST_Intersects(r.geom, d.geom) WHERE d.name = 'Tempelhof-Schöneberg' GROUP BY d.name;
  params:
  - Tempelhof-Schöneberg
- name: countActiveRidesInDistrict
  type: spatial
  sql: |
    SELECT d.name, COUNT(DISTINCT r.ride_id) AS ride_count FROM berlin_districts d JOIN ride_points r ON ST_Intersects(r.geom, d.geom) WHERE d.name = 'Steglitz-Zehlendorf' GROUP BY d.name;
  params:
  - Steglitz-Zehlendorf
- name: ridesStartedInDistrict
  type: spatial
  sql: |
    WITH ride_start AS ( SELECT r.ride_id, MIN(r.timestamp) AS start_ts FROM ride_points r GROUP BY ride_id), start_points AS ( SELECT r.ride_id, r.geom FROM ride_points r JOIN ride_start s ON r.ride_id = s.ride_id AND r.timestamp = s.start_ts) SELECT s.ride_id FROM start_points s JOIN berlin_districts d ON ST_Intersects(s.geom, d.geom) WHERE d.name = 'Friedrichshain-Kreuzberg';
  params:
  - Friedrichshain-Kreuzberg
- name: ridesCrossingPlaceWithMostIncidentsInDistrict
  type: spatial
  sql: |
    WITH incident_points AS ( SELECT i.incident_id, i.geom FROM incidents i JOIN berlin_districts d ON ST_Within(i.geom, d.geom) WHERE d.name = 'Steglitz-Zehlendorf'), clusters AS ( SELECT incident_id, geom, ST_ClusterWithin(geom, 8) OVER () AS cluster FROM incident_points), hotspot AS ( SELECT ST_SetSRID(ST_Centroid(ST_Collect(geom)), 4326) AS cluster_center FROM clusters GROUP BY cluster ORDER BY COUNT(*) DESC LIMIT 1) SELECT DISTINCT ON (r.ride_id) r.ride_id, r.rider_id FROM ride_points r CROSS JOIN hotspot h WHERE ST_DWithin(r.geom, h.cluster_center::geography, 500);
  params:
  - Steglitz-Zehlendorf
  - 8
- name: countActiveRidesInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT r.ride_id) FROM ride_points r WHERE r.timestamp BETWEEN ['2023-03-13 14:10:34', '2023-03-18 13:50:15'];
  params:
  - - '2023-03-13 14:10:34'
    - '2023-03-18 13:50:15'
- name: averageRideDurationDuringDay
  type: temporal
  sql: |
    SELECT AVG(max_ts - min_ts) AS avg_duration FROM (SELECT r.ride_id, MAX(timestamp) AS max_ts, MIN(timestamp) AS min_ts FROM ride_points r WHERE timestamp >= '2023-06-15':timestamp AND timestamp < ('2023-06-15'::timestamp + INTERVAL '1 day') GROUP BY ride_id);
  params:
  - '2023-06-15'
- name: ridesCrossingPlaceWithMostIncidentsInDistrict
  type: spatial
  sql: |
    WITH incident_points AS ( SELECT i.incident_id, i.geom FROM incidents i JOIN berlin_districts d ON ST_Within(i.geom, d.geom) WHERE d.name = 'Spandau'), clusters AS ( SELECT incident_id, geom, ST_ClusterWithin(geom, 3) OVER () AS cluster FROM incident_points), hotspot AS ( SELECT ST_SetSRID(ST_Centroid(ST_Collect(geom)), 4326) AS cluster_center FROM clusters GROUP BY cluster ORDER BY COUNT(*) DESC LIMIT 1) SELECT DISTINCT ON (r.ride_id) r.ride_id, r.rider_id FROM ride_points r CROSS JOIN hotspot h WHERE ST_DWithin(r.geom, h.cluster_center::geography, 500);
  params:
  - Spandau
  - 3
- name: averageRideDurationToGoAtUniversityInPeriod
  type: spatiotemporal
  sql: |
    WITH rides_in_period AS ( SELECT DISTINCT r.ride_id FROM ride_points r WHERE r.timestamp BETWEEN ['2023-08-27 10:26:57', '2023-09-01 21:29:22']), ride_stats AS ( SELECT r.ride_id, MIN(r.timestamp) AS start_ts, MAX(r.timestamp) AS end_ts FROM ride_points r JOIN rides_in_period rp ON r.ride_id = rp.ride_id GROUP BY r.ride_id) SELECT AVG(rs.end_ts - rs.start_ts) AS avg_duration FROM ride_stats rs JOIN ride_points rend ON rend.ride_id = rs.ride_id AND rend.timestamp = rs.end_ts JOIN universities u ON ST_DWithin(rend.geom, u.geom, 2500) WHERE u.name = 'Charité-Campus-Klinik';
  params:
  - - '2023-08-27 10:26:57'
    - '2023-09-01 21:29:22'
  - Charité-Campus-Klinik
