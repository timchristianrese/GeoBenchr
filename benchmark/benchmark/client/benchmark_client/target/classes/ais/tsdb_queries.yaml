- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-09-05 04:35:17', '2019-09-10 22:08:06'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-09-05 04:35:17'
    - '2019-09-10 22:08:06'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Patroklos' GROUP BY i.name;
  params:
  - Patroklos
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'LAVRIO' AND cd.end_time > '2019-01-07 20:30:08' AND '2019-01-01 00:00:01' > cd.start_time;
  params:
  - LAVRIO
  - - '2019-01-01 00:00:01'
    - '2019-01-07 20:30:08'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Ydrousa' GROUP BY i.name;
  params:
  - Ydrousa
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Aponissos' GROUP BY i.name;
  params:
  - Aponissos
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'ALIMOS' AND cd.end_time > '2019-01-07 07:07:12' AND '2019-01-01 00:00:01' > cd.start_time;
  params:
  - ALIMOS
  - - '2019-01-01 00:00:01'
    - '2019-01-07 07:07:12'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-07-25 11:40:23', '2019-08-04 07:50:40'];
  params:
  - - '2019-07-25 11:40:23'
    - '2019-08-04 07:50:40'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'SOUSAKI' AND cd.end_time > '2019-04-10 07:32:10' AND '2019-03-28 03:44:46' > cd.start_time;
  params:
  - SOUSAKI
  - - '2019-03-28 03:44:46'
    - '2019-04-10 07:32:10'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 6 AND DATE(st.start_ts) = DATE '2019-01-08';
  params:
  - '2019-01-08'
  - 6
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-11-27 16:52:23', '2019-11-30 13:41:01'];
  params:
  - - '2019-11-27 16:52:23'
    - '2019-11-30 13:41:01'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'CORINTH' AND cd.end_time > '2019-09-29 02:09:26' AND '2019-09-16 00:53:21' > cd.start_time;
  params:
  - CORINTH
  - - '2019-09-16 00:53:21'
    - '2019-09-29 02:09:26'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'PERAMA' AND cd.end_time > '2019-03-28 12:15:26' AND '2019-03-21 09:38:31' > cd.start_time;
  params:
  - PERAMA
  - - '2019-03-21 09:38:31'
    - '2019-03-28 12:15:26'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'PIRAEUS' AND cd.end_time > '2019-01-28 05:44:49' AND '2019-01-24 06:02:56' > cd.start_time;
  params:
  - PIRAEUS
  - - '2019-01-24 06:02:56'
    - '2019-01-28 05:44:49'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-06-07 06:47:56', '2019-06-13 06:56:21'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-06-07 06:47:56'
    - '2019-06-13 06:56:21'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-04-08 23:46:13', '2019-04-19 23:32:55'];
  params:
  - - '2019-04-08 23:46:13'
    - '2019-04-19 23:32:55'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 6 AND DATE(st.start_ts) = DATE '2019-03-05';
  params:
  - '2019-03-05'
  - 6
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'AGISTRI' AND h_end.name = 'ERMIONI';
  params:
  - AGISTRI
  - ERMIONI
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'ERMIONI' AND cd.end_time > '2019-04-10 08:36:16' AND '2019-03-31 04:11:40' > cd.start_time;
  params:
  - ERMIONI
  - - '2019-03-31 04:11:40'
    - '2019-04-10 08:36:16'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 3 AND DATE(st.start_ts) = DATE '2019-01-10';
  params:
  - '2019-01-10'
  - 3
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-12-16 16:29:08', '2019-12-24 05:58:31'];
  params:
  - - '2019-12-16 16:29:08'
    - '2019-12-24 05:58:31'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Lagousa' GROUP BY i.name;
  params:
  - Lagousa
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Nisis Lagousa' GROUP BY i.name;
  params:
  - Nisis Lagousa
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-01-10 18:14:38', '2019-01-16 17:49:49'];
  params:
  - - '2019-01-10 18:14:38'
    - '2019-01-16 17:49:49'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-11-05 14:21:38', '2019-11-18 12:57:35'];
  params:
  - - '2019-11-05 14:21:38'
    - '2019-11-18 12:57:35'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Nisis Islet' GROUP BY i.name;
  params:
  - Nisis Islet
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'ELEFSIS' AND cd.end_time > '2019-10-12 14:26:37' AND '2019-10-06 17:07:24' > cd.start_time;
  params:
  - ELEFSIS
  - - '2019-10-06 17:07:24'
    - '2019-10-12 14:26:37'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Plateia' GROUP BY i.name;
  params:
  - Plateia
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'ASPROPYRGOS' AND h_end.name = 'AEGINA';
  params:
  - ASPROPYRGOS
  - AEGINA
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Agios Thomas' GROUP BY i.name;
  params:
  - Agios Thomas
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 12 AND DATE(st.start_ts) = DATE '2019-06-21';
  params:
  - '2019-06-21'
  - 12
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 0 AND DATE(st.start_ts) = DATE '2019-03-20';
  params:
  - '2019-03-20'
  - 0
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 16 AND DATE(st.start_ts) = DATE '2019-05-26';
  params:
  - '2019-05-26'
  - 16
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-09-20 04:27:32', '2019-09-23 07:26:59'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-09-20 04:27:32'
    - '2019-09-23 07:26:59'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-11-19 12:44:29', '2019-11-27 11:47:10'];
  params:
  - - '2019-11-19 12:44:29'
    - '2019-11-27 11:47:10'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-12-20 22:31:38', '2019-12-31 23:59:59'];
  params:
  - - '2019-12-20 22:31:38'
    - '2019-12-31 23:59:59'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'PERAMA' AND cd.end_time > '2019-10-13 11:11:54' AND '2019-10-09 07:37:54' > cd.start_time;
  params:
  - PERAMA
  - - '2019-10-09 07:37:54'
    - '2019-10-13 11:11:54'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-07-06 03:55:55', '2019-07-11 19:23:52'];
  params:
  - - '2019-07-06 03:55:55'
    - '2019-07-11 19:23:52'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'AGIOI THEODORI' AND h_end.name = 'AEGINA';
  params:
  - AGIOI THEODORI
  - AEGINA
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'CORINTH' AND h_end.name = 'ALIMOS';
  params:
  - CORINTH
  - ALIMOS
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Patroklos' GROUP BY i.name;
  params:
  - Patroklos
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-06-25 11:31:38', '2019-07-06 14:24:26'];
  params:
  - - '2019-06-25 11:31:38'
    - '2019-07-06 14:24:26'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 6 AND DATE(st.start_ts) = DATE '2019-07-06';
  params:
  - '2019-07-06'
  - 6
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Ovrios' GROUP BY i.name;
  params:
  - Ovrios
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-10-05 16:44:23', '2019-10-10 05:07:07'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-10-05 16:44:23'
    - '2019-10-10 05:07:07'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-11-01 19:06:50', '2019-11-04 04:46:19'];
  params:
  - - '2019-11-01 19:06:50'
    - '2019-11-04 04:46:19'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Agios Thomas' GROUP BY i.name;
  params:
  - Agios Thomas
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Nisis Bisti' GROUP BY i.name;
  params:
  - Nisis Bisti
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-05-17 12:22:08', '2019-05-29 17:38:35'];
  params:
  - - '2019-05-17 12:22:08'
    - '2019-05-29 17:38:35'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-03-05 08:05:05', '2019-03-14 18:27:11'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-03-05 08:05:05'
    - '2019-03-14 18:27:11'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Plateia' GROUP BY i.name;
  params:
  - Plateia
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-11-16 10:01:07', '2019-11-23 04:21:12'];
  params:
  - - '2019-11-16 10:01:07'
    - '2019-11-23 04:21:12'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Spalaphtronisi Islet' GROUP BY i.name;
  params:
  - Spalaphtronisi Islet
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Nisis Stakhtorroyi' GROUP BY i.name;
  params:
  - Nisis Stakhtorroyi
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'ELEFSIS' AND cd.end_time > '2019-05-16 20:10:59' AND '2019-05-11 05:13:17' > cd.start_time;
  params:
  - ELEFSIS
  - - '2019-05-11 05:13:17'
    - '2019-05-16 20:10:59'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'CORINTH' AND h_end.name = 'ASPROPYRGOS';
  params:
  - CORINTH
  - ASPROPYRGOS
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-03-25 05:17:30', '2019-03-30 12:27:47'];
  params:
  - - '2019-03-25 05:17:30'
    - '2019-03-30 12:27:47'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'LAVRIO' AND cd.end_time > '2019-08-02 05:02:50' AND '2019-07-21 18:13:53' > cd.start_time;
  params:
  - LAVRIO
  - - '2019-07-21 18:13:53'
    - '2019-08-02 05:02:50'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'GLYFADA' AND cd.end_time > '2019-03-13 07:08:44' AND '2019-03-08 05:34:30' > cd.start_time;
  params:
  - GLYFADA
  - - '2019-03-08 05:34:30'
    - '2019-03-13 07:08:44'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 10 AND DATE(st.start_ts) = DATE '2019-03-03';
  params:
  - '2019-03-03'
  - 10
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'PIRAEUS' AND h_end.name = 'ERMIONI';
  params:
  - PIRAEUS
  - ERMIONI
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 21 AND DATE(st.start_ts) = DATE '2019-01-03';
  params:
  - '2019-01-03'
  - 21
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'FALIRO' AND h_end.name = 'CORINTH';
  params:
  - FALIRO
  - CORINTH
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-10-27 17:17:44', '2019-10-31 23:27:24'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-10-27 17:17:44'
    - '2019-10-31 23:27:24'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Anagnostis' GROUP BY i.name;
  params:
  - Anagnostis
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-02-25 16:12:12', '2019-03-07 09:46:59'];
  params:
  - - '2019-02-25 16:12:12'
    - '2019-03-07 09:46:59'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'PERAMA' AND cd.end_time > '2019-09-14 16:55:46' AND '2019-09-11 04:55:43' > cd.start_time;
  params:
  - PERAMA
  - - '2019-09-11 04:55:43'
    - '2019-09-14 16:55:46'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'AGIOS KOSMAS' AND cd.end_time > '2019-10-20 21:43:51' AND '2019-10-16 01:42:16' > cd.start_time;
  params:
  - AGIOS KOSMAS
  - - '2019-10-16 01:42:16'
    - '2019-10-20 21:43:51'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Nisis Pachaki' GROUP BY i.name;
  params:
  - Nisis Pachaki
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Makronisos' GROUP BY i.name;
  params:
  - Makronisos
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'ASPROPYRGOS' AND cd.end_time > '2019-07-23 20:44:52' AND '2019-07-11 20:41:51' > cd.start_time;
  params:
  - ASPROPYRGOS
  - - '2019-07-11 20:41:51'
    - '2019-07-23 20:44:52'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Nisis Islet' GROUP BY i.name;
  params:
  - Nisis Islet
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-09-02 19:47:34', '2019-09-05 05:28:26'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-09-02 19:47:34'
    - '2019-09-05 05:28:26'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 16 AND DATE(st.start_ts) = DATE '2019-10-14';
  params:
  - '2019-10-14'
  - 16
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-07-14 11:33:36', '2019-07-22 00:25:02'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-07-14 11:33:36'
    - '2019-07-22 00:25:02'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 7 AND DATE(st.start_ts) = DATE '2019-02-28';
  params:
  - '2019-02-28'
  - 7
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 18 AND DATE(st.start_ts) = DATE '2019-11-25';
  params:
  - '2019-11-25'
  - 18
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'PIRAEUS' AND cd.end_time > '2019-04-14 10:56:26' AND '2019-04-10 18:50:45' > cd.start_time;
  params:
  - PIRAEUS
  - - '2019-04-10 18:50:45'
    - '2019-04-14 10:56:26'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'ERMIONI' AND cd.end_time > '2019-02-07 09:45:47' AND '2019-01-30 03:50:56' > cd.start_time;
  params:
  - ERMIONI
  - - '2019-01-30 03:50:56'
    - '2019-02-07 09:45:47'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'PIRAEUS' AND cd.end_time > '2019-09-04 00:27:36' AND '2019-08-23 01:23:29' > cd.start_time;
  params:
  - PIRAEUS
  - - '2019-08-23 01:23:29'
    - '2019-09-04 00:27:36'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'ZEA' AND h_end.name = 'CORINTH';
  params:
  - ZEA
  - CORINTH
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-04-01 17:00:14', '2019-04-07 20:06:32'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-04-01 17:00:14'
    - '2019-04-07 20:06:32'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 7 AND DATE(st.start_ts) = DATE '2019-03-11';
  params:
  - '2019-03-11'
  - 7
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'SOUSAKI' AND cd.end_time > '2019-04-13 14:36:28' AND '2019-04-08 22:30:44' > cd.start_time;
  params:
  - SOUSAKI
  - - '2019-04-08 22:30:44'
    - '2019-04-13 14:36:28'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-11-09 14:30:50', '2019-11-16 20:47:38'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-11-09 14:30:50'
    - '2019-11-16 20:47:38'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Kourmouloudes' GROUP BY i.name;
  params:
  - Kourmouloudes
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'GLYFADA' AND cd.end_time > '2019-05-27 01:24:50' AND '2019-05-24 17:41:00' > cd.start_time;
  params:
  - GLYFADA
  - - '2019-05-24 17:41:00'
    - '2019-05-27 01:24:50'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Phleva Island' GROUP BY i.name;
  params:
  - Phleva Island
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 7 AND DATE(st.start_ts) = DATE '2019-12-24';
  params:
  - '2019-12-24'
  - 7
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'PERAMA' AND cd.end_time > '2019-08-19 08:46:07' AND '2019-08-13 17:00:24' > cd.start_time;
  params:
  - PERAMA
  - - '2019-08-13 17:00:24'
    - '2019-08-19 08:46:07'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Gaidaros' GROUP BY i.name;
  params:
  - Gaidaros
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-04-03 19:04:14', '2019-04-05 21:42:20'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-04-03 19:04:14'
    - '2019-04-05 21:42:20'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'ZEA' AND h_end.name = 'CORINTH CANAL';
  params:
  - ZEA
  - CORINTH CANAL
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 17 AND DATE(st.start_ts) = DATE '2019-07-22';
  params:
  - '2019-07-22'
  - 17
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-01-14 13:50:19', '2019-01-28 02:51:37'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-01-14 13:50:19'
    - '2019-01-28 02:51:37'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-01-21 06:17:34', '2019-01-25 08:22:32'];
  params:
  - - '2019-01-21 06:17:34'
    - '2019-01-25 08:22:32'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-09-07 03:48:13', '2019-09-18 01:18:12'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-09-07 03:48:13'
    - '2019-09-18 01:18:12'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'AGISTRI' AND h_end.name = 'PIRAEUS';
  params:
  - AGISTRI
  - PIRAEUS
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'RAFINA' AND cd.end_time > '2019-12-04 14:39:14' AND '2019-11-24 13:23:47' > cd.start_time;
  params:
  - RAFINA
  - - '2019-11-24 13:23:47'
    - '2019-12-04 14:39:14'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-04-18 23:51:20', '2019-04-21 02:34:50'];
  params:
  - - '2019-04-18 23:51:20'
    - '2019-04-21 02:34:50'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'AGIOS KOSMAS' AND cd.end_time > '2019-09-10 00:19:50' AND '2019-09-04 01:39:20' > cd.start_time;
  params:
  - AGIOS KOSMAS
  - - '2019-09-04 01:39:20'
    - '2019-09-10 00:19:50'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 21 AND DATE(st.start_ts) = DATE '2019-12-08';
  params:
  - '2019-12-08'
  - 21
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-05-06 12:28:15', '2019-05-21 01:28:41'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-05-06 12:28:15'
    - '2019-05-21 01:28:41'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Thorussa' GROUP BY i.name;
  params:
  - Thorussa
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 22 AND DATE(st.start_ts) = DATE '2019-12-26';
  params:
  - '2019-12-26'
  - 22
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'AGISTRI' AND h_end.name = 'FANEROMENI';
  params:
  - AGISTRI
  - FANEROMENI
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Nisis Ledou' GROUP BY i.name;
  params:
  - Nisis Ledou
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-12-15 18:24:15', '2019-12-23 22:06:05'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-12-15 18:24:15'
    - '2019-12-23 22:06:05'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'ELEFSIS' AND cd.end_time > '2019-06-29 20:14:27' AND '2019-06-27 01:52:42' > cd.start_time;
  params:
  - ELEFSIS
  - - '2019-06-27 01:52:42'
    - '2019-06-29 20:14:27'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-03-25 02:39:45', '2019-04-01 10:07:42'];
  params:
  - - '2019-03-25 02:39:45'
    - '2019-04-01 10:07:42'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'AGISTRI' AND h_end.name = 'ZEA';
  params:
  - AGISTRI
  - ZEA
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-08-06 23:53:10', '2019-08-10 09:26:10'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-08-06 23:53:10'
    - '2019-08-10 09:26:10'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Spalaphtronisi Islet' GROUP BY i.name;
  params:
  - Spalaphtronisi Islet
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-10-06 10:19:47', '2019-10-14 09:24:44'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-10-06 10:19:47'
    - '2019-10-14 09:24:44'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 6 AND DATE(st.start_ts) = DATE '2019-10-20';
  params:
  - '2019-10-20'
  - 6
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'SOUSAKI' AND h_end.name = 'ASPROPYRGOS';
  params:
  - SOUSAKI
  - ASPROPYRGOS
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'ZEA' AND cd.end_time > '2019-04-18 09:35:03' AND '2019-04-13 06:17:23' > cd.start_time;
  params:
  - ZEA
  - - '2019-04-13 06:17:23'
    - '2019-04-18 09:35:03'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-08-17 17:32:19', '2019-08-22 08:36:37'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-08-17 17:32:19'
    - '2019-08-22 08:36:37'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Aegina Moni' GROUP BY i.name;
  params:
  - Aegina Moni
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'FALIRO' AND cd.end_time > '2019-02-17 11:30:31' AND '2019-02-10 20:16:27' > cd.start_time;
  params:
  - FALIRO
  - - '2019-02-10 20:16:27'
    - '2019-02-17 11:30:31'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'AGISTRI' AND h_end.name = 'ALIMOS';
  params:
  - AGISTRI
  - ALIMOS
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'AGISTRI' AND cd.end_time > '2019-07-30 19:29:10' AND '2019-07-18 12:10:05' > cd.start_time;
  params:
  - AGISTRI
  - - '2019-07-18 12:10:05'
    - '2019-07-30 19:29:10'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'FALIRO' AND cd.end_time > '2019-09-06 20:50:37' AND '2019-09-03 14:54:40' > cd.start_time;
  params:
  - FALIRO
  - - '2019-09-03 14:54:40'
    - '2019-09-06 20:50:37'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'RAFINA' AND h_end.name = 'RAFINA';
  params:
  - RAFINA
  - RAFINA
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'ERMIONI' AND h_end.name = 'PERAMA';
  params:
  - ERMIONI
  - PERAMA
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 8 AND DATE(st.start_ts) = DATE '2019-07-02';
  params:
  - '2019-07-02'
  - 8
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'CORINTH CANAL' AND cd.end_time > '2019-01-06 17:22:07' AND '2019-01-01 00:00:01' > cd.start_time;
  params:
  - CORINTH CANAL
  - - '2019-01-01 00:00:01'
    - '2019-01-06 17:22:07'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'ALIMOS' AND cd.end_time > '2019-03-10 17:26:48' AND '2019-02-28 03:19:48' > cd.start_time;
  params:
  - ALIMOS
  - - '2019-02-28 03:19:48'
    - '2019-03-10 17:26:48'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 11 AND DATE(st.start_ts) = DATE '2019-06-15';
  params:
  - '2019-06-15'
  - 11
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'SOUSAKI' AND h_end.name = 'AGIOS KOSMAS';
  params:
  - SOUSAKI
  - AGIOS KOSMAS
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-01-05 18:57:56', '2019-01-18 08:26:56'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-01-05 18:57:56'
    - '2019-01-18 08:26:56'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 13 AND DATE(st.start_ts) = DATE '2019-03-03';
  params:
  - '2019-03-03'
  - 13
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-02-07 12:44:19', '2019-02-13 20:12:44'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-02-07 12:44:19'
    - '2019-02-13 20:12:44'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 20 AND DATE(st.start_ts) = DATE '2019-06-17';
  params:
  - '2019-06-17'
  - 20
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-11-15 02:01:21', '2019-11-25 17:26:27'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-11-15 02:01:21'
    - '2019-11-25 17:26:27'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 6 AND DATE(st.start_ts) = DATE '2019-04-25';
  params:
  - '2019-04-25'
  - 6
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'SIRI' AND h_end.name = 'ERMIONI';
  params:
  - SIRI
  - ERMIONI
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Phlevopoula' GROUP BY i.name;
  params:
  - Phlevopoula
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 2 AND DATE(st.start_ts) = DATE '2019-08-04';
  params:
  - '2019-08-04'
  - 2
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Ydrousa' GROUP BY i.name;
  params:
  - Ydrousa
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-03-21 14:09:24', '2019-03-23 17:25:57'];
  params:
  - - '2019-03-21 14:09:24'
    - '2019-03-23 17:25:57'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-08-30 08:12:24', '2019-09-02 19:19:49'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-08-30 08:12:24'
    - '2019-09-02 19:19:49'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Arsida' GROUP BY i.name;
  params:
  - Arsida
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Salamina' GROUP BY i.name;
  params:
  - Salamina
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'AGIOI THEODORI' AND h_end.name = 'CORINTH CANAL';
  params:
  - AGIOI THEODORI
  - CORINTH CANAL
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-11-12 13:43:43', '2019-11-18 09:44:59'];
  params:
  - - '2019-11-12 13:43:43'
    - '2019-11-18 09:44:59'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 12 AND DATE(st.start_ts) = DATE '2019-11-28';
  params:
  - '2019-11-28'
  - 12
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'ASPROPYRGOS' AND h_end.name = 'AGIOI THEODORI';
  params:
  - ASPROPYRGOS
  - AGIOI THEODORI
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-11-24 13:41:27', '2019-11-28 04:03:25'];
  params:
  - - '2019-11-24 13:41:27'
    - '2019-11-28 04:03:25'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 16 AND DATE(st.start_ts) = DATE '2019-12-22';
  params:
  - '2019-12-22'
  - 16
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-04-28 06:37:05', '2019-05-08 02:58:53'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-04-28 06:37:05'
    - '2019-05-08 02:58:53'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'FANEROMENI' AND cd.end_time > '2019-04-16 12:35:22' AND '2019-04-03 02:13:52' > cd.start_time;
  params:
  - FANEROMENI
  - - '2019-04-03 02:13:52'
    - '2019-04-16 12:35:22'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 2 AND DATE(st.start_ts) = DATE '2019-06-30';
  params:
  - '2019-06-30'
  - 2
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 3 AND DATE(st.start_ts) = DATE '2019-05-18';
  params:
  - '2019-05-18'
  - 3
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-02-24 09:05:36', '2019-03-11 04:00:59'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-02-24 09:05:36'
    - '2019-03-11 04:00:59'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-10-22 10:22:16', '2019-10-24 17:47:23'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-10-22 10:22:16'
    - '2019-10-24 17:47:23'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Aponissos' GROUP BY i.name;
  params:
  - Aponissos
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-04-01 17:28:43', '2019-04-16 02:19:52'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-04-01 17:28:43'
    - '2019-04-16 02:19:52'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Phlevopoula' GROUP BY i.name;
  params:
  - Phlevopoula
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 8 AND DATE(st.start_ts) = DATE '2019-01-27';
  params:
  - '2019-01-27'
  - 8
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-05-09 21:06:04', '2019-05-17 07:24:29'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-05-09 21:06:04'
    - '2019-05-17 07:24:29'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-06-07 20:51:32', '2019-06-17 23:51:04'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-06-07 20:51:32'
    - '2019-06-17 23:51:04'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-01-16 23:15:20', '2019-01-21 04:54:43'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-01-16 23:15:20'
    - '2019-01-21 04:54:43'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Aponissos' GROUP BY i.name;
  params:
  - Aponissos
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-07-24 07:21:35', '2019-08-06 16:17:37'];
  params:
  - - '2019-07-24 07:21:35'
    - '2019-08-06 16:17:37'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-06-24 03:22:31', '2019-06-29 19:31:35'];
  params:
  - - '2019-06-24 03:22:31'
    - '2019-06-29 19:31:35'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'RAFINA' AND h_end.name = 'CORINTH CANAL';
  params:
  - RAFINA
  - CORINTH CANAL
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'LAVRIO' AND h_end.name = 'ZEA';
  params:
  - LAVRIO
  - ZEA
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-02-01 04:18:07', '2019-02-16 01:58:52'];
  params:
  - - '2019-02-01 04:18:07'
    - '2019-02-16 01:58:52'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-08-02 01:34:09', '2019-08-14 15:13:06'];
  params:
  - - '2019-08-02 01:34:09'
    - '2019-08-14 15:13:06'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'LAVRIO' AND h_end.name = 'ZEA';
  params:
  - LAVRIO
  - ZEA
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Nisis Lagousa' GROUP BY i.name;
  params:
  - Nisis Lagousa
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'PIRAEUS' AND h_end.name = 'SIRI';
  params:
  - PIRAEUS
  - SIRI
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'GLYFADA' AND h_end.name = 'RAFINA';
  params:
  - GLYFADA
  - RAFINA
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'LAVRIO' AND h_end.name = 'RAFINA';
  params:
  - LAVRIO
  - RAFINA
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-03-02 18:07:55', '2019-03-16 17:03:13'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-03-02 18:07:55'
    - '2019-03-16 17:03:13'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'ASPROPYRGOS' AND cd.end_time > '2019-02-26 09:15:30' AND '2019-02-23 16:11:14' > cd.start_time;
  params:
  - ASPROPYRGOS
  - - '2019-02-23 16:11:14'
    - '2019-02-26 09:15:30'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'AGISTRI' AND cd.end_time > '2019-02-15 13:27:47' AND '2019-02-03 14:03:35' > cd.start_time;
  params:
  - AGISTRI
  - - '2019-02-03 14:03:35'
    - '2019-02-15 13:27:47'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 16 AND DATE(st.start_ts) = DATE '2019-04-03';
  params:
  - '2019-04-03'
  - 16
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 13 AND DATE(st.start_ts) = DATE '2019-06-06';
  params:
  - '2019-06-06'
  - 13
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-07-15 20:06:40', '2019-07-26 13:18:48'];
  params:
  - - '2019-07-15 20:06:40'
    - '2019-07-26 13:18:48'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Agios Thomas' GROUP BY i.name;
  params:
  - Agios Thomas
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-03-29 02:21:20', '2019-04-02 07:26:15'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-03-29 02:21:20'
    - '2019-04-02 07:26:15'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'AGIOS KOSMAS' AND cd.end_time > '2019-12-31 23:59:59' AND '2019-12-31 17:51:16' > cd.start_time;
  params:
  - AGIOS KOSMAS
  - - '2019-12-31 17:51:16'
    - '2019-12-31 23:59:59'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'FANEROMENI' AND cd.end_time > '2019-01-30 05:00:20' AND '2019-01-20 04:53:25' > cd.start_time;
  params:
  - FANEROMENI
  - - '2019-01-20 04:53:25'
    - '2019-01-30 05:00:20'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Plateia' GROUP BY i.name;
  params:
  - Plateia
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-11-29 23:36:50', '2019-12-06 07:44:35'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-11-29 23:36:50'
    - '2019-12-06 07:44:35'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-01-21 10:02:16', '2019-02-02 22:36:31'];
  params:
  - - '2019-01-21 10:02:16'
    - '2019-02-02 22:36:31'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'GLYFADA' AND cd.end_time > '2019-04-23 16:28:27' AND '2019-04-21 05:30:39' > cd.start_time;
  params:
  - GLYFADA
  - - '2019-04-21 05:30:39'
    - '2019-04-23 16:28:27'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-06-11 07:35:49', '2019-06-20 02:57:18'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-06-11 07:35:49'
    - '2019-06-20 02:57:18'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-06-04 08:29:40', '2019-06-15 06:18:50'];
  params:
  - - '2019-06-04 08:29:40'
    - '2019-06-15 06:18:50'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'PIRAEUS' AND h_end.name = 'GLYFADA';
  params:
  - PIRAEUS
  - GLYFADA
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 15 AND DATE(st.start_ts) = DATE '2019-04-30';
  params:
  - '2019-04-30'
  - 15
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'ASPROPYRGOS' AND cd.end_time > '2019-04-18 12:17:54' AND '2019-04-13 22:06:05' > cd.start_time;
  params:
  - ASPROPYRGOS
  - - '2019-04-13 22:06:05'
    - '2019-04-18 12:17:54'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Pachi' GROUP BY i.name;
  params:
  - Pachi
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-03-03 04:22:38', '2019-03-16 06:20:18'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-03-03 04:22:38'
    - '2019-03-16 06:20:18'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-08-06 14:43:03', '2019-08-20 18:04:32'];
  params:
  - - '2019-08-06 14:43:03'
    - '2019-08-20 18:04:32'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'AGISTRI' AND cd.end_time > '2019-12-14 15:40:16' AND '2019-12-02 05:49:27' > cd.start_time;
  params:
  - AGISTRI
  - - '2019-12-02 05:49:27'
    - '2019-12-14 15:40:16'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'AEGINA' AND h_end.name = 'GLYFADA';
  params:
  - AEGINA
  - GLYFADA
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-07-12 21:14:54', '2019-07-18 00:18:33'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-07-12 21:14:54'
    - '2019-07-18 00:18:33'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'ERMIONI' AND h_end.name = 'ELEFSIS';
  params:
  - ERMIONI
  - ELEFSIS
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 13 AND DATE(st.start_ts) = DATE '2019-05-24';
  params:
  - '2019-05-24'
  - 13
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'ALIMOS' AND h_end.name = 'FLISVOS';
  params:
  - ALIMOS
  - FLISVOS
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-10-22 20:56:05', '2019-10-25 19:27:46'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-10-22 20:56:05'
    - '2019-10-25 19:27:46'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-02-26 00:06:43', '2019-03-05 02:43:11'];
  params:
  - - '2019-02-26 00:06:43'
    - '2019-03-05 02:43:11'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Trakhyli' GROUP BY i.name;
  params:
  - Trakhyli
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 3 AND DATE(st.start_ts) = DATE '2019-08-14';
  params:
  - '2019-08-14'
  - 3
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 19 AND DATE(st.start_ts) = DATE '2019-06-24';
  params:
  - '2019-06-24'
  - 19
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Kanakia' GROUP BY i.name;
  params:
  - Kanakia
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 20 AND DATE(st.start_ts) = DATE '2019-10-26';
  params:
  - '2019-10-26'
  - 20
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'AGISTRI' AND h_end.name = 'RAFINA';
  params:
  - AGISTRI
  - RAFINA
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Nisis Metopi' GROUP BY i.name;
  params:
  - Nisis Metopi
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Nisis Bisti' GROUP BY i.name;
  params:
  - Nisis Bisti
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'ASPROPYRGOS' AND h_end.name = 'RAFINA';
  params:
  - ASPROPYRGOS
  - RAFINA
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Salamina' GROUP BY i.name;
  params:
  - Salamina
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'ZEA' AND h_end.name = 'FLISVOS';
  params:
  - ZEA
  - FLISVOS
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-08-09 02:37:44', '2019-08-12 14:42:49'];
  params:
  - - '2019-08-09 02:37:44'
    - '2019-08-12 14:42:49'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 0 AND DATE(st.start_ts) = DATE '2019-03-01';
  params:
  - '2019-03-01'
  - 0
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 11 AND DATE(st.start_ts) = DATE '2019-08-27';
  params:
  - '2019-08-27'
  - 11
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-07-31 17:57:01', '2019-08-11 22:16:56'];
  params:
  - - '2019-07-31 17:57:01'
    - '2019-08-11 22:16:56'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-04-18 23:32:01', '2019-04-28 06:38:13'];
  params:
  - - '2019-04-18 23:32:01'
    - '2019-04-28 06:38:13'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Poros' GROUP BY i.name;
  params:
  - Poros
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Revithousa' GROUP BY i.name;
  params:
  - Revithousa
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-08-09 03:37:14', '2019-08-13 16:43:12'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-08-09 03:37:14'
    - '2019-08-13 16:43:12'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 14 AND DATE(st.start_ts) = DATE '2019-01-28';
  params:
  - '2019-01-28'
  - 14
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-01-21 00:27:53', '2019-02-02 08:56:24'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-01-21 00:27:53'
    - '2019-02-02 08:56:24'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-01-18 04:37:39', '2019-01-27 20:14:07'];
  params:
  - - '2019-01-18 04:37:39'
    - '2019-01-27 20:14:07'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'PERAMA' AND cd.end_time > '2019-12-03 16:02:54' AND '2019-11-21 05:25:32' > cd.start_time;
  params:
  - PERAMA
  - - '2019-11-21 05:25:32'
    - '2019-12-03 16:02:54'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Kordeliaris' GROUP BY i.name;
  params:
  - Kordeliaris
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-08-20 12:49:18', '2019-09-03 16:38:29'];
  params:
  - - '2019-08-20 12:49:18'
    - '2019-09-03 16:38:29'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'AGISTRI' AND h_end.name = 'GLYFADA';
  params:
  - AGISTRI
  - GLYFADA
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-09-25 03:10:33', '2019-10-03 06:06:40'];
  params:
  - - '2019-09-25 03:10:33'
    - '2019-10-03 06:06:40'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-12-28 09:48:36', '2019-12-31 23:59:59'];
  params:
  - - '2019-12-28 09:48:36'
    - '2019-12-31 23:59:59'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-12-09 08:36:40', '2019-12-17 01:23:31'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-12-09 08:36:40'
    - '2019-12-17 01:23:31'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'ERMIONI' AND cd.end_time > '2019-02-27 12:16:10' AND '2019-02-18 10:13:16' > cd.start_time;
  params:
  - ERMIONI
  - - '2019-02-18 10:13:16'
    - '2019-02-27 12:16:10'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Aegina Moni' GROUP BY i.name;
  params:
  - Aegina Moni
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'AGISTRI' AND cd.end_time > '2019-01-16 01:44:52' AND '2019-01-09 00:40:25' > cd.start_time;
  params:
  - AGISTRI
  - - '2019-01-09 00:40:25'
    - '2019-01-16 01:44:52'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 15 AND DATE(st.start_ts) = DATE '2019-11-16';
  params:
  - '2019-11-16'
  - 15
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'ERMIONI' AND h_end.name = 'RAFINA';
  params:
  - ERMIONI
  - RAFINA
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'AGIOI THEODORI' AND cd.end_time > '2019-06-26 20:58:51' AND '2019-06-14 22:06:25' > cd.start_time;
  params:
  - AGIOI THEODORI
  - - '2019-06-14 22:06:25'
    - '2019-06-26 20:58:51'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'AGIOS KOSMAS' AND cd.end_time > '2019-12-31 23:59:59' AND '2019-12-26 01:36:44' > cd.start_time;
  params:
  - AGIOS KOSMAS
  - - '2019-12-26 01:36:44'
    - '2019-12-31 23:59:59'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'AEGINA' AND cd.end_time > '2019-02-16 23:56:59' AND '2019-02-14 02:37:56' > cd.start_time;
  params:
  - AEGINA
  - - '2019-02-14 02:37:56'
    - '2019-02-16 23:56:59'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-05-21 00:55:29', '2019-05-24 08:05:57'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-05-21 00:55:29'
    - '2019-05-24 08:05:57'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-07-30 04:47:08', '2019-08-10 17:24:53'];
  params:
  - - '2019-07-30 04:47:08'
    - '2019-08-10 17:24:53'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'FLISVOS' AND cd.end_time > '2019-12-27 14:46:16' AND '2019-12-18 22:57:12' > cd.start_time;
  params:
  - FLISVOS
  - - '2019-12-18 22:57:12'
    - '2019-12-27 14:46:16'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-11-03 01:10:42', '2019-11-10 12:13:11'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-11-03 01:10:42'
    - '2019-11-10 12:13:11'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'ERMIONI' AND cd.end_time > '2019-02-27 21:45:47' AND '2019-02-21 14:45:24' > cd.start_time;
  params:
  - ERMIONI
  - - '2019-02-21 14:45:24'
    - '2019-02-27 21:45:47'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'GLYFADA' AND cd.end_time > '2019-01-07 09:56:35' AND '2019-01-04 10:16:12' > cd.start_time;
  params:
  - GLYFADA
  - - '2019-01-04 10:16:12'
    - '2019-01-07 09:56:35'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 8 AND DATE(st.start_ts) = DATE '2019-11-22';
  params:
  - '2019-11-22'
  - 8
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-01-13 16:29:13', '2019-01-26 19:56:40'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-01-13 16:29:13'
    - '2019-01-26 19:56:40'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Lagousa' GROUP BY i.name;
  params:
  - Lagousa
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'ELEFSIS' AND cd.end_time > '2019-04-22 13:19:02' AND '2019-04-14 09:26:33' > cd.start_time;
  params:
  - ELEFSIS
  - - '2019-04-14 09:26:33'
    - '2019-04-22 13:19:02'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-10-06 05:40:21', '2019-10-17 17:47:34'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-10-06 05:40:21'
    - '2019-10-17 17:47:34'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-03-12 05:12:18', '2019-03-26 00:53:36'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-03-12 05:12:18'
    - '2019-03-26 00:53:36'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'FALIRO' AND h_end.name = 'AEGINA';
  params:
  - FALIRO
  - AEGINA
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'AEGINA' AND h_end.name = 'AEGINA';
  params:
  - AEGINA
  - AEGINA
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'AGIOS KOSMAS' AND cd.end_time > '2019-03-13 06:10:42' AND '2019-03-09 13:30:04' > cd.start_time;
  params:
  - AGIOS KOSMAS
  - - '2019-03-09 13:30:04'
    - '2019-03-13 06:10:42'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 19 AND DATE(st.start_ts) = DATE '2019-04-18';
  params:
  - '2019-04-18'
  - 19
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 15 AND DATE(st.start_ts) = DATE '2019-05-12';
  params:
  - '2019-05-12'
  - 15
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-10-19 15:11:30', '2019-11-03 02:58:51'];
  params:
  - - '2019-10-19 15:11:30'
    - '2019-11-03 02:58:51'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Nisis Metopi' GROUP BY i.name;
  params:
  - Nisis Metopi
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-06-13 06:52:58', '2019-06-19 04:29:08'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-06-13 06:52:58'
    - '2019-06-19 04:29:08'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Plateia' GROUP BY i.name;
  params:
  - Plateia
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'FANEROMENI' AND cd.end_time > '2019-06-22 16:13:52' AND '2019-06-09 11:50:29' > cd.start_time;
  params:
  - FANEROMENI
  - - '2019-06-09 11:50:29'
    - '2019-06-22 16:13:52'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'LAVRIO' AND h_end.name = 'PIRAEUS';
  params:
  - LAVRIO
  - PIRAEUS
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-05-01 09:54:01', '2019-05-11 07:55:53'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-05-01 09:54:01'
    - '2019-05-11 07:55:53'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 22 AND DATE(st.start_ts) = DATE '2019-10-11';
  params:
  - '2019-10-11'
  - 22
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-02-16 07:57:09', '2019-02-26 01:35:22'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-02-16 07:57:09'
    - '2019-02-26 01:35:22'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-07-21 20:06:00', '2019-08-03 20:34:05'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-07-21 20:06:00'
    - '2019-08-03 20:34:05'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 2 AND DATE(st.start_ts) = DATE '2019-04-12';
  params:
  - '2019-04-12'
  - 2
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 20 AND DATE(st.start_ts) = DATE '2019-09-01';
  params:
  - '2019-09-01'
  - 20
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-08-09 23:31:25', '2019-08-23 06:08:13'];
  params:
  - - '2019-08-09 23:31:25'
    - '2019-08-23 06:08:13'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Phleva Island' GROUP BY i.name;
  params:
  - Phleva Island
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Makronisos' GROUP BY i.name;
  params:
  - Makronisos
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-06-22 13:13:31', '2019-06-28 19:31:36'];
  params:
  - - '2019-06-22 13:13:31'
    - '2019-06-28 19:31:36'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-03-05 14:34:59', '2019-03-19 08:18:37'];
  params:
  - - '2019-03-05 14:34:59'
    - '2019-03-19 08:18:37'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 19 AND DATE(st.start_ts) = DATE '2019-07-05';
  params:
  - '2019-07-05'
  - 19
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 16 AND DATE(st.start_ts) = DATE '2019-02-07';
  params:
  - '2019-02-07'
  - 16
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'LAVRIO' AND cd.end_time > '2019-03-14 17:52:28' AND '2019-03-05 15:59:41' > cd.start_time;
  params:
  - LAVRIO
  - - '2019-03-05 15:59:41'
    - '2019-03-14 17:52:28'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 11 AND DATE(st.start_ts) = DATE '2019-11-27';
  params:
  - '2019-11-27'
  - 11
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-12-01 03:44:39', '2019-12-15 21:10:55'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-12-01 03:44:39'
    - '2019-12-15 21:10:55'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Nisis Pachaki' GROUP BY i.name;
  params:
  - Nisis Pachaki
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'AGISTRI' AND h_end.name = 'ALIMOS';
  params:
  - AGISTRI
  - ALIMOS
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 21 AND DATE(st.start_ts) = DATE '2019-09-18';
  params:
  - '2019-09-18'
  - 21
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-06-04 08:30:46', '2019-06-15 14:33:12'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-06-04 08:30:46'
    - '2019-06-15 14:33:12'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-04-18 01:15:27', '2019-04-30 12:56:39'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-04-18 01:15:27'
    - '2019-04-30 12:56:39'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-10-10 10:05:43', '2019-10-14 07:47:04'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-10-10 10:05:43'
    - '2019-10-14 07:47:04'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 2 AND DATE(st.start_ts) = DATE '2019-08-20';
  params:
  - '2019-08-20'
  - 2
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Nisis Ledou' GROUP BY i.name;
  params:
  - Nisis Ledou
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 20 AND DATE(st.start_ts) = DATE '2019-12-23';
  params:
  - '2019-12-23'
  - 20
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'AEGINA' AND cd.end_time > '2019-01-28 22:24:09' AND '2019-01-26 14:07:18' > cd.start_time;
  params:
  - AEGINA
  - - '2019-01-26 14:07:18'
    - '2019-01-28 22:24:09'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Ydrousa' GROUP BY i.name;
  params:
  - Ydrousa
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'ELEFSIS' AND cd.end_time > '2019-01-21 06:09:27' AND '2019-01-12 08:59:28' > cd.start_time;
  params:
  - ELEFSIS
  - - '2019-01-12 08:59:28'
    - '2019-01-21 06:09:27'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Vrachonisis Moladi' GROUP BY i.name;
  params:
  - Vrachonisis Moladi
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Pachi' GROUP BY i.name;
  params:
  - Pachi
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-01-01 21:00:22', '2019-01-11 16:11:40'];
  params:
  - - '2019-01-01 21:00:22'
    - '2019-01-11 16:11:40'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-11-01 14:56:18', '2019-11-10 14:18:02'];
  params:
  - - '2019-11-01 14:56:18'
    - '2019-11-10 14:18:02'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'AGIOS KOSMAS' AND cd.end_time > '2019-11-10 20:23:56' AND '2019-10-27 09:09:44' > cd.start_time;
  params:
  - AGIOS KOSMAS
  - - '2019-10-27 09:09:44'
    - '2019-11-10 20:23:56'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'ERMIONI' AND cd.end_time > '2019-03-06 16:35:56' AND '2019-02-25 12:59:48' > cd.start_time;
  params:
  - ERMIONI
  - - '2019-02-25 12:59:48'
    - '2019-03-06 16:35:56'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-05-30 12:05:52', '2019-06-09 14:19:09'];
  params:
  - - '2019-05-30 12:05:52'
    - '2019-06-09 14:19:09'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Agios Thomas' GROUP BY i.name;
  params:
  - Agios Thomas
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-11-29 21:40:33', '2019-12-06 10:59:40'];
  params:
  - - '2019-11-29 21:40:33'
    - '2019-12-06 10:59:40'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-12-25 13:15:44', '2019-12-31 22:28:06'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-12-25 13:15:44'
    - '2019-12-31 22:28:06'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'FANEROMENI' AND cd.end_time > '2019-05-04 21:37:15' AND '2019-04-30 00:18:28' > cd.start_time;
  params:
  - FANEROMENI
  - - '2019-04-30 00:18:28'
    - '2019-05-04 21:37:15'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'ERMIONI' AND h_end.name = 'RAFINA';
  params:
  - ERMIONI
  - RAFINA
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-01-08 13:34:59', '2019-01-23 09:24:56'];
  params:
  - - '2019-01-08 13:34:59'
    - '2019-01-23 09:24:56'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-04-01 04:54:44', '2019-04-06 05:06:53'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-04-01 04:54:44'
    - '2019-04-06 05:06:53'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Nisis Ledou' GROUP BY i.name;
  params:
  - Nisis Ledou
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-12-16 13:10:21', '2019-12-21 17:48:06'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-12-16 13:10:21'
    - '2019-12-21 17:48:06'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'PIRAEUS' AND cd.end_time > '2019-11-28 02:05:33' AND '2019-11-14 13:54:04' > cd.start_time;
  params:
  - PIRAEUS
  - - '2019-11-14 13:54:04'
    - '2019-11-28 02:05:33'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-01-10 08:51:21', '2019-01-24 11:25:26'];
  params:
  - - '2019-01-10 08:51:21'
    - '2019-01-24 11:25:26'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'LAVRIO' AND h_end.name = 'ASPROPYRGOS';
  params:
  - LAVRIO
  - ASPROPYRGOS
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 7 AND DATE(st.start_ts) = DATE '2019-08-01';
  params:
  - '2019-08-01'
  - 7
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'GLYFADA' AND h_end.name = 'AGIOI THEODORI';
  params:
  - GLYFADA
  - AGIOI THEODORI
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 17 AND DATE(st.start_ts) = DATE '2019-06-01';
  params:
  - '2019-06-01'
  - 17
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Trakhyli' GROUP BY i.name;
  params:
  - Trakhyli
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-03-27 04:33:10', '2019-04-07 02:21:41'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-03-27 04:33:10'
    - '2019-04-07 02:21:41'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'AGIOS KOSMAS' AND cd.end_time > '2019-09-22 18:41:11' AND '2019-09-13 07:45:35' > cd.start_time;
  params:
  - AGIOS KOSMAS
  - - '2019-09-13 07:45:35'
    - '2019-09-22 18:41:11'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-09-20 00:24:13', '2019-09-22 18:26:46'];
  params:
  - - '2019-09-20 00:24:13'
    - '2019-09-22 18:26:46'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'SIRI' AND h_end.name = 'ERMIONI';
  params:
  - SIRI
  - ERMIONI
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-11-08 14:30:01', '2019-11-19 11:19:55'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-11-08 14:30:01'
    - '2019-11-19 11:19:55'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'FALIRO' AND h_end.name = 'CORINTH';
  params:
  - FALIRO
  - CORINTH
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Kasidis' GROUP BY i.name;
  params:
  - Kasidis
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 16 AND DATE(st.start_ts) = DATE '2019-10-12';
  params:
  - '2019-10-12'
  - 16
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'LAVRIO' AND h_end.name = 'AEGINA';
  params:
  - LAVRIO
  - AEGINA
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-07-20 20:39:01', '2019-08-03 19:28:20'];
  params:
  - - '2019-07-20 20:39:01'
    - '2019-08-03 19:28:20'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'SIRI' AND cd.end_time > '2019-02-17 05:55:09' AND '2019-02-04 01:20:33' > cd.start_time;
  params:
  - SIRI
  - - '2019-02-04 01:20:33'
    - '2019-02-17 05:55:09'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-06-02 02:51:09', '2019-06-13 21:03:12'];
  params:
  - - '2019-06-02 02:51:09'
    - '2019-06-13 21:03:12'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'SIRI' AND h_end.name = 'ASPROPYRGOS';
  params:
  - SIRI
  - ASPROPYRGOS
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Kourmouloudes' GROUP BY i.name;
  params:
  - Kourmouloudes
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Plateia' GROUP BY i.name;
  params:
  - Plateia
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'AGISTRI' AND cd.end_time > '2019-04-22 04:05:31' AND '2019-04-14 22:36:02' > cd.start_time;
  params:
  - AGISTRI
  - - '2019-04-14 22:36:02'
    - '2019-04-22 04:05:31'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 20 AND DATE(st.start_ts) = DATE '2019-03-21';
  params:
  - '2019-03-21'
  - 20
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-01-14 08:44:54', '2019-01-26 14:02:25'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-01-14 08:44:54'
    - '2019-01-26 14:02:25'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-03-18 06:13:52', '2019-03-30 17:12:31'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-03-18 06:13:52'
    - '2019-03-30 17:12:31'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-01-01 00:00:01', '2019-01-12 22:31:35'];
  params:
  - - '2019-01-01 00:00:01'
    - '2019-01-12 22:31:35'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-12-25 11:12:55', '2019-12-31 17:22:24'];
  params:
  - - '2019-12-25 11:12:55'
    - '2019-12-31 17:22:24'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-06-29 00:06:48', '2019-07-03 11:41:23'];
  params:
  - - '2019-06-29 00:06:48'
    - '2019-07-03 11:41:23'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 15 AND DATE(st.start_ts) = DATE '2019-07-11';
  params:
  - '2019-07-11'
  - 15
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 10 AND DATE(st.start_ts) = DATE '2019-07-03';
  params:
  - '2019-07-03'
  - 10
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'ASPROPYRGOS' AND cd.end_time > '2019-12-28 13:23:08' AND '2019-12-22 01:04:09' > cd.start_time;
  params:
  - ASPROPYRGOS
  - - '2019-12-22 01:04:09'
    - '2019-12-28 13:23:08'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'SIRI' AND cd.end_time > '2019-07-01 11:46:30' AND '2019-06-17 18:01:56' > cd.start_time;
  params:
  - SIRI
  - - '2019-06-17 18:01:56'
    - '2019-07-01 11:46:30'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Nisis Atalanti' GROUP BY i.name;
  params:
  - Nisis Atalanti
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'ELEFSIS' AND h_end.name = 'AGIOI THEODORI';
  params:
  - ELEFSIS
  - AGIOI THEODORI
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'ASPROPYRGOS' AND h_end.name = 'RAFINA';
  params:
  - ASPROPYRGOS
  - RAFINA
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'AGISTRI' AND h_end.name = 'AEGINA';
  params:
  - AGISTRI
  - AEGINA
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'GLYFADA' AND h_end.name = 'SIRI';
  params:
  - GLYFADA
  - SIRI
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Revithousa' GROUP BY i.name;
  params:
  - Revithousa
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'ASPROPYRGOS' AND h_end.name = 'AGISTRI';
  params:
  - ASPROPYRGOS
  - AGISTRI
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Nisis Lagousa' GROUP BY i.name;
  params:
  - Nisis Lagousa
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'ERMIONI' AND h_end.name = 'PIRAEUS';
  params:
  - ERMIONI
  - PIRAEUS
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-10-01 17:14:14', '2019-10-11 14:47:13'];
  params:
  - - '2019-10-01 17:14:14'
    - '2019-10-11 14:47:13'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'AGIOI THEODORI' AND cd.end_time > '2019-07-20 12:35:56' AND '2019-07-13 22:44:13' > cd.start_time;
  params:
  - AGIOI THEODORI
  - - '2019-07-13 22:44:13'
    - '2019-07-20 12:35:56'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 5 AND DATE(st.start_ts) = DATE '2019-01-16';
  params:
  - '2019-01-16'
  - 5
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-06-12 11:16:49', '2019-06-22 15:45:21'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-06-12 11:16:49'
    - '2019-06-22 15:45:21'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Kavouronisi' GROUP BY i.name;
  params:
  - Kavouronisi
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 7 AND DATE(st.start_ts) = DATE '2019-09-20';
  params:
  - '2019-09-20'
  - 7
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-10-18 05:40:50', '2019-10-22 19:30:36'];
  params:
  - - '2019-10-18 05:40:50'
    - '2019-10-22 19:30:36'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'PERAMA' AND h_end.name = 'LAVRIO';
  params:
  - PERAMA
  - LAVRIO
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-11-15 23:45:59', '2019-11-19 07:25:04'];
  params:
  - - '2019-11-15 23:45:59'
    - '2019-11-19 07:25:04'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'ZEA' AND cd.end_time > '2019-10-03 03:09:10' AND '2019-09-21 21:13:00' > cd.start_time;
  params:
  - ZEA
  - - '2019-09-21 21:13:00'
    - '2019-10-03 03:09:10'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 19 AND DATE(st.start_ts) = DATE '2019-12-18';
  params:
  - '2019-12-18'
  - 19
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-06-24 09:37:20', '2019-07-02 22:11:54'];
  params:
  - - '2019-06-24 09:37:20'
    - '2019-07-02 22:11:54'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'FANEROMENI' AND h_end.name = 'FLISVOS';
  params:
  - FANEROMENI
  - FLISVOS
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-04-22 19:29:31', '2019-04-25 00:13:22'];
  params:
  - - '2019-04-22 19:29:31'
    - '2019-04-25 00:13:22'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Nisis Stakhtorroyi' GROUP BY i.name;
  params:
  - Nisis Stakhtorroyi
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Nisida Kyra' GROUP BY i.name;
  params:
  - Nisida Kyra
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-11-30 17:12:15', '2019-12-13 14:39:49'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-11-30 17:12:15'
    - '2019-12-13 14:39:49'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-06-25 20:52:38', '2019-07-06 05:56:05'];
  params:
  - - '2019-06-25 20:52:38'
    - '2019-07-06 05:56:05'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Lagousa' GROUP BY i.name;
  params:
  - Lagousa
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-01-01 02:41:46', '2019-01-13 20:41:11'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-01-01 02:41:46'
    - '2019-01-13 20:41:11'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Nisis Islet' GROUP BY i.name;
  params:
  - Nisis Islet
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 15 AND DATE(st.start_ts) = DATE '2019-01-07';
  params:
  - '2019-01-07'
  - 15
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-07-11 00:41:56', '2019-07-14 21:12:25'];
  params:
  - - '2019-07-11 00:41:56'
    - '2019-07-14 21:12:25'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-07-06 00:57:08', '2019-07-09 17:06:53'];
  params:
  - - '2019-07-06 00:57:08'
    - '2019-07-09 17:06:53'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'ASPROPYRGOS' AND h_end.name = 'PERAMA';
  params:
  - ASPROPYRGOS
  - PERAMA
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-09-24 08:22:40', '2019-09-26 09:12:33'];
  params:
  - - '2019-09-24 08:22:40'
    - '2019-09-26 09:12:33'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-09-23 00:55:05', '2019-10-04 23:02:01'];
  params:
  - - '2019-09-23 00:55:05'
    - '2019-10-04 23:02:01'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'AGIOI THEODORI' AND h_end.name = 'SIRI';
  params:
  - AGIOI THEODORI
  - SIRI
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-08-29 09:42:47', '2019-09-02 02:19:38'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-08-29 09:42:47'
    - '2019-09-02 02:19:38'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Lagousa' GROUP BY i.name;
  params:
  - Lagousa
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'CORINTH CANAL' AND h_end.name = 'AGIOI THEODORI';
  params:
  - CORINTH CANAL
  - AGIOI THEODORI
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-10-22 06:06:35', '2019-11-03 07:30:18'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-10-22 06:06:35'
    - '2019-11-03 07:30:18'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Makronisos' GROUP BY i.name;
  params:
  - Makronisos
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-05-12 07:45:16', '2019-05-15 22:06:47'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-05-12 07:45:16'
    - '2019-05-15 22:06:47'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'LAVRIO' AND h_end.name = 'CORINTH CANAL';
  params:
  - LAVRIO
  - CORINTH CANAL
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 7 AND DATE(st.start_ts) = DATE '2019-05-23';
  params:
  - '2019-05-23'
  - 7
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-01-06 14:50:53', '2019-01-19 22:06:19'];
  params:
  - - '2019-01-06 14:50:53'
    - '2019-01-19 22:06:19'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'ERMIONI' AND h_end.name = 'ERMIONI';
  params:
  - ERMIONI
  - ERMIONI
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'ELEFSIS' AND cd.end_time > '2019-07-27 21:44:05' AND '2019-07-19 22:04:14' > cd.start_time;
  params:
  - ELEFSIS
  - - '2019-07-19 22:04:14'
    - '2019-07-27 21:44:05'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'AGIOI THEODORI' AND cd.end_time > '2019-03-24 15:49:44' AND '2019-03-10 04:23:03' > cd.start_time;
  params:
  - AGIOI THEODORI
  - - '2019-03-10 04:23:03'
    - '2019-03-24 15:49:44'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-03-27 06:19:22', '2019-04-05 12:55:15'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-03-27 06:19:22'
    - '2019-04-05 12:55:15'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 21 AND DATE(st.start_ts) = DATE '2019-08-12';
  params:
  - '2019-08-12'
  - 21
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 15 AND DATE(st.start_ts) = DATE '2019-02-02';
  params:
  - '2019-02-02'
  - 15
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'AGIOS KOSMAS' AND h_end.name = 'AGIOI THEODORI';
  params:
  - AGIOS KOSMAS
  - AGIOI THEODORI
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 4 AND DATE(st.start_ts) = DATE '2019-12-11';
  params:
  - '2019-12-11'
  - 4
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'LAVRIO' AND h_end.name = 'SOUSAKI';
  params:
  - LAVRIO
  - SOUSAKI
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'AGISTRI' AND h_end.name = 'FALIRO';
  params:
  - AGISTRI
  - FALIRO
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 9 AND DATE(st.start_ts) = DATE '2019-12-24';
  params:
  - '2019-12-24'
  - 9
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'FALIRO' AND cd.end_time > '2019-06-10 16:12:47' AND '2019-06-07 01:18:42' > cd.start_time;
  params:
  - FALIRO
  - - '2019-06-07 01:18:42'
    - '2019-06-10 16:12:47'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-04-14 13:47:03', '2019-04-23 15:04:32'];
  params:
  - - '2019-04-14 13:47:03'
    - '2019-04-23 15:04:32'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-01-27 22:29:27', '2019-01-30 06:22:28'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-01-27 22:29:27'
    - '2019-01-30 06:22:28'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-11-17 22:46:48', '2019-11-21 01:36:36'];
  params:
  - - '2019-11-17 22:46:48'
    - '2019-11-21 01:36:36'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-04-28 10:02:00', '2019-05-12 18:34:52'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-04-28 10:02:00'
    - '2019-05-12 18:34:52'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 1 AND DATE(st.start_ts) = DATE '2019-07-24';
  params:
  - '2019-07-24'
  - 1
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'AEGINA' AND h_end.name = 'ALIMOS';
  params:
  - AEGINA
  - ALIMOS
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'AEGINA' AND h_end.name = 'AGIOS KOSMAS';
  params:
  - AEGINA
  - AGIOS KOSMAS
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 8 AND DATE(st.start_ts) = DATE '2019-04-20';
  params:
  - '2019-04-20'
  - 8
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-03-16 23:11:48', '2019-03-23 02:42:09'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-03-16 23:11:48'
    - '2019-03-23 02:42:09'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-01-10 17:24:33', '2019-01-20 16:01:04'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-01-10 17:24:33'
    - '2019-01-20 16:01:04'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'ELEFSIS' AND h_end.name = 'LAVRIO';
  params:
  - ELEFSIS
  - LAVRIO
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-05-26 16:16:18', '2019-06-08 23:29:14'];
  params:
  - - '2019-05-26 16:16:18'
    - '2019-06-08 23:29:14'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-10-20 16:32:31', '2019-10-23 20:19:24'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-10-20 16:32:31'
    - '2019-10-23 20:19:24'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Nisis Metopi' GROUP BY i.name;
  params:
  - Nisis Metopi
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-12-18 00:30:46', '2019-12-25 14:29:16'];
  params:
  - - '2019-12-18 00:30:46'
    - '2019-12-25 14:29:16'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Poros' GROUP BY i.name;
  params:
  - Poros
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-12-08 13:22:42', '2019-12-13 04:43:06'];
  params:
  - - '2019-12-08 13:22:42'
    - '2019-12-13 04:43:06'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-01-29 17:35:30', '2019-02-12 14:38:25'];
  params:
  - - '2019-01-29 17:35:30'
    - '2019-02-12 14:38:25'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-05-08 13:47:26', '2019-05-13 16:47:19'];
  params:
  - - '2019-05-08 13:47:26'
    - '2019-05-13 16:47:19'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-11-20 15:00:09', '2019-11-26 20:28:30'];
  params:
  - - '2019-11-20 15:00:09'
    - '2019-11-26 20:28:30'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'ELEFSIS' AND cd.end_time > '2019-06-23 12:20:55' AND '2019-06-09 02:29:05' > cd.start_time;
  params:
  - ELEFSIS
  - - '2019-06-09 02:29:05'
    - '2019-06-23 12:20:55'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'ZEA' AND h_end.name = 'GLYFADA';
  params:
  - ZEA
  - GLYFADA
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-06-13 13:48:03', '2019-06-20 08:06:41'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-06-13 13:48:03'
    - '2019-06-20 08:06:41'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-08-09 07:06:59', '2019-08-22 22:55:05'];
  params:
  - - '2019-08-09 07:06:59'
    - '2019-08-22 22:55:05'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 1 AND DATE(st.start_ts) = DATE '2019-12-28';
  params:
  - '2019-12-28'
  - 1
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'FANEROMENI' AND cd.end_time > '2019-11-28 01:45:22' AND '2019-11-18 15:55:40' > cd.start_time;
  params:
  - FANEROMENI
  - - '2019-11-18 15:55:40'
    - '2019-11-28 01:45:22'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Aegina Moni' GROUP BY i.name;
  params:
  - Aegina Moni
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-04-19 12:12:56', '2019-04-23 07:59:48'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-04-19 12:12:56'
    - '2019-04-23 07:59:48'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'AGIOI THEODORI' AND h_end.name = 'PIRAEUS';
  params:
  - AGIOI THEODORI
  - PIRAEUS
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'ZEA' AND h_end.name = 'LAVRIO';
  params:
  - ZEA
  - LAVRIO
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'ALIMOS' AND cd.end_time > '2019-07-13 22:23:32' AND '2019-07-11 02:16:41' > cd.start_time;
  params:
  - ALIMOS
  - - '2019-07-11 02:16:41'
    - '2019-07-13 22:23:32'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-04-22 02:26:32', '2019-05-02 16:12:54'];
  params:
  - - '2019-04-22 02:26:32'
    - '2019-05-02 16:12:54'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'ELEFSIS' AND cd.end_time > '2019-11-26 12:38:46' AND '2019-11-11 17:02:52' > cd.start_time;
  params:
  - ELEFSIS
  - - '2019-11-11 17:02:52'
    - '2019-11-26 12:38:46'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'LAVRIO' AND cd.end_time > '2019-09-16 12:55:24' AND '2019-09-05 20:40:50' > cd.start_time;
  params:
  - LAVRIO
  - - '2019-09-05 20:40:50'
    - '2019-09-16 12:55:24'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 2 AND DATE(st.start_ts) = DATE '2019-09-07';
  params:
  - '2019-09-07'
  - 2
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-07-07 18:42:52', '2019-07-13 02:52:05'];
  params:
  - - '2019-07-07 18:42:52'
    - '2019-07-13 02:52:05'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'FLISVOS' AND cd.end_time > '2019-02-18 17:28:30' AND '2019-02-14 15:51:31' > cd.start_time;
  params:
  - FLISVOS
  - - '2019-02-14 15:51:31'
    - '2019-02-18 17:28:30'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'FALIRO' AND h_end.name = 'PERAMA';
  params:
  - FALIRO
  - PERAMA
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'ZEA' AND cd.end_time > '2019-05-04 01:31:15' AND '2019-04-25 12:14:58' > cd.start_time;
  params:
  - ZEA
  - - '2019-04-25 12:14:58'
    - '2019-05-04 01:31:15'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 18 AND DATE(st.start_ts) = DATE '2019-11-27';
  params:
  - '2019-11-27'
  - 18
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 17 AND DATE(st.start_ts) = DATE '2019-12-12';
  params:
  - '2019-12-12'
  - 17
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'GLYFADA' AND cd.end_time > '2019-11-17 13:46:47' AND '2019-11-12 20:34:07' > cd.start_time;
  params:
  - GLYFADA
  - - '2019-11-12 20:34:07'
    - '2019-11-17 13:46:47'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'ELEFSIS' AND h_end.name = 'SOUSAKI';
  params:
  - ELEFSIS
  - SOUSAKI
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 17 AND DATE(st.start_ts) = DATE '2019-01-13';
  params:
  - '2019-01-13'
  - 17
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 18 AND DATE(st.start_ts) = DATE '2019-10-21';
  params:
  - '2019-10-21'
  - 18
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'FLISVOS' AND cd.end_time > '2019-04-15 19:07:28' AND '2019-04-08 00:00:48' > cd.start_time;
  params:
  - FLISVOS
  - - '2019-04-08 00:00:48'
    - '2019-04-15 19:07:28'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Patroklos' GROUP BY i.name;
  params:
  - Patroklos
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-06-02 17:10:00', '2019-06-08 16:48:29'];
  params:
  - - '2019-06-02 17:10:00'
    - '2019-06-08 16:48:29'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Nisis Bisti' GROUP BY i.name;
  params:
  - Nisis Bisti
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-11-09 02:31:07', '2019-11-13 02:17:41'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-11-09 02:31:07'
    - '2019-11-13 02:17:41'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-11-22 19:31:52', '2019-11-25 23:09:51'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-11-22 19:31:52'
    - '2019-11-25 23:09:51'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 13 AND DATE(st.start_ts) = DATE '2019-03-22';
  params:
  - '2019-03-22'
  - 13
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Nisis Metopi' GROUP BY i.name;
  params:
  - Nisis Metopi
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Salamina' GROUP BY i.name;
  params:
  - Salamina
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 12 AND DATE(st.start_ts) = DATE '2019-04-14';
  params:
  - '2019-04-14'
  - 12
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-01-05 05:08:26', '2019-01-18 20:31:57'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-01-05 05:08:26'
    - '2019-01-18 20:31:57'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Spalaphtronisi Islet' GROUP BY i.name;
  params:
  - Spalaphtronisi Islet
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'GLYFADA' AND h_end.name = 'PIRAEUS';
  params:
  - GLYFADA
  - PIRAEUS
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-07-01 17:07:43', '2019-07-06 04:26:26'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-07-01 17:07:43'
    - '2019-07-06 04:26:26'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Aponissos' GROUP BY i.name;
  params:
  - Aponissos
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-04-27 11:12:08', '2019-05-07 05:41:12'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-04-27 11:12:08'
    - '2019-05-07 05:41:12'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Phlevopoula' GROUP BY i.name;
  params:
  - Phlevopoula
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-12-19 16:04:12', '2019-12-28 19:45:23'];
  params:
  - - '2019-12-19 16:04:12'
    - '2019-12-28 19:45:23'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-05-15 14:28:36', '2019-05-26 20:45:53'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-05-15 14:28:36'
    - '2019-05-26 20:45:53'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'AGIOI THEODORI' AND h_end.name = 'LAVRIO';
  params:
  - AGIOI THEODORI
  - LAVRIO
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-07-16 10:00:54', '2019-07-24 10:24:25'];
  params:
  - - '2019-07-16 10:00:54'
    - '2019-07-24 10:24:25'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Psittalia' GROUP BY i.name;
  params:
  - Psittalia
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 20 AND DATE(st.start_ts) = DATE '2019-04-16';
  params:
  - '2019-04-16'
  - 20
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'PIRAEUS' AND h_end.name = 'AGIOS KOSMAS';
  params:
  - PIRAEUS
  - AGIOS KOSMAS
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-06-29 20:57:26', '2019-07-13 12:13:04'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-06-29 20:57:26'
    - '2019-07-13 12:13:04'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-09-12 16:32:18', '2019-09-19 10:32:41'];
  params:
  - - '2019-09-12 16:32:18'
    - '2019-09-19 10:32:41'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-01-17 06:47:23', '2019-01-22 07:49:08'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-01-17 06:47:23'
    - '2019-01-22 07:49:08'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 7 AND DATE(st.start_ts) = DATE '2019-07-02';
  params:
  - '2019-07-02'
  - 7
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 16 AND DATE(st.start_ts) = DATE '2019-08-28';
  params:
  - '2019-08-28'
  - 16
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'ASPROPYRGOS' AND h_end.name = 'AGIOI THEODORI';
  params:
  - ASPROPYRGOS
  - AGIOI THEODORI
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-02-26 08:02:00', '2019-03-02 06:33:09'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-02-26 08:02:00'
    - '2019-03-02 06:33:09'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 21 AND DATE(st.start_ts) = DATE '2019-10-07';
  params:
  - '2019-10-07'
  - 21
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Lagousa' GROUP BY i.name;
  params:
  - Lagousa
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'LAVRIO' AND h_end.name = 'ERMIONI';
  params:
  - LAVRIO
  - ERMIONI
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 5 AND DATE(st.start_ts) = DATE '2019-12-11';
  params:
  - '2019-12-11'
  - 5
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-10-10 05:10:35', '2019-10-15 10:31:36'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-10-10 05:10:35'
    - '2019-10-15 10:31:36'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-11-09 02:55:16', '2019-11-14 04:36:20'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-11-09 02:55:16'
    - '2019-11-14 04:36:20'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'CORINTH' AND h_end.name = 'AGIOI THEODORI';
  params:
  - CORINTH
  - AGIOI THEODORI
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'LAVRIO' AND cd.end_time > '2019-07-02 08:42:38' AND '2019-06-28 01:05:41' > cd.start_time;
  params:
  - LAVRIO
  - - '2019-06-28 01:05:41'
    - '2019-07-02 08:42:38'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'GLYFADA' AND h_end.name = 'AEGINA';
  params:
  - GLYFADA
  - AEGINA
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Aponissos' GROUP BY i.name;
  params:
  - Aponissos
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 17 AND DATE(st.start_ts) = DATE '2019-10-02';
  params:
  - '2019-10-02'
  - 17
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-03-27 00:49:22', '2019-03-31 17:18:10'];
  params:
  - - '2019-03-27 00:49:22'
    - '2019-03-31 17:18:10'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-06-20 10:38:14', '2019-07-02 08:51:29'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-06-20 10:38:14'
    - '2019-07-02 08:51:29'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-07-12 22:46:57', '2019-07-20 14:18:59'];
  params:
  - - '2019-07-12 22:46:57'
    - '2019-07-20 14:18:59'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'AGISTRI' AND cd.end_time > '2019-02-18 03:24:53' AND '2019-02-10 16:06:40' > cd.start_time;
  params:
  - AGISTRI
  - - '2019-02-10 16:06:40'
    - '2019-02-18 03:24:53'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 14 AND DATE(st.start_ts) = DATE '2019-02-14';
  params:
  - '2019-02-14'
  - 14
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'PIRAEUS' AND cd.end_time > '2019-08-13 16:03:21' AND '2019-08-10 02:05:29' > cd.start_time;
  params:
  - PIRAEUS
  - - '2019-08-10 02:05:29'
    - '2019-08-13 16:03:21'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Ovrios' GROUP BY i.name;
  params:
  - Ovrios
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 13 AND DATE(st.start_ts) = DATE '2019-11-24';
  params:
  - '2019-11-24'
  - 13
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'GLYFADA' AND h_end.name = 'ELEFSIS';
  params:
  - GLYFADA
  - ELEFSIS
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'FALIRO' AND cd.end_time > '2019-08-06 07:23:45' AND '2019-07-31 05:07:19' > cd.start_time;
  params:
  - FALIRO
  - - '2019-07-31 05:07:19'
    - '2019-08-06 07:23:45'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'PIRAEUS' AND cd.end_time > '2019-07-07 18:09:28' AND '2019-07-02 19:54:52' > cd.start_time;
  params:
  - PIRAEUS
  - - '2019-07-02 19:54:52'
    - '2019-07-07 18:09:28'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 20 AND DATE(st.start_ts) = DATE '2019-07-11';
  params:
  - '2019-07-11'
  - 20
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'FLISVOS' AND h_end.name = 'ZEA';
  params:
  - FLISVOS
  - ZEA
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-06-16 04:52:25', '2019-07-01 03:34:07'];
  params:
  - - '2019-06-16 04:52:25'
    - '2019-07-01 03:34:07'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'GLYFADA' AND cd.end_time > '2019-02-16 10:20:11' AND '2019-02-13 11:51:04' > cd.start_time;
  params:
  - GLYFADA
  - - '2019-02-13 11:51:04'
    - '2019-02-16 10:20:11'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'FLISVOS' AND h_end.name = 'CORINTH CANAL';
  params:
  - FLISVOS
  - CORINTH CANAL
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 6 AND DATE(st.start_ts) = DATE '2019-01-05';
  params:
  - '2019-01-05'
  - 6
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-07-17 18:22:29', '2019-07-31 11:13:27'];
  params:
  - - '2019-07-17 18:22:29'
    - '2019-07-31 11:13:27'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'LAVRIO' AND h_end.name = 'ELEFSIS';
  params:
  - LAVRIO
  - ELEFSIS
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'SIRI' AND cd.end_time > '2019-12-24 14:22:31' AND '2019-12-16 18:28:15' > cd.start_time;
  params:
  - SIRI
  - - '2019-12-16 18:28:15'
    - '2019-12-24 14:22:31'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'SIRI' AND h_end.name = 'AEGINA';
  params:
  - SIRI
  - AEGINA
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-05-10 19:51:08', '2019-05-24 18:01:16'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-05-10 19:51:08'
    - '2019-05-24 18:01:16'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-06-09 14:01:55', '2019-06-15 08:31:14'];
  params:
  - - '2019-06-09 14:01:55'
    - '2019-06-15 08:31:14'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-06-25 10:51:30', '2019-06-30 23:12:47'];
  params:
  - - '2019-06-25 10:51:30'
    - '2019-06-30 23:12:47'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-11-07 10:17:32', '2019-11-17 13:38:37'];
  params:
  - - '2019-11-07 10:17:32'
    - '2019-11-17 13:38:37'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 14 AND DATE(st.start_ts) = DATE '2019-08-01';
  params:
  - '2019-08-01'
  - 14
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-03-25 18:56:16', '2019-04-04 08:31:45'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-03-25 18:56:16'
    - '2019-04-04 08:31:45'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-01-03 12:06:41', '2019-01-11 03:26:36'];
  params:
  - - '2019-01-03 12:06:41'
    - '2019-01-11 03:26:36'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'ELEFSIS' AND cd.end_time > '2019-07-04 03:03:52' AND '2019-06-29 03:32:37' > cd.start_time;
  params:
  - ELEFSIS
  - - '2019-06-29 03:32:37'
    - '2019-07-04 03:03:52'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 23 AND DATE(st.start_ts) = DATE '2019-08-01';
  params:
  - '2019-08-01'
  - 23
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Plateia' GROUP BY i.name;
  params:
  - Plateia
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Revithousa' GROUP BY i.name;
  params:
  - Revithousa
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Gaidaros' GROUP BY i.name;
  params:
  - Gaidaros
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'FANEROMENI' AND h_end.name = 'SIRI';
  params:
  - FANEROMENI
  - SIRI
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Psittalia' GROUP BY i.name;
  params:
  - Psittalia
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'PERAMA' AND cd.end_time > '2019-09-28 03:33:24' AND '2019-09-20 13:22:12' > cd.start_time;
  params:
  - PERAMA
  - - '2019-09-20 13:22:12'
    - '2019-09-28 03:33:24'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 5 AND DATE(st.start_ts) = DATE '2019-01-29';
  params:
  - '2019-01-29'
  - 5
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'RAFINA' AND h_end.name = 'ERMIONI';
  params:
  - RAFINA
  - ERMIONI
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'ERMIONI' AND cd.end_time > '2019-03-18 02:18:05' AND '2019-03-12 01:26:09' > cd.start_time;
  params:
  - ERMIONI
  - - '2019-03-12 01:26:09'
    - '2019-03-18 02:18:05'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 10 AND DATE(st.start_ts) = DATE '2019-12-11';
  params:
  - '2019-12-11'
  - 10
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'PIRAEUS' AND cd.end_time > '2019-09-25 10:34:23' AND '2019-09-19 23:59:14' > cd.start_time;
  params:
  - PIRAEUS
  - - '2019-09-19 23:59:14'
    - '2019-09-25 10:34:23'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'CORINTH CANAL' AND h_end.name = 'ERMIONI';
  params:
  - CORINTH CANAL
  - ERMIONI
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'CORINTH' AND cd.end_time > '2019-12-07 03:00:37' AND '2019-11-26 11:09:42' > cd.start_time;
  params:
  - CORINTH
  - - '2019-11-26 11:09:42'
    - '2019-12-07 03:00:37'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-01-05 22:22:55', '2019-01-16 05:54:50'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-01-05 22:22:55'
    - '2019-01-16 05:54:50'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-10-07 20:15:54', '2019-10-13 18:03:22'];
  params:
  - - '2019-10-07 20:15:54'
    - '2019-10-13 18:03:22'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 23 AND DATE(st.start_ts) = DATE '2019-09-28';
  params:
  - '2019-09-28'
  - 23
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-01-08 02:56:28', '2019-01-13 14:54:05'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-01-08 02:56:28'
    - '2019-01-13 14:54:05'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-12-14 16:48:09', '2019-12-25 13:43:35'];
  params:
  - - '2019-12-14 16:48:09'
    - '2019-12-25 13:43:35'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Nisis Stakhtorroyi' GROUP BY i.name;
  params:
  - Nisis Stakhtorroyi
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-03-05 11:09:32', '2019-03-09 15:43:09'];
  params:
  - - '2019-03-05 11:09:32'
    - '2019-03-09 15:43:09'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-01-20 16:10:20', '2019-01-28 16:34:29'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-01-20 16:10:20'
    - '2019-01-28 16:34:29'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'CORINTH CANAL' AND cd.end_time > '2019-02-24 06:58:15' AND '2019-02-21 15:28:38' > cd.start_time;
  params:
  - CORINTH CANAL
  - - '2019-02-21 15:28:38'
    - '2019-02-24 06:58:15'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-09-13 00:47:00', '2019-09-20 14:40:36'];
  params:
  - - '2019-09-13 00:47:00'
    - '2019-09-20 14:40:36'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Nisida Kyra' GROUP BY i.name;
  params:
  - Nisida Kyra
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 10 AND DATE(st.start_ts) = DATE '2019-10-05';
  params:
  - '2019-10-05'
  - 10
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-06-11 20:40:54', '2019-06-13 22:58:40'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-06-11 20:40:54'
    - '2019-06-13 22:58:40'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-12-22 08:30:16', '2019-12-24 11:06:29'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-12-22 08:30:16'
    - '2019-12-24 11:06:29'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-06-15 12:12:01', '2019-06-28 03:12:39'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-06-15 12:12:01'
    - '2019-06-28 03:12:39'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'AGIOI THEODORI' AND h_end.name = 'GLYFADA';
  params:
  - AGIOI THEODORI
  - GLYFADA
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'FALIRO' AND h_end.name = 'ZEA';
  params:
  - FALIRO
  - ZEA
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 22 AND DATE(st.start_ts) = DATE '2019-08-21';
  params:
  - '2019-08-21'
  - 22
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Kordeliaris' GROUP BY i.name;
  params:
  - Kordeliaris
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'FANEROMENI' AND h_end.name = 'LAVRIO';
  params:
  - FANEROMENI
  - LAVRIO
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'ELEFSIS' AND cd.end_time > '2019-12-03 10:24:47' AND '2019-11-21 16:47:21' > cd.start_time;
  params:
  - ELEFSIS
  - - '2019-11-21 16:47:21'
    - '2019-12-03 10:24:47'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Nisis Stakhtorroyi' GROUP BY i.name;
  params:
  - Nisis Stakhtorroyi
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-02-17 22:51:58', '2019-03-02 17:40:11'];
  params:
  - - '2019-02-17 22:51:58'
    - '2019-03-02 17:40:11'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'ASPROPYRGOS' AND h_end.name = 'FALIRO';
  params:
  - ASPROPYRGOS
  - FALIRO
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-08-26 10:43:36', '2019-09-08 15:16:50'];
  params:
  - - '2019-08-26 10:43:36'
    - '2019-09-08 15:16:50'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-04-07 02:49:04', '2019-04-12 12:58:49'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-04-07 02:49:04'
    - '2019-04-12 12:58:49'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'ALIMOS' AND cd.end_time > '2019-02-17 04:37:23' AND '2019-02-06 10:37:37' > cd.start_time;
  params:
  - ALIMOS
  - - '2019-02-06 10:37:37'
    - '2019-02-17 04:37:23'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Nisis Ledou' GROUP BY i.name;
  params:
  - Nisis Ledou
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'ALIMOS' AND h_end.name = 'AEGINA';
  params:
  - ALIMOS
  - AEGINA
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Ydrousa' GROUP BY i.name;
  params:
  - Ydrousa
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'SOUSAKI' AND cd.end_time > '2019-03-25 18:40:07' AND '2019-03-21 23:50:58' > cd.start_time;
  params:
  - SOUSAKI
  - - '2019-03-21 23:50:58'
    - '2019-03-25 18:40:07'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'SOUSAKI' AND h_end.name = 'ALIMOS';
  params:
  - SOUSAKI
  - ALIMOS
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 15 AND DATE(st.start_ts) = DATE '2019-05-24';
  params:
  - '2019-05-24'
  - 15
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'AEGINA' AND h_end.name = 'RAFINA';
  params:
  - AEGINA
  - RAFINA
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'CORINTH' AND cd.end_time > '2019-09-20 01:48:12' AND '2019-09-07 19:43:15' > cd.start_time;
  params:
  - CORINTH
  - - '2019-09-07 19:43:15'
    - '2019-09-20 01:48:12'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'AGISTRI' AND cd.end_time > '2019-11-12 17:36:35' AND '2019-11-03 05:34:05' > cd.start_time;
  params:
  - AGISTRI
  - - '2019-11-03 05:34:05'
    - '2019-11-12 17:36:35'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'LAVRIO' AND h_end.name = 'AEGINA';
  params:
  - LAVRIO
  - AEGINA
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-03-22 13:43:28', '2019-04-03 10:27:13'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-03-22 13:43:28'
    - '2019-04-03 10:27:13'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-10-27 00:03:40', '2019-11-09 16:08:44'];
  params:
  - - '2019-10-27 00:03:40'
    - '2019-11-09 16:08:44'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 6 AND DATE(st.start_ts) = DATE '2019-07-28';
  params:
  - '2019-07-28'
  - 6
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Nisis Lagousa' GROUP BY i.name;
  params:
  - Nisis Lagousa
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'ALIMOS' AND h_end.name = 'SIRI';
  params:
  - ALIMOS
  - SIRI
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 4 AND DATE(st.start_ts) = DATE '2019-12-13';
  params:
  - '2019-12-13'
  - 4
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'GLYFADA' AND h_end.name = 'CORINTH CANAL';
  params:
  - GLYFADA
  - CORINTH CANAL
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'LAVRIO' AND cd.end_time > '2019-10-16 13:41:31' AND '2019-10-08 21:18:10' > cd.start_time;
  params:
  - LAVRIO
  - - '2019-10-08 21:18:10'
    - '2019-10-16 13:41:31'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'AGIOI THEODORI' AND h_end.name = 'ZEA';
  params:
  - AGIOI THEODORI
  - ZEA
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'RAFINA' AND h_end.name = 'RAFINA';
  params:
  - RAFINA
  - RAFINA
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-08-03 13:43:40', '2019-08-09 10:41:11'];
  params:
  - - '2019-08-03 13:43:40'
    - '2019-08-09 10:41:11'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 17 AND DATE(st.start_ts) = DATE '2019-03-28';
  params:
  - '2019-03-28'
  - 17
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'CORINTH CANAL' AND cd.end_time > '2019-06-28 17:37:49' AND '2019-06-26 08:02:28' > cd.start_time;
  params:
  - CORINTH CANAL
  - - '2019-06-26 08:02:28'
    - '2019-06-28 17:37:49'
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'CORINTH' AND h_end.name = 'AEGINA';
  params:
  - CORINTH
  - AEGINA
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'AGIOS KOSMAS' AND h_end.name = 'PERAMA';
  params:
  - AGIOS KOSMAS
  - PERAMA
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Phlevopoula' GROUP BY i.name;
  params:
  - Phlevopoula
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-02-26 13:00:59', '2019-03-02 18:39:47'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-02-26 13:00:59'
    - '2019-03-02 18:39:47'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 7 AND DATE(st.start_ts) = DATE '2019-12-06';
  params:
  - '2019-12-06'
  - 7
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'FALIRO' AND cd.end_time > '2019-10-16 01:00:20' AND '2019-10-06 06:27:44' > cd.start_time;
  params:
  - FALIRO
  - - '2019-10-06 06:27:44'
    - '2019-10-16 01:00:20'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-07-07 02:34:09', '2019-07-10 12:28:33'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-07-07 02:34:09'
    - '2019-07-10 12:28:33'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Vrachonisis Petronisi' GROUP BY i.name;
  params:
  - Vrachonisis Petronisi
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-02-16 07:01:33', '2019-02-22 22:40:46'];
  params:
  - - '2019-02-16 07:01:33'
    - '2019-02-22 22:40:46'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'AGIOI THEODORI' AND cd.end_time > '2019-06-04 21:50:24' AND '2019-05-23 00:56:21' > cd.start_time;
  params:
  - AGIOI THEODORI
  - - '2019-05-23 00:56:21'
    - '2019-06-04 21:50:24'
- name: countActiveCrossingsNearIsland
  type: spatial
  sql: |
    SELECT COUNT(DISTINCT crossing_id) FROM tsdb_crossing_points c JOIN islands i ON ST_DWithin(c.geom, i.geom, 5000) WHERE i.name = 'Revithousa' GROUP BY i.name;
  params:
  - Revithousa
- name: crossingsConnectTwoGivenHarbours
  type: spatial
  sql: |
    WITH start_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp ASC ), end_points AS ( SELECT DISTINCT ON (crossing_id) crossing_id, timestamp, geom FROM tsdb_crossing_points ORDER BY crossing_id, timestamp DESC ) SELECT sp.crossing_id FROM start_points sp JOIN end_points ep ON sp.crossing_id = ep.crossing_id JOIN harbours h_start ON ST_DWithin(sp.geom, h_start.geom, 1000) JOIN harbours h_end ON ST_DWithin(ep.geom, h_end.geom, 1000) WHERE h_start.name = 'SIRI' AND h_end.name = 'GLYFADA';
  params:
  - SIRI
  - GLYFADA
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-01-06 00:57:03', '2019-01-09 20:42:28'];
  params:
  - - '2019-01-06 00:57:03'
    - '2019-01-09 20:42:28'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-01-11 05:52:42', '2019-01-23 15:46:22'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-01-11 05:52:42'
    - '2019-01-23 15:46:22'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'LAVRIO' AND cd.end_time > '2019-04-15 02:37:51' AND '2019-04-11 21:07:38' > cd.start_time;
  params:
  - LAVRIO
  - - '2019-04-11 21:07:38'
    - '2019-04-15 02:37:51'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-01-12 06:07:30', '2019-01-17 14:04:22'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-01-12 06:07:30'
    - '2019-01-17 14:04:22'
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-06-10 07:05:01', '2019-06-19 13:18:56'];
  params:
  - - '2019-06-10 07:05:01'
    - '2019-06-19 13:18:56'
- name: mostFrequentHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossings_in_period AS ( SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-05-17 21:33:11', '2019-05-31 13:54:00'] ), crossing_end_points AS ( SELECT DISTINCT ON (c.crossing_id) c.crossing_id, c.geom FROM tsdb_crossing_points c JOIN crossings_in_period cp ON cp.crossing_id = c.crossing_id ORDER BY c.crossing_id, c.timestamp DESC ) SELECT h.name, COUNT(*) AS crossing_count FROM harbours h JOIN crossing_end_points cep ON ST_DWithin(cep.geom, h.geom, 500) GROUP BY h.name ORDER BY crossing_count DESC LIMIT 1;
  params:
  - - '2019-05-17 21:33:11'
    - '2019-05-31 13:54:00'
- name: averageDurationCrossingStartAtHarbourInPeriod
  type: spatiotemporal
  sql: |
    WITH crossing_data AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_time, MAX(c.timestamp) AS end_time FROM tsdb_crossing_points c GROUP BY c.crossing_id ), start_points AS ( SELECT DISTINCT ON (c.crossing_id) crossing_id, geom AS start_geom FROM tsdb_crossing_points c ORDER BY c.crossing_id, c.timestamp ) SELECT AVG(cd.end_time - cd.start_time) AS avg_duration FROM crossing_data cd JOIN start_points sp ON sp.crossing_id = cd.crossing_id JOIN harbours h ON ST_DWithin(sp.start_geom, h.geom::geography, 500) WHERE h.name = 'ALIMOS' AND cd.end_time > '2019-07-21 10:59:08' AND '2019-07-11 17:21:08' > cd.start_time;
  params:
  - ALIMOS
  - - '2019-07-11 17:21:08'
    - '2019-07-21 10:59:08'
- name: crossingsStartedAtSpecificTimeOnDay
  type: temporal
  sql: |
    WITH start_timestamps AS ( SELECT c.crossing_id, MIN(c.timestamp) AS start_ts FROM tsdb_crossing_points c GROUP BY crossing_id ) SELECT DISTINCT c.crossing_id FROM tsdb_crossing_points c JOIN start_timestamps st ON c.crossing_id = st.crossing_id WHERE EXTRACT(HOUR FROM st.start_ts) = 10 AND DATE(st.start_ts) = DATE '2019-10-18';
  params:
  - '2019-10-18'
  - 10
- name: countActiveCrossingsInPeriod
  type: temporal
  sql: |
    SELECT COUNT(DISTINCT c.crossing_id) FROM tsdb_crossing_points c WHERE c.timestamp BETWEEN ['2019-06-16 07:17:18', '2019-06-24 22:01:36'];
  params:
  - - '2019-06-16 07:17:18'
    - '2019-06-24 22:01:36'
