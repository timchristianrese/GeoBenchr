- name: countActiveRidesInPeriod
  type: temporal
  sql: |
    SELECT COUNT(*), tstzspan '[2023-07-21 17:42:03, 2023-07-31 09:46:26]' FROM rides r WHERE r.traj && tstzspan '[2023-07-21 17:42:03, 2023-07-31 09:46:26]';
  params:
  - - '2023-07-21 17:42:03'
    - '2023-07-31 09:46:26'
- name: countActiveRidesInPeriod
  type: temporal
  sql: |
    SELECT COUNT(*), tstzspan '[2023-07-06 11:44:34, 2023-07-10 13:50:33]' FROM rides r WHERE r.traj && tstzspan '[2023-07-06 11:44:34, 2023-07-10 13:50:33]';
  params:
  - - '2023-07-06 11:44:34'
    - '2023-07-10 13:50:33'
- name: ridesCrossingPlaceWithMostIncidentsInDistrict
  type: spatial
  sql: |
    WITH incident_points AS ( SELECT i.incident_id, i.geom FROM incidents i JOIN berlin_districts d ON ST_Within(i.geom, d.geom) WHERE d.name = 'Charlottenburg-Wilmersdorf'), clusters AS ( SELECT incident_id, geom, ST_ClusterWithin(geom, 8) OVER () AS cluster FROM incident_points), hotspot AS ( SELECT ST_SetSRID(ST_Centroid(ST_Collect(geom)), 4326) AS cluster_center FROM clusters GROUP BY cluster ORDER BY COUNT(*) DESC LIMIT 1) SELECT r.ride_id, r.rider_id FROM rides r CROSS JOIN hotspot h WHERE ST_DWithin(trajectory(r.traj), h.cluster_center::geography, 500);
  params:
  - Charlottenburg-Wilmersdorf
  - 8
- name: ridesCrossingPlaceWithMostIncidentsInDistrict
  type: spatial
  sql: |
    WITH incident_points AS ( SELECT i.incident_id, i.geom FROM incidents i JOIN berlin_districts d ON ST_Within(i.geom, d.geom) WHERE d.name = 'Mitte'), clusters AS ( SELECT incident_id, geom, ST_ClusterWithin(geom, 5) OVER () AS cluster FROM incident_points), hotspot AS ( SELECT ST_SetSRID(ST_Centroid(ST_Collect(geom)), 4326) AS cluster_center FROM clusters GROUP BY cluster ORDER BY COUNT(*) DESC LIMIT 1) SELECT r.ride_id, r.rider_id FROM rides r CROSS JOIN hotspot h WHERE ST_DWithin(trajectory(r.traj), h.cluster_center::geography, 500);
  params:
  - Mitte
  - 5
- name: ridesStartedInDistrict
  type: spatial
  sql: |
    SELECT r.ride_id FROM rides r JOIN berlin_districts d ON ST_Intersects(startValue(r.traj), d.geom) WHERE d.name = 'Pankow';
  params:
  - Pankow
- name: averageRideDurationDuringDay
  type: temporal
  sql: |
    SELECT AVG(duration(r.traj)) AS avg_duration FROM rides r WHERE r.traj && span(DATE '2023-11-27'::timestamp, DATE '2023-11-27' + INTERVAL '1 day' - INTERVAL '1 second');
  params:
  - '2023-11-27'
- name: averageRideDurationDuringDay
  type: temporal
  sql: |
    SELECT AVG(duration(r.traj)) AS avg_duration FROM rides r WHERE r.traj && span(DATE '2023-06-22'::timestamp, DATE '2023-06-22' + INTERVAL '1 day' - INTERVAL '1 second');
  params:
  - '2023-06-22'
- name: averageRideDurationToGoAtUniversityInPeriod
  type: spatiotemporal
  sql: |
    SELECT AVG(duration(r.traj)) AS avg_duration FROM rides r JOIN universities u ON ST_DWithin(endValue(r.traj), u.geom::geography, 2500) WHERE r.traj && tstzspan '[2023-07-06 19:20:14, 2023-07-09 19:06:18]' AND u.name = 'Katholische-Hochschule-für-Sozialwesen-Berlin';
  params:
  - - '2023-07-06 19:20:14'
    - '2023-07-09 19:06:18'
  - Katholische-Hochschule-für-Sozialwesen-Berlin
- name: ridesCrossSeveralDistrictsOnEveningInPeriod
  type: spatiotemporal
  sql: |
    WITH evening_rides AS ( SELECT * FROM rides r WHERE r.traj && tstzspan '[2023-12-15 04:30:00, 2023-12-20 23:10:01]' AND EXISTS ( SELECT 1 FROM unnest(timestamps(r.traj)) AS t WHERE EXTRACT(HOUR FROM t) BETWEEN 18 AND 23) ), ride_districts AS ( SELECT r.ride_id, d.name FROM evening_rides r JOIN berlin_districts d ON ST_Intersects(trajectory(r.traj), d.geom) GROUP BY r.ride_id, d.name) SELECT ride_id FROM ride_districts GROUP BY ride_id HAVING COUNT(*) > 1;
  params:
  - - '2023-12-15 04:30:00'
    - '2023-12-20 23:10:01'
- name: countActiveRidesInDistrict
  type: spatial
  sql: |
    SELECT d.name, COUNT(*) AS ride_count FROM berlin_districts d JOIN rides r ON ST_Intersects(trajectory(r.traj), d.geom) WHERE d.name = 'Neukölln' GROUP BY d.name;
  params:
  - Neukölln
- name: countActiveRidesInDistrict
  type: spatial
  sql: |
    SELECT d.name, COUNT(*) AS ride_count FROM berlin_districts d JOIN rides r ON ST_Intersects(trajectory(r.traj), d.geom) WHERE d.name = 'Friedrichshain-Kreuzberg' GROUP BY d.name;
  params:
  - Friedrichshain-Kreuzberg
- name: averageRideDurationToGoAtUniversityInPeriod
  type: spatiotemporal
  sql: |
    SELECT AVG(duration(r.traj)) AS avg_duration FROM rides r JOIN universities u ON ST_DWithin(endValue(r.traj), u.geom::geography, 2500) WHERE r.traj && tstzspan '[2023-09-24 01:52:07, 2023-10-09 01:10:37]' AND u.name = 'Bard-College';
  params:
  - - '2023-09-24 01:52:07'
    - '2023-10-09 01:10:37'
  - Bard-College
- name: ridesCrossSeveralDistrictsOnEveningInPeriod
  type: spatiotemporal
  sql: |
    WITH evening_rides AS ( SELECT * FROM rides r WHERE r.traj && tstzspan '[2023-03-26 07:23:10, 2023-04-09 15:11:39]' AND EXISTS ( SELECT 1 FROM unnest(timestamps(r.traj)) AS t WHERE EXTRACT(HOUR FROM t) BETWEEN 18 AND 23) ), ride_districts AS ( SELECT r.ride_id, d.name FROM evening_rides r JOIN berlin_districts d ON ST_Intersects(trajectory(r.traj), d.geom) GROUP BY r.ride_id, d.name) SELECT ride_id FROM ride_districts GROUP BY ride_id HAVING COUNT(*) > 1;
  params:
  - - '2023-03-26 07:23:10'
    - '2023-04-09 15:11:39'
- name: ridesStartedInDistrict
  type: spatial
  sql: |
    SELECT r.ride_id FROM rides r JOIN berlin_districts d ON ST_Intersects(startValue(r.traj), d.geom) WHERE d.name = 'Marzahn-Hellersdorf';
  params:
  - Marzahn-Hellersdorf
- name: averageRideDurationToGoAtUniversityInPeriod
  type: spatiotemporal
  sql: |
    SELECT AVG(duration(r.traj)) AS avg_duration FROM rides r JOIN universities u ON ST_DWithin(endValue(r.traj), u.geom::geography, 2500) WHERE r.traj && tstzspan '[2024-02-26 06:09:51, 2024-03-09 22:24:57]' AND u.name = 'Universität-der-Künste-Berlin';
  params:
  - - '2024-02-26 06:09:51'
    - '2024-03-09 22:24:57'
  - Universität-der-Künste-Berlin
- name: averageRideDurationDuringDay
  type: temporal
  sql: |
    SELECT AVG(duration(r.traj)) AS avg_duration FROM rides r WHERE r.traj && span(DATE '2023-03-09'::timestamp, DATE '2023-03-09' + INTERVAL '1 day' - INTERVAL '1 second');
  params:
  - '2023-03-09'
- name: averageRideDurationDuringDay
  type: temporal
  sql: |
    SELECT AVG(duration(r.traj)) AS avg_duration FROM rides r WHERE r.traj && span(DATE '2023-09-03'::timestamp, DATE '2023-09-03' + INTERVAL '1 day' - INTERVAL '1 second');
  params:
  - '2023-09-03'
- name: ridesStartedInDistrict
  type: spatial
  sql: |
    SELECT r.ride_id FROM rides r JOIN berlin_districts d ON ST_Intersects(startValue(r.traj), d.geom) WHERE d.name = 'Lichtenberg';
  params:
  - Lichtenberg
- name: countActiveRidesInPeriod
  type: temporal
  sql: |
    SELECT COUNT(*), tstzspan '[2023-12-22 05:01:02, 2024-01-05 03:35:22]' FROM rides r WHERE r.traj && tstzspan '[2023-12-22 05:01:02, 2024-01-05 03:35:22]';
  params:
  - - '2023-12-22 05:01:02'
    - '2024-01-05 03:35:22'
- name: ridesCrossSeveralDistrictsOnEveningInPeriod
  type: spatiotemporal
  sql: |
    WITH evening_rides AS ( SELECT * FROM rides r WHERE r.traj && tstzspan '[2023-04-12 16:30:25, 2023-04-26 01:52:26]' AND EXISTS ( SELECT 1 FROM unnest(timestamps(r.traj)) AS t WHERE EXTRACT(HOUR FROM t) BETWEEN 18 AND 23) ), ride_districts AS ( SELECT r.ride_id, d.name FROM evening_rides r JOIN berlin_districts d ON ST_Intersects(trajectory(r.traj), d.geom) GROUP BY r.ride_id, d.name) SELECT ride_id FROM ride_districts GROUP BY ride_id HAVING COUNT(*) > 1;
  params:
  - - '2023-04-12 16:30:25'
    - '2023-04-26 01:52:26'
- name: ridesStartedInDistrict
  type: spatial
  sql: |
    SELECT r.ride_id FROM rides r JOIN berlin_districts d ON ST_Intersects(startValue(r.traj), d.geom) WHERE d.name = 'Mitte';
  params:
  - Mitte
- name: countActiveRidesInPeriod
  type: temporal
  sql: |
    SELECT COUNT(*), tstzspan '[2023-07-22 02:52:20, 2023-07-27 13:02:57]' FROM rides r WHERE r.traj && tstzspan '[2023-07-22 02:52:20, 2023-07-27 13:02:57]';
  params:
  - - '2023-07-22 02:52:20'
    - '2023-07-27 13:02:57'
- name: ridesCrossSeveralDistrictsOnEveningInPeriod
  type: spatiotemporal
  sql: |
    WITH evening_rides AS ( SELECT * FROM rides r WHERE r.traj && tstzspan '[2024-02-10 17:58:33, 2024-02-14 18:30:58]' AND EXISTS ( SELECT 1 FROM unnest(timestamps(r.traj)) AS t WHERE EXTRACT(HOUR FROM t) BETWEEN 18 AND 23) ), ride_districts AS ( SELECT r.ride_id, d.name FROM evening_rides r JOIN berlin_districts d ON ST_Intersects(trajectory(r.traj), d.geom) GROUP BY r.ride_id, d.name) SELECT ride_id FROM ride_districts GROUP BY ride_id HAVING COUNT(*) > 1;
  params:
  - - '2024-02-10 17:58:33'
    - '2024-02-14 18:30:58'
- name: averageRideDurationDuringDay
  type: temporal
  sql: |
    SELECT AVG(duration(r.traj)) AS avg_duration FROM rides r WHERE r.traj && span(DATE '2023-05-25'::timestamp, DATE '2023-05-25' + INTERVAL '1 day' - INTERVAL '1 second');
  params:
  - '2023-05-25'
- name: averageRideDurationToGoAtUniversityInPeriod
  type: spatiotemporal
  sql: |
    SELECT AVG(duration(r.traj)) AS avg_duration FROM rides r JOIN universities u ON ST_DWithin(endValue(r.traj), u.geom::geography, 2500) WHERE r.traj && tstzspan '[2023-12-27 14:33:58, 2024-01-08 01:22:46]' AND u.name = 'Charité-Campus-Klinik';
  params:
  - - '2023-12-27 14:33:58'
    - '2024-01-08 01:22:46'
  - Charité-Campus-Klinik
- name: countActiveRidesInPeriod
  type: temporal
  sql: |
    SELECT COUNT(*), tstzspan '[2023-06-04 21:50:50, 2023-06-17 21:11:35]' FROM rides r WHERE r.traj && tstzspan '[2023-06-04 21:50:50, 2023-06-17 21:11:35]';
  params:
  - - '2023-06-04 21:50:50'
    - '2023-06-17 21:11:35'
- name: averageRideDurationToGoAtUniversityInPeriod
  type: spatiotemporal
  sql: |
    SELECT AVG(duration(r.traj)) AS avg_duration FROM rides r JOIN universities u ON ST_DWithin(endValue(r.traj), u.geom::geography, 2500) WHERE r.traj && tstzspan '[2023-07-09 16:40:10, 2023-07-17 00:37:24]' AND u.name = 'Katholische-Hochschule-für-Sozialwesen-Berlin';
  params:
  - - '2023-07-09 16:40:10'
    - '2023-07-17 00:37:24'
  - Katholische-Hochschule-für-Sozialwesen-Berlin
- name: countActiveRidesInPeriod
  type: temporal
  sql: |
    SELECT COUNT(*), tstzspan '[2023-06-26 03:35:08, 2023-06-29 12:29:28]' FROM rides r WHERE r.traj && tstzspan '[2023-06-26 03:35:08, 2023-06-29 12:29:28]';
  params:
  - - '2023-06-26 03:35:08'
    - '2023-06-29 12:29:28'
- name: countActiveRidesInPeriod
  type: temporal
  sql: |
    SELECT COUNT(*), tstzspan '[2024-01-08 07:57:42, 2024-01-19 05:56:14]' FROM rides r WHERE r.traj && tstzspan '[2024-01-08 07:57:42, 2024-01-19 05:56:14]';
  params:
  - - '2024-01-08 07:57:42'
    - '2024-01-19 05:56:14'
- name: countActiveRidesInPeriod
  type: temporal
  sql: |
    SELECT COUNT(*), tstzspan '[2023-06-16 14:23:50, 2023-06-18 23:39:18]' FROM rides r WHERE r.traj && tstzspan '[2023-06-16 14:23:50, 2023-06-18 23:39:18]';
  params:
  - - '2023-06-16 14:23:50'
    - '2023-06-18 23:39:18'
- name: averageRideDurationToGoAtUniversityInPeriod
  type: spatiotemporal
  sql: |
    SELECT AVG(duration(r.traj)) AS avg_duration FROM rides r JOIN universities u ON ST_DWithin(endValue(r.traj), u.geom::geography, 2500) WHERE r.traj && tstzspan '[2023-03-14 20:08:47, 2023-03-27 13:11:05]' AND u.name = 'Universität-der-Künste-Berlin';
  params:
  - - '2023-03-14 20:08:47'
    - '2023-03-27 13:11:05'
  - Universität-der-Künste-Berlin
- name: countActiveRidesInDistrict
  type: spatial
  sql: |
    SELECT d.name, COUNT(*) AS ride_count FROM berlin_districts d JOIN rides r ON ST_Intersects(trajectory(r.traj), d.geom) WHERE d.name = 'Tempelhof-Schöneberg' GROUP BY d.name;
  params:
  - Tempelhof-Schöneberg
- name: countActiveRidesInPeriod
  type: temporal
  sql: |
    SELECT COUNT(*), tstzspan '[2023-12-22 14:14:57, 2023-12-28 04:43:15]' FROM rides r WHERE r.traj && tstzspan '[2023-12-22 14:14:57, 2023-12-28 04:43:15]';
  params:
  - - '2023-12-22 14:14:57'
    - '2023-12-28 04:43:15'
- name: countActiveRidesInDistrict
  type: spatial
  sql: |
    SELECT d.name, COUNT(*) AS ride_count FROM berlin_districts d JOIN rides r ON ST_Intersects(trajectory(r.traj), d.geom) WHERE d.name = 'Charlottenburg-Wilmersdorf' GROUP BY d.name;
  params:
  - Charlottenburg-Wilmersdorf
- name: countActiveRidesInDistrict
  type: spatial
  sql: |
    SELECT d.name, COUNT(*) AS ride_count FROM berlin_districts d JOIN rides r ON ST_Intersects(trajectory(r.traj), d.geom) WHERE d.name = 'Steglitz-Zehlendorf' GROUP BY d.name;
  params:
  - Steglitz-Zehlendorf
- name: ridesCrossSeveralDistrictsOnEveningInPeriod
  type: spatiotemporal
  sql: |
    WITH evening_rides AS ( SELECT * FROM rides r WHERE r.traj && tstzspan '[2023-12-05 21:34:29, 2023-12-18 05:59:54]' AND EXISTS ( SELECT 1 FROM unnest(timestamps(r.traj)) AS t WHERE EXTRACT(HOUR FROM t) BETWEEN 18 AND 23) ), ride_districts AS ( SELECT r.ride_id, d.name FROM evening_rides r JOIN berlin_districts d ON ST_Intersects(trajectory(r.traj), d.geom) GROUP BY r.ride_id, d.name) SELECT ride_id FROM ride_districts GROUP BY ride_id HAVING COUNT(*) > 1;
  params:
  - - '2023-12-05 21:34:29'
    - '2023-12-18 05:59:54'
- name: ridesCrossingPlaceWithMostIncidentsInDistrict
  type: spatial
  sql: |
    WITH incident_points AS ( SELECT i.incident_id, i.geom FROM incidents i JOIN berlin_districts d ON ST_Within(i.geom, d.geom) WHERE d.name = 'Tempelhof-Schöneberg'), clusters AS ( SELECT incident_id, geom, ST_ClusterWithin(geom, 4) OVER () AS cluster FROM incident_points), hotspot AS ( SELECT ST_SetSRID(ST_Centroid(ST_Collect(geom)), 4326) AS cluster_center FROM clusters GROUP BY cluster ORDER BY COUNT(*) DESC LIMIT 1) SELECT r.ride_id, r.rider_id FROM rides r CROSS JOIN hotspot h WHERE ST_DWithin(trajectory(r.traj), h.cluster_center::geography, 500);
  params:
  - Tempelhof-Schöneberg
  - 4
- name: ridesCrossSeveralDistrictsOnEveningInPeriod
  type: spatiotemporal
  sql: |
    WITH evening_rides AS ( SELECT * FROM rides r WHERE r.traj && tstzspan '[2024-02-13 07:07:40, 2024-02-17 08:29:58]' AND EXISTS ( SELECT 1 FROM unnest(timestamps(r.traj)) AS t WHERE EXTRACT(HOUR FROM t) BETWEEN 18 AND 23) ), ride_districts AS ( SELECT r.ride_id, d.name FROM evening_rides r JOIN berlin_districts d ON ST_Intersects(trajectory(r.traj), d.geom) GROUP BY r.ride_id, d.name) SELECT ride_id FROM ride_districts GROUP BY ride_id HAVING COUNT(*) > 1;
  params:
  - - '2024-02-13 07:07:40'
    - '2024-02-17 08:29:58'
- name: countActiveRidesInDistrict
  type: spatial
  sql: |
    SELECT d.name, COUNT(*) AS ride_count FROM berlin_districts d JOIN rides r ON ST_Intersects(trajectory(r.traj), d.geom) WHERE d.name = 'Lichtenberg' GROUP BY d.name;
  params:
  - Lichtenberg
- name: ridesStartedInDistrict
  type: spatial
  sql: |
    SELECT r.ride_id FROM rides r JOIN berlin_districts d ON ST_Intersects(startValue(r.traj), d.geom) WHERE d.name = 'Lichtenberg';
  params:
  - Lichtenberg
- name: ridesCrossingPlaceWithMostIncidentsInDistrict
  type: spatial
  sql: |
    WITH incident_points AS ( SELECT i.incident_id, i.geom FROM incidents i JOIN berlin_districts d ON ST_Within(i.geom, d.geom) WHERE d.name = 'Friedrichshain-Kreuzberg'), clusters AS ( SELECT incident_id, geom, ST_ClusterWithin(geom, 7) OVER () AS cluster FROM incident_points), hotspot AS ( SELECT ST_SetSRID(ST_Centroid(ST_Collect(geom)), 4326) AS cluster_center FROM clusters GROUP BY cluster ORDER BY COUNT(*) DESC LIMIT 1) SELECT r.ride_id, r.rider_id FROM rides r CROSS JOIN hotspot h WHERE ST_DWithin(trajectory(r.traj), h.cluster_center::geography, 500);
  params:
  - Friedrichshain-Kreuzberg
  - 7
- name: averageRideDurationToGoAtUniversityInPeriod
  type: spatiotemporal
  sql: |
    SELECT AVG(duration(r.traj)) AS avg_duration FROM rides r JOIN universities u ON ST_DWithin(endValue(r.traj), u.geom::geography, 2500) WHERE r.traj && tstzspan '[2023-06-12 13:12:17, 2023-06-18 06:28:31]' AND u.name = 'Charité-Campus-Klinik';
  params:
  - - '2023-06-12 13:12:17'
    - '2023-06-18 06:28:31'
  - Charité-Campus-Klinik
- name: averageRideDurationDuringDay
  type: temporal
  sql: |
    SELECT AVG(duration(r.traj)) AS avg_duration FROM rides r WHERE r.traj && span(DATE '2023-11-03'::timestamp, DATE '2023-11-03' + INTERVAL '1 day' - INTERVAL '1 second');
  params:
  - '2023-11-03'
- name: averageRideDurationToGoAtUniversityInPeriod
  type: spatiotemporal
  sql: |
    SELECT AVG(duration(r.traj)) AS avg_duration FROM rides r JOIN universities u ON ST_DWithin(endValue(r.traj), u.geom::geography, 2500) WHERE r.traj && tstzspan '[2023-03-12 09:25:51, 2023-03-22 16:12:22]' AND u.name = 'Freie-Universität-Berlin';
  params:
  - - '2023-03-12 09:25:51'
    - '2023-03-22 16:12:22'
  - Freie-Universität-Berlin
- name: ridesCrossingPlaceWithMostIncidentsInDistrict
  type: spatial
  sql: |
    WITH incident_points AS ( SELECT i.incident_id, i.geom FROM incidents i JOIN berlin_districts d ON ST_Within(i.geom, d.geom) WHERE d.name = 'Lichtenberg'), clusters AS ( SELECT incident_id, geom, ST_ClusterWithin(geom, 1) OVER () AS cluster FROM incident_points), hotspot AS ( SELECT ST_SetSRID(ST_Centroid(ST_Collect(geom)), 4326) AS cluster_center FROM clusters GROUP BY cluster ORDER BY COUNT(*) DESC LIMIT 1) SELECT r.ride_id, r.rider_id FROM rides r CROSS JOIN hotspot h WHERE ST_DWithin(trajectory(r.traj), h.cluster_center::geography, 500);
  params:
  - Lichtenberg
  - 1
- name: averageRideDurationToGoAtUniversityInPeriod
  type: spatiotemporal
  sql: |
    SELECT AVG(duration(r.traj)) AS avg_duration FROM rides r JOIN universities u ON ST_DWithin(endValue(r.traj), u.geom::geography, 2500) WHERE r.traj && tstzspan '[2023-08-01 19:41:00, 2023-08-13 18:23:48]' AND u.name = 'Katholische-Hochschule-für-Sozialwesen-Berlin';
  params:
  - - '2023-08-01 19:41:00'
    - '2023-08-13 18:23:48'
  - Katholische-Hochschule-für-Sozialwesen-Berlin
- name: ridesStartedInDistrict
  type: spatial
  sql: |
    SELECT r.ride_id FROM rides r JOIN berlin_districts d ON ST_Intersects(startValue(r.traj), d.geom) WHERE d.name = 'Pankow';
  params:
  - Pankow
- name: ridesCrossingPlaceWithMostIncidentsInDistrict
  type: spatial
  sql: |
    WITH incident_points AS ( SELECT i.incident_id, i.geom FROM incidents i JOIN berlin_districts d ON ST_Within(i.geom, d.geom) WHERE d.name = 'Mitte'), clusters AS ( SELECT incident_id, geom, ST_ClusterWithin(geom, 6) OVER () AS cluster FROM incident_points), hotspot AS ( SELECT ST_SetSRID(ST_Centroid(ST_Collect(geom)), 4326) AS cluster_center FROM clusters GROUP BY cluster ORDER BY COUNT(*) DESC LIMIT 1) SELECT r.ride_id, r.rider_id FROM rides r CROSS JOIN hotspot h WHERE ST_DWithin(trajectory(r.traj), h.cluster_center::geography, 500);
  params:
  - Mitte
  - 6
- name: ridesStartedInDistrict
  type: spatial
  sql: |
    SELECT r.ride_id FROM rides r JOIN berlin_districts d ON ST_Intersects(startValue(r.traj), d.geom) WHERE d.name = 'Pankow';
  params:
  - Pankow
- name: countActiveRidesInDistrict
  type: spatial
  sql: |
    SELECT d.name, COUNT(*) AS ride_count FROM berlin_districts d JOIN rides r ON ST_Intersects(trajectory(r.traj), d.geom) WHERE d.name = 'Charlottenburg-Wilmersdorf' GROUP BY d.name;
  params:
  - Charlottenburg-Wilmersdorf
- name: countActiveRidesInDistrict
  type: spatial
  sql: |
    SELECT d.name, COUNT(*) AS ride_count FROM berlin_districts d JOIN rides r ON ST_Intersects(trajectory(r.traj), d.geom) WHERE d.name = 'Neukölln' GROUP BY d.name;
  params:
  - Neukölln
- name: averageRideDurationDuringDay
  type: temporal
  sql: |
    SELECT AVG(duration(r.traj)) AS avg_duration FROM rides r WHERE r.traj && span(DATE '2023-08-14'::timestamp, DATE '2023-08-14' + INTERVAL '1 day' - INTERVAL '1 second');
  params:
  - '2023-08-14'
- name: ridesStartedInDistrict
  type: spatial
  sql: |
    SELECT r.ride_id FROM rides r JOIN berlin_districts d ON ST_Intersects(startValue(r.traj), d.geom) WHERE d.name = 'Friedrichshain-Kreuzberg';
  params:
  - Friedrichshain-Kreuzberg
- name: countActiveRidesInDistrict
  type: spatial
  sql: |
    SELECT d.name, COUNT(*) AS ride_count FROM berlin_districts d JOIN rides r ON ST_Intersects(trajectory(r.traj), d.geom) WHERE d.name = 'Reinickendorf' GROUP BY d.name;
  params:
  - Reinickendorf
- name: countActiveRidesInPeriod
  type: temporal
  sql: |
    SELECT COUNT(*), tstzspan '[2023-08-21 10:41:03, 2023-08-31 04:35:50]' FROM rides r WHERE r.traj && tstzspan '[2023-08-21 10:41:03, 2023-08-31 04:35:50]';
  params:
  - - '2023-08-21 10:41:03'
    - '2023-08-31 04:35:50'
- name: ridesCrossSeveralDistrictsOnEveningInPeriod
  type: spatiotemporal
  sql: |
    WITH evening_rides AS ( SELECT * FROM rides r WHERE r.traj && tstzspan '[2023-09-15 08:48:59, 2023-09-17 19:55:36]' AND EXISTS ( SELECT 1 FROM unnest(timestamps(r.traj)) AS t WHERE EXTRACT(HOUR FROM t) BETWEEN 18 AND 23) ), ride_districts AS ( SELECT r.ride_id, d.name FROM evening_rides r JOIN berlin_districts d ON ST_Intersects(trajectory(r.traj), d.geom) GROUP BY r.ride_id, d.name) SELECT ride_id FROM ride_districts GROUP BY ride_id HAVING COUNT(*) > 1;
  params:
  - - '2023-09-15 08:48:59'
    - '2023-09-17 19:55:36'
- name: averageRideDurationDuringDay
  type: temporal
  sql: |
    SELECT AVG(duration(r.traj)) AS avg_duration FROM rides r WHERE r.traj && span(DATE '2023-09-21'::timestamp, DATE '2023-09-21' + INTERVAL '1 day' - INTERVAL '1 second');
  params:
  - '2023-09-21'
- name: ridesStartedInDistrict
  type: spatial
  sql: |
    SELECT r.ride_id FROM rides r JOIN berlin_districts d ON ST_Intersects(startValue(r.traj), d.geom) WHERE d.name = 'Charlottenburg-Wilmersdorf';
  params:
  - Charlottenburg-Wilmersdorf
- name: countActiveRidesInDistrict
  type: spatial
  sql: |
    SELECT d.name, COUNT(*) AS ride_count FROM berlin_districts d JOIN rides r ON ST_Intersects(trajectory(r.traj), d.geom) WHERE d.name = 'Charlottenburg-Wilmersdorf' GROUP BY d.name;
  params:
  - Charlottenburg-Wilmersdorf
- name: averageRideDurationToGoAtUniversityInPeriod
  type: spatiotemporal
  sql: |
    SELECT AVG(duration(r.traj)) AS avg_duration FROM rides r JOIN universities u ON ST_DWithin(endValue(r.traj), u.geom::geography, 2500) WHERE r.traj && tstzspan '[2023-11-11 19:51:52, 2023-11-19 19:06:47]' AND u.name = 'Bard-College';
  params:
  - - '2023-11-11 19:51:52'
    - '2023-11-19 19:06:47'
  - Bard-College
- name: averageRideDurationDuringDay
  type: temporal
  sql: |
    SELECT AVG(duration(r.traj)) AS avg_duration FROM rides r WHERE r.traj && span(DATE '2023-09-07'::timestamp, DATE '2023-09-07' + INTERVAL '1 day' - INTERVAL '1 second');
  params:
  - '2023-09-07'
- name: averageRideDurationDuringDay
  type: temporal
  sql: |
    SELECT AVG(duration(r.traj)) AS avg_duration FROM rides r WHERE r.traj && span(DATE '2023-03-12'::timestamp, DATE '2023-03-12' + INTERVAL '1 day' - INTERVAL '1 second');
  params:
  - '2023-03-12'
- name: ridesCrossSeveralDistrictsOnEveningInPeriod
  type: spatiotemporal
  sql: |
    WITH evening_rides AS ( SELECT * FROM rides r WHERE r.traj && tstzspan '[2023-10-09 09:58:01, 2023-10-14 14:52:50]' AND EXISTS ( SELECT 1 FROM unnest(timestamps(r.traj)) AS t WHERE EXTRACT(HOUR FROM t) BETWEEN 18 AND 23) ), ride_districts AS ( SELECT r.ride_id, d.name FROM evening_rides r JOIN berlin_districts d ON ST_Intersects(trajectory(r.traj), d.geom) GROUP BY r.ride_id, d.name) SELECT ride_id FROM ride_districts GROUP BY ride_id HAVING COUNT(*) > 1;
  params:
  - - '2023-10-09 09:58:01'
    - '2023-10-14 14:52:50'
- name: ridesCrossingPlaceWithMostIncidentsInDistrict
  type: spatial
  sql: |
    WITH incident_points AS ( SELECT i.incident_id, i.geom FROM incidents i JOIN berlin_districts d ON ST_Within(i.geom, d.geom) WHERE d.name = 'Treptow-Köpenick'), clusters AS ( SELECT incident_id, geom, ST_ClusterWithin(geom, 2) OVER () AS cluster FROM incident_points), hotspot AS ( SELECT ST_SetSRID(ST_Centroid(ST_Collect(geom)), 4326) AS cluster_center FROM clusters GROUP BY cluster ORDER BY COUNT(*) DESC LIMIT 1) SELECT r.ride_id, r.rider_id FROM rides r CROSS JOIN hotspot h WHERE ST_DWithin(trajectory(r.traj), h.cluster_center::geography, 500);
  params:
  - Treptow-Köpenick
  - 2
- name: ridesCrossSeveralDistrictsOnEveningInPeriod
  type: spatiotemporal
  sql: |
    WITH evening_rides AS ( SELECT * FROM rides r WHERE r.traj && tstzspan '[2024-01-24 12:52:19, 2024-02-04 16:52:34]' AND EXISTS ( SELECT 1 FROM unnest(timestamps(r.traj)) AS t WHERE EXTRACT(HOUR FROM t) BETWEEN 18 AND 23) ), ride_districts AS ( SELECT r.ride_id, d.name FROM evening_rides r JOIN berlin_districts d ON ST_Intersects(trajectory(r.traj), d.geom) GROUP BY r.ride_id, d.name) SELECT ride_id FROM ride_districts GROUP BY ride_id HAVING COUNT(*) > 1;
  params:
  - - '2024-01-24 12:52:19'
    - '2024-02-04 16:52:34'
- name: ridesCrossingPlaceWithMostIncidentsInDistrict
  type: spatial
  sql: |
    WITH incident_points AS ( SELECT i.incident_id, i.geom FROM incidents i JOIN berlin_districts d ON ST_Within(i.geom, d.geom) WHERE d.name = 'Reinickendorf'), clusters AS ( SELECT incident_id, geom, ST_ClusterWithin(geom, 5) OVER () AS cluster FROM incident_points), hotspot AS ( SELECT ST_SetSRID(ST_Centroid(ST_Collect(geom)), 4326) AS cluster_center FROM clusters GROUP BY cluster ORDER BY COUNT(*) DESC LIMIT 1) SELECT r.ride_id, r.rider_id FROM rides r CROSS JOIN hotspot h WHERE ST_DWithin(trajectory(r.traj), h.cluster_center::geography, 500);
  params:
  - Reinickendorf
  - 5
- name: ridesCrossSeveralDistrictsOnEveningInPeriod
  type: spatiotemporal
  sql: |
    WITH evening_rides AS ( SELECT * FROM rides r WHERE r.traj && tstzspan '[2023-05-26 07:00:34, 2023-05-31 10:11:02]' AND EXISTS ( SELECT 1 FROM unnest(timestamps(r.traj)) AS t WHERE EXTRACT(HOUR FROM t) BETWEEN 18 AND 23) ), ride_districts AS ( SELECT r.ride_id, d.name FROM evening_rides r JOIN berlin_districts d ON ST_Intersects(trajectory(r.traj), d.geom) GROUP BY r.ride_id, d.name) SELECT ride_id FROM ride_districts GROUP BY ride_id HAVING COUNT(*) > 1;
  params:
  - - '2023-05-26 07:00:34'
    - '2023-05-31 10:11:02'
- name: ridesCrossingPlaceWithMostIncidentsInDistrict
  type: spatial
  sql: |
    WITH incident_points AS ( SELECT i.incident_id, i.geom FROM incidents i JOIN berlin_districts d ON ST_Within(i.geom, d.geom) WHERE d.name = 'Lichtenberg'), clusters AS ( SELECT incident_id, geom, ST_ClusterWithin(geom, 3) OVER () AS cluster FROM incident_points), hotspot AS ( SELECT ST_SetSRID(ST_Centroid(ST_Collect(geom)), 4326) AS cluster_center FROM clusters GROUP BY cluster ORDER BY COUNT(*) DESC LIMIT 1) SELECT r.ride_id, r.rider_id FROM rides r CROSS JOIN hotspot h WHERE ST_DWithin(trajectory(r.traj), h.cluster_center::geography, 500);
  params:
  - Lichtenberg
  - 3
- name: ridesStartedInDistrict
  type: spatial
  sql: |
    SELECT r.ride_id FROM rides r JOIN berlin_districts d ON ST_Intersects(startValue(r.traj), d.geom) WHERE d.name = 'Friedrichshain-Kreuzberg';
  params:
  - Friedrichshain-Kreuzberg
- name: ridesCrossingPlaceWithMostIncidentsInDistrict
  type: spatial
  sql: |
    WITH incident_points AS ( SELECT i.incident_id, i.geom FROM incidents i JOIN berlin_districts d ON ST_Within(i.geom, d.geom) WHERE d.name = 'Friedrichshain-Kreuzberg'), clusters AS ( SELECT incident_id, geom, ST_ClusterWithin(geom, 7) OVER () AS cluster FROM incident_points), hotspot AS ( SELECT ST_SetSRID(ST_Centroid(ST_Collect(geom)), 4326) AS cluster_center FROM clusters GROUP BY cluster ORDER BY COUNT(*) DESC LIMIT 1) SELECT r.ride_id, r.rider_id FROM rides r CROSS JOIN hotspot h WHERE ST_DWithin(trajectory(r.traj), h.cluster_center::geography, 500);
  params:
  - Friedrichshain-Kreuzberg
  - 7
