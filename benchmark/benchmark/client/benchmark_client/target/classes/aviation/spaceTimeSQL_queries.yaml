- name: flightClosestToPoint
  type: spatial
  sql: |
    WITH closest AS (
      SELECT flightid,
             ST_Distance(ST_Point(x[0], y[0]), ST_ToGeom('POINT(6.493143573741311 51.308446179913005)'::gpoint)) AS min_distance
      FROM fsegment
      WHERE ST_DWithin(ST_Point(x[0], y[0]), ST_ToGeom('POINT(6.493143573741311 51.308446179913005)'::gpoint), 5000)
      ORDER BY min_distance
    )
    SELECT f.flightid, f.airplanetype, f.origin, f.destination, min_distance
    FROM closest c JOIN flight f ON c.flightid = f.flightid
    ORDER BY min_distance;
  params:
  - POINT(6.493143573741311 51.308446179913005)
  - 5
- name: countActiveFlightsInPeriod
  type: temporalbench
  sql: |
    SELECT COUNT(*) FROM (
    SELECT DISTINCT f.flightid
    FROM fsegment f
    WHERE f.t && EPOCHRANGE '[2023-11-10 07:57:42, 2023-11-21 05:56:14]' -- range intersection check
    );
  params:
  - - '2023-11-10 07:57:42'
    - '2023-11-21 05:56:14'
- name: flightClosestToPoint
  type: spatial
  sql: |
    WITH closest AS (
      SELECT flightid,
             ST_Distance(ST_Point(x[0], y[0]), ST_ToGeom('POINT(8.51848774381303 50.90336622647214)'::gpoint)) AS min_distance
      FROM fsegment
      WHERE ST_DWithin(ST_Point(x[0], y[0]), ST_ToGeom('POINT(8.51848774381303 50.90336622647214)'::gpoint), 5000)
      ORDER BY min_distance
    )
    SELECT f.flightid, f.airplanetype, f.origin, f.destination, min_distance
    FROM closest c JOIN flight f ON c.flightid = f.flightid
    ORDER BY min_distance;
  params:
  - POINT(8.51848774381303 50.90336622647214)
  - 9
- name: countFlightsInCounties
  type: spatial
  sql: |
    SELECT name, COUNT(flightid) AS flight_count FROM (
      SELECT DISTINCT k.name, f.flightid
      FROM counties k
      JOIN fsegment f ON ST_Intersects(ST_Line(f.x[0], f.y[0], f.x[1], f.y[1]),ST_ToGeom(k.geom::gmpolygon))
      WHERE k.name = 'Krs Euskirchen'
    ) GROUP BY name;
  params:
  - Krs Euskirchen
- name: flightsInCountyInPeriod
  type: spatiotemporal
  sql: |
    SELECT DISTINCT f.flightid
    FROM fsegment f
    JOIN counties k ON ST_Point(f.x[0], f.y[0]) <@ k.geom::mpolygon
    WHERE k.name = 'Krs Oberbergischer Kreis' AND t && EPOCHRANGE '[2023-06-25 07:23:56, 2023-07-02 05:52:25]';
  params:
  - - '2023-06-25 07:23:56'
    - '2023-07-02 05:52:25'
  - Krs Oberbergischer Kreis
- name: flightClosestToPoint
  type: spatial
  sql: |
    WITH closest AS (
      SELECT flightid,
             ST_Distance(ST_Point(x[0], y[0]), ST_ToGeom('POINT(7.11561592823072 51.3751924053712)'::gpoint)) AS min_distance
      FROM fsegment
      WHERE ST_DWithin(ST_Point(x[0], y[0]), ST_ToGeom('POINT(7.11561592823072 51.3751924053712)'::gpoint), 5000)
      ORDER BY min_distance
    )
    SELECT f.flightid, f.airplanetype, f.origin, f.destination, min_distance
    FROM closest c JOIN flight f ON c.flightid = f.flightid
    ORDER BY min_distance;
  params:
  - POINT(7.11561592823072 51.3751924053712)
  - 7
- name: countFlightsInCounties
  type: spatial
  sql: |
    SELECT name, COUNT(flightid) AS flight_count FROM (
      SELECT DISTINCT k.name, f.flightid
      FROM counties k
      JOIN fsegment f ON ST_Intersects(ST_Line(f.x[0], f.y[0], f.x[1], f.y[1]),ST_ToGeom(k.geom::gmpolygon))
      WHERE k.name = 'Krs Rheinisch-Bergischer Kreis'
    ) GROUP BY name;
  params:
  - Krs Rheinisch-Bergischer Kreis
- name: airportUtilizationInPeriod
  type: temporal
  sql: |
    WITH departures AS (
        SELECT airport, COUNT(departure) AS departure_count
        FROM (SELECT DISTINCT f.origin AS airport, f.flightid AS departure
              FROM flight f WHERE f.t && EPOCHRANGE '[2023-01-24 12:34:38, 2023-01-25 18:35:13]') GROUP BY airport
      ), arrivals AS (
        SELECT airport, COUNT(arrival) AS arrival_count
        FROM (SELECT DISTINCT f.destination AS airport, f.flightid AS arrival
              FROM flight f WHERE f.t && EPOCHRANGE '[2023-01-24 12:34:38, 2023-01-25 18:35:13]') GROUP BY airport
      )
      SELECT COALESCE(d.airport, a.airport) AS airport,
            COALESCE(d.departure_count, 0) AS departures,
            COALESCE(a.arrival_count, 0) AS arrivals,
            COALESCE(d.departure_count, 0) + COALESCE(a.arrival_count, 0) AS traffic_count
      FROM departures d FULL JOIN arrivals a ON d.airport = a.airport;
  params:
  - - '2023-01-24 12:34:38'
    - '2023-01-25 18:35:13'
- name: countActiveFlightsInPeriod
  type: temporalbench
  sql: |
    SELECT COUNT(*) FROM (
    SELECT DISTINCT f.flightid
    FROM fsegment f
    WHERE f.t && EPOCHRANGE '[2023-05-08 11:44:34, 2023-05-12 13:50:33]' -- range intersection check
    );
  params:
  - - '2023-05-08 11:44:34'
    - '2023-05-12 13:50:33'
- name: inCityRadiusInPeriod
  type: spatiotemporal
  sql: |
    SELECT f.flightid, fl.airplanetype, fl.origin, fl.destination
    FROM cities AS c
    JOIN fsegment AS f ON ST_DWithin(ST_Line(f.x[0], f.y[0], f.x[1], f.y[1]),
                                     ST_ToGeom(c.geom::gpoint), 7.290648985537254e-06)
    JOIN flight AS fl ON fl.flightid = f.flightid
    WHERE c.name = 'Niederkassel'
      AND f.t && EPOCHRANGE '[2023-06-28 19:00:00, 2023-07-07 03:38:06]'
      AND fl.t && EPOCHRANGE '[2023-06-28 19:00:00, 2023-07-07 03:38:06]';
  params:
  - - '2023-06-28 19:00:00'
    - '2023-07-07 03:38:06'
  - Niederkassel
  - 7.290648985537254e-06
- name: airportUtilizationInPeriod
  type: temporal
  sql: |
    WITH departures AS (
        SELECT airport, COUNT(departure) AS departure_count
        FROM (SELECT DISTINCT f.origin AS airport, f.flightid AS departure
              FROM flight f WHERE f.t && EPOCHRANGE '[2023-05-10 15:56:32, 2023-05-11 11:06:54]') GROUP BY airport
      ), arrivals AS (
        SELECT airport, COUNT(arrival) AS arrival_count
        FROM (SELECT DISTINCT f.destination AS airport, f.flightid AS arrival
              FROM flight f WHERE f.t && EPOCHRANGE '[2023-05-10 15:56:32, 2023-05-11 11:06:54]') GROUP BY airport
      )
      SELECT COALESCE(d.airport, a.airport) AS airport,
            COALESCE(d.departure_count, 0) AS departures,
            COALESCE(a.arrival_count, 0) AS arrivals,
            COALESCE(d.departure_count, 0) + COALESCE(a.arrival_count, 0) AS traffic_count
      FROM departures d FULL JOIN arrivals a ON d.airport = a.airport;
  params:
  - - '2023-05-10 15:56:32'
    - '2023-05-11 11:06:54'
- name: airportUtilizationInPeriod
  type: temporal
  sql: |
    WITH departures AS (
        SELECT airport, COUNT(departure) AS departure_count
        FROM (SELECT DISTINCT f.origin AS airport, f.flightid AS departure
              FROM flight f WHERE f.t && EPOCHRANGE '[2023-12-27 09:37:01, 2023-12-28 13:30:10]') GROUP BY airport
      ), arrivals AS (
        SELECT airport, COUNT(arrival) AS arrival_count
        FROM (SELECT DISTINCT f.destination AS airport, f.flightid AS arrival
              FROM flight f WHERE f.t && EPOCHRANGE '[2023-12-27 09:37:01, 2023-12-28 13:30:10]') GROUP BY airport
      )
      SELECT COALESCE(d.airport, a.airport) AS airport,
            COALESCE(d.departure_count, 0) AS departures,
            COALESCE(a.arrival_count, 0) AS arrivals,
            COALESCE(d.departure_count, 0) + COALESCE(a.arrival_count, 0) AS traffic_count
      FROM departures d FULL JOIN arrivals a ON d.airport = a.airport;
  params:
  - - '2023-12-27 09:37:01'
    - '2023-12-28 13:30:10'
- name: inCityRadiusInPeriod
  type: spatiotemporal
  sql: |
    SELECT f.flightid, fl.airplanetype, fl.origin, fl.destination
    FROM cities AS c
    JOIN fsegment AS f ON ST_DWithin(ST_Line(f.x[0], f.y[0], f.x[1], f.y[1]),
                                     ST_ToGeom(c.geom::gpoint), 1.3651869083553872e-05)
    JOIN flight AS fl ON fl.flightid = f.flightid
    WHERE c.name = 'Willich'
      AND f.t && EPOCHRANGE '[2023-05-09 04:49:52, 2023-05-16 13:07:32]'
      AND fl.t && EPOCHRANGE '[2023-05-09 04:49:52, 2023-05-16 13:07:32]';
  params:
  - - '2023-05-09 04:49:52'
    - '2023-05-16 13:07:32'
  - Willich
  - 1.3651869083553872e-05
- name: airportUtilizationInPeriod
  type: temporal
  sql: |
    WITH departures AS (
        SELECT airport, COUNT(departure) AS departure_count
        FROM (SELECT DISTINCT f.origin AS airport, f.flightid AS departure
              FROM flight f WHERE f.t && EPOCHRANGE '[2023-09-18 21:32:09, 2023-09-19 13:21:34]') GROUP BY airport
      ), arrivals AS (
        SELECT airport, COUNT(arrival) AS arrival_count
        FROM (SELECT DISTINCT f.destination AS airport, f.flightid AS arrival
              FROM flight f WHERE f.t && EPOCHRANGE '[2023-09-18 21:32:09, 2023-09-19 13:21:34]') GROUP BY airport
      )
      SELECT COALESCE(d.airport, a.airport) AS airport,
            COALESCE(d.departure_count, 0) AS departures,
            COALESCE(a.arrival_count, 0) AS arrivals,
            COALESCE(d.departure_count, 0) + COALESCE(a.arrival_count, 0) AS traffic_count
      FROM departures d FULL JOIN arrivals a ON d.airport = a.airport;
  params:
  - - '2023-09-18 21:32:09'
    - '2023-09-19 13:21:34'
- name: countActiveFlightsInPeriod
  type: temporalbench
  sql: |
    SELECT COUNT(*) FROM (
    SELECT DISTINCT f.flightid
    FROM fsegment f
    WHERE f.t && EPOCHRANGE '[2023-05-23 17:42:03, 2023-06-02 09:46:26]' -- range intersection check
    );
  params:
  - - '2023-05-23 17:42:03'
    - '2023-06-02 09:46:26'
- name: flightsInCountyInPeriod
  type: spatiotemporal
  sql: |
    SELECT DISTINCT f.flightid
    FROM fsegment f
    JOIN counties k ON ST_Point(f.x[0], f.y[0]) <@ k.geom::mpolygon
    WHERE k.name = 'Krs Unna' AND t && EPOCHRANGE '[2023-09-13 19:51:52, 2023-09-21 19:06:47]';
  params:
  - - '2023-09-13 19:51:52'
    - '2023-09-21 19:06:47'
  - Krs Unna
- name: inCityRadiusInPeriod
  type: spatiotemporal
  sql: |
    SELECT f.flightid, fl.airplanetype, fl.origin, fl.destination
    FROM cities AS c
    JOIN fsegment AS f ON ST_DWithin(ST_Line(f.x[0], f.y[0], f.x[1], f.y[1]),
                                     ST_ToGeom(c.geom::gpoint), 5.257433392467601e-06)
    JOIN flight AS fl ON fl.flightid = f.flightid
    WHERE c.name = 'Rheinbach'
      AND f.t && EPOCHRANGE '[2023-05-19 04:14:32, 2023-05-24 10:00:14]'
      AND fl.t && EPOCHRANGE '[2023-05-19 04:14:32, 2023-05-24 10:00:14]';
  params:
  - - '2023-05-19 04:14:32'
    - '2023-05-24 10:00:14'
  - Rheinbach
  - 5.257433392467601e-06
- name: flightClosestToPoint
  type: spatial
  sql: |
    WITH closest AS (
      SELECT flightid,
             ST_Distance(ST_Point(x[0], y[0]), ST_ToGeom('POINT(6.890140091803668 50.795947278511115)'::gpoint)) AS min_distance
      FROM fsegment
      WHERE ST_DWithin(ST_Point(x[0], y[0]), ST_ToGeom('POINT(6.890140091803668 50.795947278511115)'::gpoint), 5000)
      ORDER BY min_distance
    )
    SELECT f.flightid, f.airplanetype, f.origin, f.destination, min_distance
    FROM closest c JOIN flight f ON c.flightid = f.flightid
    ORDER BY min_distance;
  params:
  - POINT(6.890140091803668 50.795947278511115)
  - 7
- name: countFlightsInCounties
  type: spatial
  sql: |
    SELECT name, COUNT(flightid) AS flight_count FROM (
      SELECT DISTINCT k.name, f.flightid
      FROM counties k
      JOIN fsegment f ON ST_Intersects(ST_Line(f.x[0], f.y[0], f.x[1], f.y[1]),ST_ToGeom(k.geom::gmpolygon))
      WHERE k.name = 'Krs Rheinisch-Bergischer Kreis'
    ) GROUP BY name;
  params:
  - Krs Rheinisch-Bergischer Kreis
- name: countActiveFlightsInPeriod
  type: temporalbench
  sql: |
    SELECT COUNT(*) FROM (
    SELECT DISTINCT f.flightid
    FROM fsegment f
    WHERE f.t && EPOCHRANGE '[2023-10-24 05:01:02, 2023-11-07 03:35:22]' -- range intersection check
    );
  params:
  - - '2023-10-24 05:01:02'
    - '2023-11-07 03:35:22'
- name: flightsInCountyInPeriod
  type: spatiotemporal
  sql: |
    SELECT DISTINCT f.flightid
    FROM fsegment f
    JOIN counties k ON ST_Point(f.x[0], f.y[0]) <@ k.geom::mpolygon
    WHERE k.name = 'Krs Minden-Luebbecke' AND t && EPOCHRANGE '[2023-01-08 09:46:04, 2023-01-17 05:51:30]';
  params:
  - - '2023-01-08 09:46:04'
    - '2023-01-17 05:51:30'
  - Krs Minden-Luebbecke
- name: countActiveFlightsInPeriod
  type: temporalbench
  sql: |
    SELECT COUNT(*) FROM (
    SELECT DISTINCT f.flightid
    FROM fsegment f
    WHERE f.t && EPOCHRANGE '[2023-06-23 10:41:03, 2023-07-03 04:35:50]' -- range intersection check
    );
  params:
  - - '2023-06-23 10:41:03'
    - '2023-07-03 04:35:50'
- name: flightsInCountyInPeriod
  type: spatiotemporal
  sql: |
    SELECT DISTINCT f.flightid
    FROM fsegment f
    JOIN counties k ON ST_Point(f.x[0], f.y[0]) <@ k.geom::mpolygon
    WHERE k.name = 'Krs Coesfeld' AND t && EPOCHRANGE '[2023-06-20 11:48:48, 2023-06-27 21:15:05]';
  params:
  - - '2023-06-20 11:48:48'
    - '2023-06-27 21:15:05'
  - Krs Coesfeld
- name: airportUtilizationInPeriod
  type: temporal
  sql: |
    WITH departures AS (
        SELECT airport, COUNT(departure) AS departure_count
        FROM (SELECT DISTINCT f.origin AS airport, f.flightid AS departure
              FROM flight f WHERE f.t && EPOCHRANGE '[2023-07-07 01:44:53, 2023-07-08 01:26:54]') GROUP BY airport
      ), arrivals AS (
        SELECT airport, COUNT(arrival) AS arrival_count
        FROM (SELECT DISTINCT f.destination AS airport, f.flightid AS arrival
              FROM flight f WHERE f.t && EPOCHRANGE '[2023-07-07 01:44:53, 2023-07-08 01:26:54]') GROUP BY airport
      )
      SELECT COALESCE(d.airport, a.airport) AS airport,
            COALESCE(d.departure_count, 0) AS departures,
            COALESCE(a.arrival_count, 0) AS arrivals,
            COALESCE(d.departure_count, 0) + COALESCE(a.arrival_count, 0) AS traffic_count
      FROM departures d FULL JOIN arrivals a ON d.airport = a.airport;
  params:
  - - '2023-07-07 01:44:53'
    - '2023-07-08 01:26:54'
- name: flightsInCountyInPeriod
  type: spatiotemporal
  sql: |
    SELECT DISTINCT f.flightid
    FROM fsegment f
    JOIN counties k ON ST_Point(f.x[0], f.y[0]) <@ k.geom::mpolygon
    WHERE k.name = 'Krs Dueren' AND t && EPOCHRANGE '[2023-01-26 07:23:10, 2023-02-09 15:11:39]';
  params:
  - - '2023-01-26 07:23:10'
    - '2023-02-09 15:11:39'
  - Krs Dueren
- name: flightsInCountyInPeriod
  type: spatiotemporal
  sql: |
    SELECT DISTINCT f.flightid
    FROM fsegment f
    JOIN counties k ON ST_Point(f.x[0], f.y[0]) <@ k.geom::mpolygon
    WHERE k.name = 'Krs Koeln' AND t && EPOCHRANGE '[2023-12-16 07:07:40, 2023-12-20 08:29:58]';
  params:
  - - '2023-12-16 07:07:40'
    - '2023-12-20 08:29:58'
  - Krs Koeln
- name: inCityRadiusInPeriod
  type: spatiotemporal
  sql: |
    SELECT f.flightid, fl.airplanetype, fl.origin, fl.destination
    FROM cities AS c
    JOIN fsegment AS f ON ST_DWithin(ST_Line(f.x[0], f.y[0], f.x[1], f.y[1]),
                                     ST_ToGeom(c.geom::gpoint), 4.618928778080096e-06)
    JOIN flight AS fl ON fl.flightid = f.flightid
    WHERE c.name = 'Porta Westfalica'
      AND f.t && EPOCHRANGE '[2023-05-14 17:54:59, 2023-05-21 18:51:37]'
      AND fl.t && EPOCHRANGE '[2023-05-14 17:54:59, 2023-05-21 18:51:37]';
  params:
  - - '2023-05-14 17:54:59'
    - '2023-05-21 18:51:37'
  - Porta Westfalica
  - 4.618928778080096e-06
- name: flightsInCountyInPeriod
  type: spatiotemporal
  sql: |
    SELECT DISTINCT f.flightid
    FROM fsegment f
    JOIN counties k ON ST_Point(f.x[0], f.y[0]) <@ k.geom::mpolygon
    WHERE k.name = 'Krs Mettmann' AND t && EPOCHRANGE '[2023-03-12 23:07:00, 2023-03-25 07:32:25]';
  params:
  - - '2023-03-12 23:07:00'
    - '2023-03-25 07:32:25'
  - Krs Mettmann
- name: countActiveFlightsInPeriod
  type: temporalbench
  sql: |
    SELECT COUNT(*) FROM (
    SELECT DISTINCT f.flightid
    FROM fsegment f
    WHERE f.t && EPOCHRANGE '[2023-04-28 03:35:08, 2023-05-01 12:29:28]' -- range intersection check
    );
  params:
  - - '2023-04-28 03:35:08'
    - '2023-05-01 12:29:28'
- name: countFlightsInCounties
  type: spatial
  sql: |
    SELECT name, COUNT(flightid) AS flight_count FROM (
      SELECT DISTINCT k.name, f.flightid
      FROM counties k
      JOIN fsegment f ON ST_Intersects(ST_Line(f.x[0], f.y[0], f.x[1], f.y[1]),ST_ToGeom(k.geom::gmpolygon))
      WHERE k.name = 'Krs Soest'
    ) GROUP BY name;
  params:
  - Krs Soest
- name: inCityRadiusInPeriod
  type: spatiotemporal
  sql: |
    SELECT f.flightid, fl.airplanetype, fl.origin, fl.destination
    FROM cities AS c
    JOIN fsegment AS f ON ST_DWithin(ST_Line(f.x[0], f.y[0], f.x[1], f.y[1]),
                                     ST_ToGeom(c.geom::gpoint), 8.916845184139539e-06)
    JOIN flight AS fl ON fl.flightid = f.flightid
    WHERE c.name = 'Werther (Westf.)'
      AND f.t && EPOCHRANGE '[2023-10-30 23:58:20, 2023-11-14 05:16:52]'
      AND fl.t && EPOCHRANGE '[2023-10-30 23:58:20, 2023-11-14 05:16:52]';
  params:
  - - '2023-10-30 23:58:20'
    - '2023-11-14 05:16:52'
  - Werther (Westf.)
  - 8.916845184139539e-06
- name: countFlightsInCounties
  type: spatial
  sql: |
    SELECT name, COUNT(flightid) AS flight_count FROM (
      SELECT DISTINCT k.name, f.flightid
      FROM counties k
      JOIN fsegment f ON ST_Intersects(ST_Line(f.x[0], f.y[0], f.x[1], f.y[1]),ST_ToGeom(k.geom::gmpolygon))
      WHERE k.name = 'Krs Hochsauerlandkreis'
    ) GROUP BY name;
  params:
  - Krs Hochsauerlandkreis
- name: flightClosestToPoint
  type: spatial
  sql: |
    WITH closest AS (
      SELECT flightid,
             ST_Distance(ST_Point(x[0], y[0]), ST_ToGeom('POINT(7.1846062518596465 50.85206064537443)'::gpoint)) AS min_distance
      FROM fsegment
      WHERE ST_DWithin(ST_Point(x[0], y[0]), ST_ToGeom('POINT(7.1846062518596465 50.85206064537443)'::gpoint), 5000)
      ORDER BY min_distance
    )
    SELECT f.flightid, f.airplanetype, f.origin, f.destination, min_distance
    FROM closest c JOIN flight f ON c.flightid = f.flightid
    ORDER BY min_distance;
  params:
  - POINT(7.1846062518596465 50.85206064537443)
  - 10
- name: airportUtilizationInPeriod
  type: temporal
  sql: |
    WITH departures AS (
        SELECT airport, COUNT(departure) AS departure_count
        FROM (SELECT DISTINCT f.origin AS airport, f.flightid AS departure
              FROM flight f WHERE f.t && EPOCHRANGE '[2023-01-08 08:27:39, 2023-01-09 23:04:12]') GROUP BY airport
      ), arrivals AS (
        SELECT airport, COUNT(arrival) AS arrival_count
        FROM (SELECT DISTINCT f.destination AS airport, f.flightid AS arrival
              FROM flight f WHERE f.t && EPOCHRANGE '[2023-01-08 08:27:39, 2023-01-09 23:04:12]') GROUP BY airport
      )
      SELECT COALESCE(d.airport, a.airport) AS airport,
            COALESCE(d.departure_count, 0) AS departures,
            COALESCE(a.arrival_count, 0) AS arrivals,
            COALESCE(d.departure_count, 0) + COALESCE(a.arrival_count, 0) AS traffic_count
      FROM departures d FULL JOIN arrivals a ON d.airport = a.airport;
  params:
  - - '2023-01-08 08:27:39'
    - '2023-01-09 23:04:12'
- name: countActiveFlightsInPeriod
  type: temporalbench
  sql: |
    SELECT COUNT(*) FROM (
    SELECT DISTINCT f.flightid
    FROM fsegment f
    WHERE f.t && EPOCHRANGE '[2023-05-24 02:52:20, 2023-05-29 13:02:57]' -- range intersection check
    );
  params:
  - - '2023-05-24 02:52:20'
    - '2023-05-29 13:02:57'
- name: countFlightsInCounties
  type: spatial
  sql: |
    SELECT name, COUNT(flightid) AS flight_count FROM (
      SELECT DISTINCT k.name, f.flightid
      FROM counties k
      JOIN fsegment f ON ST_Intersects(ST_Line(f.x[0], f.y[0], f.x[1], f.y[1]),ST_ToGeom(k.geom::gmpolygon))
      WHERE k.name = 'Krs Remscheid'
    ) GROUP BY name;
  params:
  - Krs Remscheid
- name: countActiveFlightsInPeriod
  type: temporalbench
  sql: |
    SELECT COUNT(*) FROM (
    SELECT DISTINCT f.flightid
    FROM fsegment f
    WHERE f.t && EPOCHRANGE '[2023-10-24 14:14:57, 2023-10-30 04:43:15]' -- range intersection check
    );
  params:
  - - '2023-10-24 14:14:57'
    - '2023-10-30 04:43:15'
- name: countActiveFlightsInPeriod
  type: temporalbench
  sql: |
    SELECT COUNT(*) FROM (
    SELECT DISTINCT f.flightid
    FROM fsegment f
    WHERE f.t && EPOCHRANGE '[2023-04-18 14:23:50, 2023-04-20 23:39:18]' -- range intersection check
    );
  params:
  - - '2023-04-18 14:23:50'
    - '2023-04-20 23:39:18'
- name: flightClosestToPoint
  type: spatial
  sql: |
    WITH closest AS (
      SELECT flightid,
             ST_Distance(ST_Point(x[0], y[0]), ST_ToGeom('POINT(8.164328137972555 51.07431283163588)'::gpoint)) AS min_distance
      FROM fsegment
      WHERE ST_DWithin(ST_Point(x[0], y[0]), ST_ToGeom('POINT(8.164328137972555 51.07431283163588)'::gpoint), 5000)
      ORDER BY min_distance
    )
    SELECT f.flightid, f.airplanetype, f.origin, f.destination, min_distance
    FROM closest c JOIN flight f ON c.flightid = f.flightid
    ORDER BY min_distance;
  params:
  - POINT(8.164328137972555 51.07431283163588)
  - 8
- name: airportUtilizationInPeriod
  type: temporal
  sql: |
    WITH departures AS (
        SELECT airport, COUNT(departure) AS departure_count
        FROM (SELECT DISTINCT f.origin AS airport, f.flightid AS departure
              FROM flight f WHERE f.t && EPOCHRANGE '[2023-04-21 21:45:05, 2023-04-22 04:27:42]') GROUP BY airport
      ), arrivals AS (
        SELECT airport, COUNT(arrival) AS arrival_count
        FROM (SELECT DISTINCT f.destination AS airport, f.flightid AS arrival
              FROM flight f WHERE f.t && EPOCHRANGE '[2023-04-21 21:45:05, 2023-04-22 04:27:42]') GROUP BY airport
      )
      SELECT COALESCE(d.airport, a.airport) AS airport,
            COALESCE(d.departure_count, 0) AS departures,
            COALESCE(a.arrival_count, 0) AS arrivals,
            COALESCE(d.departure_count, 0) + COALESCE(a.arrival_count, 0) AS traffic_count
      FROM departures d FULL JOIN arrivals a ON d.airport = a.airport;
  params:
  - - '2023-04-21 21:45:05'
    - '2023-04-22 04:27:42'
- name: inCityRadiusInPeriod
  type: spatiotemporal
  sql: |
    SELECT f.flightid, fl.airplanetype, fl.origin, fl.destination
    FROM cities AS c
    JOIN fsegment AS f ON ST_DWithin(ST_Line(f.x[0], f.y[0], f.x[1], f.y[1]),
                                     ST_ToGeom(c.geom::gpoint), 1.1095004169108851e-05)
    JOIN flight AS fl ON fl.flightid = f.flightid
    WHERE c.name = 'Voerde'
      AND f.t && EPOCHRANGE '[2023-04-14 20:47:57, 2023-04-27 20:30:31]'
      AND fl.t && EPOCHRANGE '[2023-04-14 20:47:57, 2023-04-27 20:30:31]';
  params:
  - - '2023-04-14 20:47:57'
    - '2023-04-27 20:30:31'
  - Voerde
  - 1.1095004169108851e-05
- name: countFlightsInCounties
  type: spatial
  sql: |
    SELECT name, COUNT(flightid) AS flight_count FROM (
      SELECT DISTINCT k.name, f.flightid
      FROM counties k
      JOIN fsegment f ON ST_Intersects(ST_Line(f.x[0], f.y[0], f.x[1], f.y[1]),ST_ToGeom(k.geom::gmpolygon))
      WHERE k.name = 'Krs Borken'
    ) GROUP BY name;
  params:
  - Krs Borken
- name: flightsInCountyInPeriod
  type: spatiotemporal
  sql: |
    SELECT DISTINCT f.flightid
    FROM fsegment f
    JOIN counties k ON ST_Point(f.x[0], f.y[0]) <@ k.geom::mpolygon
    WHERE k.name = 'Krs Rhein-Kreis Neuss' AND t && EPOCHRANGE '[2023-06-03 19:41:00, 2023-06-15 18:23:48]';
  params:
  - - '2023-06-03 19:41:00'
    - '2023-06-15 18:23:48'
  - Krs Rhein-Kreis Neuss
- name: flightsInCountyInPeriod
  type: spatiotemporal
  sql: |
    SELECT DISTINCT f.flightid
    FROM fsegment f
    JOIN counties k ON ST_Point(f.x[0], f.y[0]) <@ k.geom::mpolygon
    WHERE k.name = 'Krs Rhein-Kreis Neuss' AND t && EPOCHRANGE '[2023-05-08 19:20:14, 2023-05-11 19:06:18]';
  params:
  - - '2023-05-08 19:20:14'
    - '2023-05-11 19:06:18'
  - Krs Rhein-Kreis Neuss
- name: inCityRadiusInPeriod
  type: spatiotemporal
  sql: |
    SELECT f.flightid, fl.airplanetype, fl.origin, fl.destination
    FROM cities AS c
    JOIN fsegment AS f ON ST_DWithin(ST_Line(f.x[0], f.y[0], f.x[1], f.y[1]),
                                     ST_ToGeom(c.geom::gpoint), 3.4459360321055206e-06)
    JOIN flight AS fl ON fl.flightid = f.flightid
    WHERE c.name = 'Lemgo'
      AND f.t && EPOCHRANGE '[2023-06-12 09:55:51, 2023-06-22 03:14:35]'
      AND fl.t && EPOCHRANGE '[2023-06-12 09:55:51, 2023-06-22 03:14:35]';
  params:
  - - '2023-06-12 09:55:51'
    - '2023-06-22 03:14:35'
  - Lemgo
  - 3.4459360321055206e-06
- name: flightClosestToPoint
  type: spatial
  sql: |
    WITH closest AS (
      SELECT flightid,
             ST_Distance(ST_Point(x[0], y[0]), ST_ToGeom('POINT(6.354667912543742 51.11680116065118)'::gpoint)) AS min_distance
      FROM fsegment
      WHERE ST_DWithin(ST_Point(x[0], y[0]), ST_ToGeom('POINT(6.354667912543742 51.11680116065118)'::gpoint), 5000)
      ORDER BY min_distance
    )
    SELECT f.flightid, f.airplanetype, f.origin, f.destination, min_distance
    FROM closest c JOIN flight f ON c.flightid = f.flightid
    ORDER BY min_distance;
  params:
  - POINT(6.354667912543742 51.11680116065118)
  - 4
- name: countFlightsInCounties
  type: spatial
  sql: |
    SELECT name, COUNT(flightid) AS flight_count FROM (
      SELECT DISTINCT k.name, f.flightid
      FROM counties k
      JOIN fsegment f ON ST_Intersects(ST_Line(f.x[0], f.y[0], f.x[1], f.y[1]),ST_ToGeom(k.geom::gmpolygon))
      WHERE k.name = 'Krs Viersen'
    ) GROUP BY name;
  params:
  - Krs Viersen
- name: flightClosestToPoint
  type: spatial
  sql: |
    WITH closest AS (
      SELECT flightid,
             ST_Distance(ST_Point(x[0], y[0]), ST_ToGeom('POINT(8.58211345714495 51.28521014046845)'::gpoint)) AS min_distance
      FROM fsegment
      WHERE ST_DWithin(ST_Point(x[0], y[0]), ST_ToGeom('POINT(8.58211345714495 51.28521014046845)'::gpoint), 5000)
      ORDER BY min_distance
    )
    SELECT f.flightid, f.airplanetype, f.origin, f.destination, min_distance
    FROM closest c JOIN flight f ON c.flightid = f.flightid
    ORDER BY min_distance;
  params:
  - POINT(8.58211345714495 51.28521014046845)
  - 5
- name: inCityRadiusInPeriod
  type: spatiotemporal
  sql: |
    SELECT f.flightid, fl.airplanetype, fl.origin, fl.destination
    FROM cities AS c
    JOIN fsegment AS f ON ST_DWithin(ST_Line(f.x[0], f.y[0], f.x[1], f.y[1]),
                                     ST_ToGeom(c.geom::gpoint), 7.140935096701523e-06)
    JOIN flight AS fl ON fl.flightid = f.flightid
    WHERE c.name = 'Emsdetten'
      AND f.t && EPOCHRANGE '[2023-04-26 06:14:30, 2023-04-29 16:39:26]'
      AND fl.t && EPOCHRANGE '[2023-04-26 06:14:30, 2023-04-29 16:39:26]';
  params:
  - - '2023-04-26 06:14:30'
    - '2023-04-29 16:39:26'
  - Emsdetten
  - 7.140935096701523e-06
- name: countFlightsInCounties
  type: spatial
  sql: |
    SELECT name, COUNT(flightid) AS flight_count FROM (
      SELECT DISTINCT k.name, f.flightid
      FROM counties k
      JOIN fsegment f ON ST_Intersects(ST_Line(f.x[0], f.y[0], f.x[1], f.y[1]),ST_ToGeom(k.geom::gmpolygon))
      WHERE k.name = 'Krs Guetersloh'
    ) GROUP BY name;
  params:
  - Krs Guetersloh
- name: airportUtilizationInPeriod
  type: temporal
  sql: |
    WITH departures AS (
        SELECT airport, COUNT(departure) AS departure_count
        FROM (SELECT DISTINCT f.origin AS airport, f.flightid AS departure
              FROM flight f WHERE f.t && EPOCHRANGE '[2023-11-05 23:55:01, 2023-11-06 16:01:02]') GROUP BY airport
      ), arrivals AS (
        SELECT airport, COUNT(arrival) AS arrival_count
        FROM (SELECT DISTINCT f.destination AS airport, f.flightid AS arrival
              FROM flight f WHERE f.t && EPOCHRANGE '[2023-11-05 23:55:01, 2023-11-06 16:01:02]') GROUP BY airport
      )
      SELECT COALESCE(d.airport, a.airport) AS airport,
            COALESCE(d.departure_count, 0) AS departures,
            COALESCE(a.arrival_count, 0) AS arrivals,
            COALESCE(d.departure_count, 0) + COALESCE(a.arrival_count, 0) AS traffic_count
      FROM departures d FULL JOIN arrivals a ON d.airport = a.airport;
  params:
  - - '2023-11-05 23:55:01'
    - '2023-11-06 16:01:02'
- name: flightClosestToPoint
  type: spatial
  sql: |
    WITH closest AS (
      SELECT flightid,
             ST_Distance(ST_Point(x[0], y[0]), ST_ToGeom('POINT(8.135940739099471 52.16551411111646)'::gpoint)) AS min_distance
      FROM fsegment
      WHERE ST_DWithin(ST_Point(x[0], y[0]), ST_ToGeom('POINT(8.135940739099471 52.16551411111646)'::gpoint), 5000)
      ORDER BY min_distance
    )
    SELECT f.flightid, f.airplanetype, f.origin, f.destination, min_distance
    FROM closest c JOIN flight f ON c.flightid = f.flightid
    ORDER BY min_distance;
  params:
  - POINT(8.135940739099471 52.16551411111646)
  - 7
- name: flightClosestToPoint
  type: spatial
  sql: |
    WITH closest AS (
      SELECT flightid,
             ST_Distance(ST_Point(x[0], y[0]), ST_ToGeom('POINT(7.728654529691154 51.68459215649008)'::gpoint)) AS min_distance
      FROM fsegment
      WHERE ST_DWithin(ST_Point(x[0], y[0]), ST_ToGeom('POINT(7.728654529691154 51.68459215649008)'::gpoint), 5000)
      ORDER BY min_distance
    )
    SELECT f.flightid, f.airplanetype, f.origin, f.destination, min_distance
    FROM closest c JOIN flight f ON c.flightid = f.flightid
    ORDER BY min_distance;
  params:
  - POINT(7.728654529691154 51.68459215649008)
  - 5
- name: flightsInCountyInPeriod
  type: spatiotemporal
  sql: |
    SELECT DISTINCT f.flightid
    FROM fsegment f
    JOIN counties k ON ST_Point(f.x[0], f.y[0]) <@ k.geom::mpolygon
    WHERE k.name = 'Krs Wuppertal' AND t && EPOCHRANGE '[2023-02-21 06:37:15, 2023-03-03 06:41:50]';
  params:
  - - '2023-02-21 06:37:15'
    - '2023-03-03 06:41:50'
  - Krs Wuppertal
- name: inCityRadiusInPeriod
  type: spatiotemporal
  sql: |
    SELECT f.flightid, fl.airplanetype, fl.origin, fl.destination
    FROM cities AS c
    JOIN fsegment AS f ON ST_DWithin(ST_Line(f.x[0], f.y[0], f.x[1], f.y[1]),
                                     ST_ToGeom(c.geom::gpoint), 1.3644075654823828e-05)
    JOIN flight AS fl ON fl.flightid = f.flightid
    WHERE c.name = 'Burscheid'
      AND f.t && EPOCHRANGE '[2023-11-06 12:46:29, 2023-11-17 05:47:17]'
      AND fl.t && EPOCHRANGE '[2023-11-06 12:46:29, 2023-11-17 05:47:17]';
  params:
  - - '2023-11-06 12:46:29'
    - '2023-11-17 05:47:17'
  - Burscheid
  - 1.3644075654823828e-05
- name: countActiveFlightsInPeriod
  type: temporalbench
  sql: |
    SELECT COUNT(*) FROM (
    SELECT DISTINCT f.flightid
    FROM fsegment f
    WHERE f.t && EPOCHRANGE '[2023-04-06 21:50:50, 2023-04-19 21:11:35]' -- range intersection check
    );
  params:
  - - '2023-04-06 21:50:50'
    - '2023-04-19 21:11:35'
- name: airportUtilizationInPeriod
  type: temporal
  sql: |
    WITH departures AS (
        SELECT airport, COUNT(departure) AS departure_count
        FROM (SELECT DISTINCT f.origin AS airport, f.flightid AS departure
              FROM flight f WHERE f.t && EPOCHRANGE '[2023-02-20 13:22:20, 2023-02-22 06:23:47]') GROUP BY airport
      ), arrivals AS (
        SELECT airport, COUNT(arrival) AS arrival_count
        FROM (SELECT DISTINCT f.destination AS airport, f.flightid AS arrival
              FROM flight f WHERE f.t && EPOCHRANGE '[2023-02-20 13:22:20, 2023-02-22 06:23:47]') GROUP BY airport
      )
      SELECT COALESCE(d.airport, a.airport) AS airport,
            COALESCE(d.departure_count, 0) AS departures,
            COALESCE(a.arrival_count, 0) AS arrivals,
            COALESCE(d.departure_count, 0) + COALESCE(a.arrival_count, 0) AS traffic_count
      FROM departures d FULL JOIN arrivals a ON d.airport = a.airport;
  params:
  - - '2023-02-20 13:22:20'
    - '2023-02-22 06:23:47'
- name: countFlightsInCounties
  type: spatial
  sql: |
    SELECT name, COUNT(flightid) AS flight_count FROM (
      SELECT DISTINCT k.name, f.flightid
      FROM counties k
      JOIN fsegment f ON ST_Intersects(ST_Line(f.x[0], f.y[0], f.x[1], f.y[1]),ST_ToGeom(k.geom::gmpolygon))
      WHERE k.name = 'Krs Olpe'
    ) GROUP BY name;
  params:
  - Krs Olpe
- name: airportUtilizationInPeriod
  type: temporal
  sql: |
    WITH departures AS (
        SELECT airport, COUNT(departure) AS departure_count
        FROM (SELECT DISTINCT f.origin AS airport, f.flightid AS departure
              FROM flight f WHERE f.t && EPOCHRANGE '[2023-05-22 05:42:28, 2023-05-23 08:49:36]') GROUP BY airport
      ), arrivals AS (
        SELECT airport, COUNT(arrival) AS arrival_count
        FROM (SELECT DISTINCT f.destination AS airport, f.flightid AS arrival
              FROM flight f WHERE f.t && EPOCHRANGE '[2023-05-22 05:42:28, 2023-05-23 08:49:36]') GROUP BY airport
      )
      SELECT COALESCE(d.airport, a.airport) AS airport,
            COALESCE(d.departure_count, 0) AS departures,
            COALESCE(a.arrival_count, 0) AS arrivals,
            COALESCE(d.departure_count, 0) + COALESCE(a.arrival_count, 0) AS traffic_count
      FROM departures d FULL JOIN arrivals a ON d.airport = a.airport;
  params:
  - - '2023-05-22 05:42:28'
    - '2023-05-23 08:49:36'
- name: inCityRadiusInPeriod
  type: spatiotemporal
  sql: |
    SELECT f.flightid, fl.airplanetype, fl.origin, fl.destination
    FROM cities AS c
    JOIN fsegment AS f ON ST_DWithin(ST_Line(f.x[0], f.y[0], f.x[1], f.y[1]),
                                     ST_ToGeom(c.geom::gpoint), 8.001694381173785e-06)
    JOIN flight AS fl ON fl.flightid = f.flightid
    WHERE c.name = 'Wuppertal'
      AND f.t && EPOCHRANGE '[2023-03-23 14:04:13, 2023-03-30 05:39:44]'
      AND fl.t && EPOCHRANGE '[2023-03-23 14:04:13, 2023-03-30 05:39:44]';
  params:
  - - '2023-03-23 14:04:13'
    - '2023-03-30 05:39:44'
  - Wuppertal
  - 8.001694381173785e-06
