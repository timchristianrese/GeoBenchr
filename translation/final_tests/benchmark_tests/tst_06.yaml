name: flightsInSmallBox_oneFlight

source: "flight_points f"
source_data:
  type: csv
  path: "point_NRW_HIGH_0123.csv"
  geometry_column: wkt
  csv_options:
    delimiter: ";"
    header: false
    infer_schema: false
  schema:
    - { name: flightid }
    - { name: airplanetype }
    - { name: origin }
    - { name: destination }
    - { name: wkt }
    - { name: timestamp }
    - { name: altitude, type: double }

geometries:
  - name: query_box
    type: polygon
    srid: 4326
    coordinates:
      - [8.71, 51.16]
      - [8.75, 51.16]
      - [8.75, 51.20]
      - [8.71, 51.20]
      - [8.71, 51.16]

select:
  - "f.flightid"
  - "f.airplanetype"
  - "f.origin"
  - "f.destination"
  - "ST_Distance(f.geom, ST_GeomFromText('POINT(8.73 51.18)',4326)) AS dist_to_center"
filter:
  and:
    - spatial_filter:
        - { type: within, args: ["f.geom", ":geometries.query_box"] }
    - { field: flightid, operator: "in", value: ["'69187756'", "'69187812'", "'69187819'"] }

order_by:
  - { field: dist_to_center, direction: asc }