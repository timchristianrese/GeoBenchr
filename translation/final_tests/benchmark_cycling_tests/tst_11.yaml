name: T13_coveredby_point_polygon_week
source: "ride_points r"
source_data: { type: table }

geometries:
  - name: poly
    type: polygon
    srid: 4326
    coordinates:
      - [13.38,52.505]
      - [13.42,52.505]
      - [13.42,52.525]
      - [13.38,52.525]
      - [13.38,52.505]

select: []
aggregations:
  - { function: COUNT, field: "DISTINCT r.trip_id", alias: "n_trips" }

filter:
  and:
    - spatial_filter:
      - { type: coveredby, args: ["ST_Point(r.x, r.y)", ":geometries.poly"] }
    - time_filter:
      - { field: "r.t", start: "'2022-10-01T00:00:00Z'", end: "'2022-10-07T23:59:59Z'" }