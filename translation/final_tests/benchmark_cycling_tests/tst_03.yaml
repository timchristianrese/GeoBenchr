name: spatialIntersectsRows
source: "ride_points r"
source_data: { type: table }

select:
  - "r.trip_id"
  - "d.name AS district"

joins:
  - type: inner
    source: "berlin_districts d"
    source_data:
      type: table
      schema:
        - name: geom
          type: string
          format: "wkt:gpolygon"
    clause:
      spatial_filter:
        - type: intersects
          args: ["ST_Point(r.x, r.y)", "d.geom"]

filter:
  time_filter:
    - field: "r.t"
      start: "'2022-10-04T18:00:00Z'"
      end:   "'2022-10-04T19:00:00Z'"

order_by:
  - field: "r.trip_id"
    direction: "asc"
limit: 5