name: T11_within_not_time_window
source: "ride_points r"
source_data: { type: table }

geometries:
  - name: z_wide
    type: polygon
    srid: 4326
    coordinates:
      - [13.30,52.45]
      - [13.50,52.45]
      - [13.50,52.58]
      - [13.30,52.58]
      - [13.30,52.45]

select: []
aggregations:
  - { function: COUNT, field: "DISTINCT r.trip_id", alias: "n" }

filter:
  and:
    - spatial_filter:
      - { type: within, args: ["ST_Point(r.x, r.y)", ":geometries.z_wide"] }

    - not:
        time_filter:
          - { field: "r.t", start: "'2022-10-04T12:00:00Z'", end: "'2022-10-04T13:00:00Z'" }